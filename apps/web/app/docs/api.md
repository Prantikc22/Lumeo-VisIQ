# VisitorIQ API Documentation

VisitorIQ provides a REST API so you can build your own business logic, integrations, or automations using the data collected and risk signals generated by VisitorIQ.

## Authentication
- All API requests require your `site_key` (and optionally an API key/token if enabled).

## Example Endpoints

### Get Recent Visitors
```
GET /api/visitors?site_key=YOUR_SITE_KEY
```
**Response:**
```json
{
  "events": [
    {
      "id": "evt_123",
      "created_at": "2025-08-15T12:34:56Z",
      "ip": "1.2.3.4",
      "ip_city": "San Francisco",
      "ip_country": "US",
      "ip_org": "Comcast",
      "fingerprint_hash": "abc123...",
      "risk_score": 42,
      "verdict": "medium",
      "signals": ["vpn", "incognito"],
      "site_id": "site_abc"
    }
  ]
}
```

### Get Blocks
```
GET /api/blocks?site_key=YOUR_SITE_KEY
```

### Block an IP or Fingerprint
```
POST /api/blocks
Content-Type: application/json
{
  "type": "ip" | "fingerprint",
  "value": "1.2.3.4" | "abc123...",
  "reason": "Manual block",
  "site_key": "YOUR_SITE_KEY"
}
```

### Check Risk for a Visitor (Server-to-Server)
```
POST /api/check
Content-Type: application/json
{
  "ip": "1.2.3.4",
  "fingerprint": "abc123...",
  "site_key": "YOUR_SITE_KEY"
}
```
**Response:**
```json
{
  "risk_score": 87,
  "verdict": "high",
  "signals": ["vpn", "velocity"]
}
```

---

## How to Use
- Use these endpoints from your backend to automate blocks, alerts, or custom business logic.
- You can fetch real-time risk data, block/unblock users, and export analytics.

## Security
- Never expose your API key or sensitive endpoints directly in client-side code.
- Use server-to-server requests for sensitive actions.

## More
- For a full OpenAPI/Swagger spec, contact support or visit `/docs/api` (if enabled in your app).

---

## Easy Integration with Supabase & Clerk Auth

### For Supabase Auth Users
Paste this code in your frontend after user login/signup:

```js
import { supabase } from './your-supabase-client'

supabase.auth.onAuthStateChange((event, session) => {
  if (session?.user) {
    window.viq && window.viq('identify', {
      email: session.user.email,
      name: session.user.user_metadata?.full_name,
      phone: session.user.phone
    });
  }
});
```

### For Clerk Auth Users
Paste this code in your frontend after user login/signup:

```js
import { useUser } from "@clerk/clerk-react";

function MyApp() {
  const { user } = useUser();
  React.useEffect(() => {
    if (user) {
      window.viq && window.viq('identify', {
        email: user.primaryEmailAddress?.emailAddress,
        name: user.fullName,
        phone: user.primaryPhoneNumber?.phoneNumber
      });
    }
  }, [user]);
  // ...rest of your app
}
```

**Instructions:**
- Copy and paste the relevant code into your project.
- No backend changes needed. VisitorIQ will automatically link device info to user accounts for fraud detection, repeat signups, and analytics.

If you need more endpoints or want to enable webhooks, contact support!
