"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/collect-visitor/route";
exports.ids = ["app/api/collect-visitor/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "dns":
/*!**********************!*\
  !*** external "dns" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("dns");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("string_decoder");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var _Users_prantikchatterjee_Desktop_Apps_visitoriq_apps_web_app_api_collect_visitor_route_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./app/api/collect-visitor/route.ts */ \"(rsc)/./app/api/collect-visitor/route.ts\");\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/collect-visitor/route\",\n        pathname: \"/api/collect-visitor\",\n        filename: \"route\",\n        bundlePath: \"app/api/collect-visitor/route\"\n    },\n    resolvedPagePath: \"/Users/prantikchatterjee/Desktop/Apps/visitoriq/apps/web/app/api/collect-visitor/route.ts\",\n    nextConfigOutput,\n    userland: _Users_prantikchatterjee_Desktop_Apps_visitoriq_apps_web_app_api_collect_visitor_route_ts__WEBPACK_IMPORTED_MODULE_2__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/collect-visitor/route\";\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGY29sbGVjdC12aXNpdG9yJTJGcm91dGUmcGFnZT0lMkZhcGklMkZjb2xsZWN0LXZpc2l0b3IlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjb2xsZWN0LXZpc2l0b3IlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZwcmFudGlrY2hhdHRlcmplZSUyRkRlc2t0b3AlMkZBcHBzJTJGdmlzaXRvcmlxJTJGYXBwcyUyRndlYiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZwcmFudGlrY2hhdHRlcmplZSUyRkRlc2t0b3AlMkZBcHBzJTJGdmlzaXRvcmlxJTJGYXBwcyUyRndlYiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDdUQ7QUFDdEg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDaUo7O0FBRWpKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvP2E3YmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3ByYW50aWtjaGF0dGVyamVlL0Rlc2t0b3AvQXBwcy92aXNpdG9yaXEvYXBwcy93ZWIvYXBwL2FwaS9jb2xsZWN0LXZpc2l0b3Ivcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NvbGxlY3QtdmlzaXRvci9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NvbGxlY3QtdmlzaXRvclwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY29sbGVjdC12aXNpdG9yL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL3ByYW50aWtjaGF0dGVyamVlL0Rlc2t0b3AvQXBwcy92aXNpdG9yaXEvYXBwcy93ZWIvYXBwL2FwaS9jb2xsZWN0LXZpc2l0b3Ivcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY29sbGVjdC12aXNpdG9yL3JvdXRlXCI7XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/collect-visitor/route.ts":
/*!******************************************!*\
  !*** ./app/api/collect-visitor/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   emailIsDisposable: () => (/* binding */ emailIsDisposable),\n/* harmony export */   ipInList: () => (/* binding */ ipInList)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/../../node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/../../node_modules/next/headers.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_headers__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/redis */ \"(rsc)/./lib/redis.ts\");\n/* harmony import */ var _lib_ipinfo__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/ipinfo */ \"(rsc)/./lib/ipinfo.ts\");\n/* harmony import */ var _lib_abuse__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/abuse */ \"(rsc)/./lib/abuse.ts\");\n/* harmony import */ var _lib_velocity__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/velocity */ \"(rsc)/./lib/velocity.ts\");\n/* harmony import */ var _lib_risk__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/lib/risk */ \"(rsc)/./lib/risk.ts\");\n/* harmony import */ var _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @/lib/supabaseServer */ \"(rsc)/./lib/supabaseServer.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm-node/v5.js\");\n/* harmony import */ var _withCORS__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../withCORS */ \"(rsc)/./app/api/withCORS.ts\");\nconsole.log(\"[CASCADE DEBUG] collect-visitor route.ts loaded\");\nconsole.log(\"SUPABASE_URL\", process.env.SUPABASE_URL);\nconsole.log(\"SUPABASE_SERVICE_ROLE_KEY\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n\n\n\n\n\n\n\n\n\n\n\n// OSS Tor/Proxy/Disposable Email helpers (module scope for ES5 strict mode)\nasync function ipInList(ip, file) {\n    try {\n        const { readFile } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs/promises */ \"fs/promises\", 23));\n        const data = await readFile(file, \"utf8\");\n        const set = new Set(data.split(\"\\n\").map((l)=>l.trim()).filter(Boolean));\n        return set.has(ip);\n    } catch  {\n        return false;\n    }\n}\nasync function emailIsDisposable(email, file) {\n    if (!email) return false;\n    const domain = email.split(\"@\")[1]?.toLowerCase();\n    if (!domain) return false;\n    try {\n        const { readFile } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs/promises */ \"fs/promises\", 23));\n        const data = await readFile(file, \"utf8\");\n        if (domain === \"zzz.com\" || domain === \"gmail.com\") {\n            // Log file path\n            console.log(\"[DISPOSABLE FILE PATH]\", file);\n            // Log first and last 20 lines\n            const lines = data.split(\"\\n\");\n            console.log(\"[DISPOSABLE FILE HEAD]\", lines.slice(0, 20));\n            console.log(\"[DISPOSABLE FILE TAIL]\", lines.slice(-20));\n            // Log last 200 chars\n            console.log(\"[DISPOSABLE RAW FILE]\", JSON.stringify(data.slice(-200)), \"LENGTH:\", data.length);\n        }\n        // Defensive: trim domain and all set values\n        // Remove invisible characters and normalize lines\n        const clean = (s)=>s.replace(/[\\u200B-\\u200D\\uFEFF\\r\\n\\t ]+/g, \"\").toLowerCase();\n        const set = new Set(data.split(\"\\n\").map((l)=>clean(l)).filter(Boolean));\n        return set.has(clean(domain));\n    } catch  {\n        return false;\n    }\n}\nconst CollectVisitorSchema = zod__WEBPACK_IMPORTED_MODULE_9__.object({\n    siteKey: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    fingerprint_hash: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    userAgent: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    language: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    timezone: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    resolution: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    referrer: zod__WEBPACK_IMPORTED_MODULE_9__.string().optional(),\n    incognito: zod__WEBPACK_IMPORTED_MODULE_9__.boolean().optional(),\n    webdriver: zod__WEBPACK_IMPORTED_MODULE_9__.boolean().optional(),\n    thumbmark_signals: zod__WEBPACK_IMPORTED_MODULE_9__.any().optional(),\n    thumbmark_details: zod__WEBPACK_IMPORTED_MODULE_9__.any().optional(),\n    email: zod__WEBPACK_IMPORTED_MODULE_9__.string().email().optional(),\n    phone: zod__WEBPACK_IMPORTED_MODULE_9__.string().optional(),\n    name: zod__WEBPACK_IMPORTED_MODULE_9__.string().optional(),\n    botd_result: zod__WEBPACK_IMPORTED_MODULE_9__.any().optional()\n});\n\nconst OPTIONS = (0,_withCORS__WEBPACK_IMPORTED_MODULE_10__.withCORS)(async function OPTIONS() {\n    return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](null, {\n        status: 204\n    });\n});\nfunction normalizeBotdResult(botd) {\n    if (!botd) return undefined;\n    // If BotD OSS result is just {bot: false}, normalize to {result: 'notDetected'}\n    if (typeof botd === \"object\" && botd !== null && botd.bot === false) {\n        return {\n            result: \"notDetected\"\n        };\n    }\n    return botd;\n}\nconst POST = (0,_withCORS__WEBPACK_IMPORTED_MODULE_10__.withCORS)(async function POST(req) {\n    try {\n        const body = await req.json();\n        const parse = CollectVisitorSchema.safeParse(body);\n        if (!parse.success) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Invalid body\",\n                details: parse.error.errors\n            }, {\n                status: 400\n            });\n        }\n        const { siteKey, fingerprint_hash, userAgent, language, timezone, resolution, referrer = \"\", incognito = false, webdriver = false, thumbmark_signals, email, phone, name, botd_result } = parse.data;\n        // IP detection\n        const ip = ((0,next_headers__WEBPACK_IMPORTED_MODULE_2__.headers)().get(\"x-forwarded-for\")?.split(\",\")[0] ?? req.ip ?? req.socket?.remoteAddress ?? \"\").trim();\n        if (!ip) return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"IP not found\"\n        }, {\n            status: 400\n        });\n        // OSS Tor/Proxy/Disposable Email checks\n        // OSS Tor/Proxy/Disposable Email checks (async, robust)\n        // Use correct path for disposable email domains\n        // Correct path to disposable-email-domains.txt from monorepo root\n        const disposableFilePath = path__WEBPACK_IMPORTED_MODULE_1___default().resolve(process.cwd(), \"../../packages/disposable-email-domains.txt\");\n        let debugTempEmailDomain = \"\";\n        let debugTempEmailResult = false;\n        // Log the resolved path and file existence\n        const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n        if (email) {\n            debugTempEmailDomain = email.split(\"@\")[1]?.toLowerCase();\n            debugTempEmailResult = await emailIsDisposable(email, disposableFilePath);\n        }\n        const [isTor, isProxy] = await Promise.all([\n            ipInList(ip, path__WEBPACK_IMPORTED_MODULE_1___default().join(__dirname, \"../../../packages/tor-exit-nodes.txt\")),\n            ipInList(ip, path__WEBPACK_IMPORTED_MODULE_1___default().join(__dirname, \"../../../packages/proxy-list.txt\"))\n        ]);\n        const isTempEmail = debugTempEmailResult;\n        // Rate limit\n        const rl = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_3__.tokenBucket)(`rl:${ip}`, 60, 1);\n        if (!rl.allowed) return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"rate_limited\"\n        }, {\n            status: 429\n        });\n        // IPInfo\n        const info = await (0,_lib_ipinfo__WEBPACK_IMPORTED_MODULE_4__.getIPInfo)(ip);\n        // Timezone mismatch (MVP: compare string presence)\n        let timezoneMismatch = false;\n        if (info?.timezone && timezone) {\n            timezoneMismatch = info.timezone !== timezone;\n        } else {\n            timezoneMismatch = true;\n        }\n        // AbuseIPDB\n        const abuse = await (0,_lib_abuse__WEBPACK_IMPORTED_MODULE_5__.checkAbuseIP)(ip);\n        // Velocity\n        // Use visitor_id for velocityCount as per schema\n        // If you do not have visitor_id from the request, generate one (UUID) or derive it deterministically\n        // Use fingerprint_hash (or thumbmark hash) as stable visitor_id if possible\n        let visitor_id = fingerprint_hash;\n        // If not a valid UUID, create a deterministic UUID from the hash\n        const uuidValidate = (v)=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(v);\n        if (!uuidValidate(visitor_id)) {\n            // Use a deterministic UUID based on the hash (v5, but simple fallback here)\n            const NAMESPACE = \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\"; // DNS namespace\n            visitor_id = (0,uuid__WEBPACK_IMPORTED_MODULE_11__[\"default\"])(fingerprint_hash, NAMESPACE);\n        }\n        const v = await (0,_lib_velocity__WEBPACK_IMPORTED_MODULE_6__.velocityCount)(_lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer, siteKey, visitor_id, 60);\n        // Compute risk\n        const vpnDetected = info?.privacy?.vpn || info?.privacy?.hosting || false;\n        const { score, verdict } = (0,_lib_risk__WEBPACK_IMPORTED_MODULE_7__.computeRisk)({\n            incognito,\n            vpn: vpnDetected,\n            timezoneMismatch,\n            webdriver,\n            abuseListed: abuse.blocklisted,\n            velocityCount: v\n        });\n        // Manual blocklist\n        let action = \"manual_review\";\n        let manualBlock = false;\n        let blockId = null;\n        let blockReason = null;\n        let suspiciousReason = null;\n        let suspicious = false;\n        const { data: blocks } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"manual_blocks\").select(\"id,reason\").eq(\"site_key\", siteKey).or(`fingerprint_hash.eq.${fingerprint_hash},ip.eq.${ip}`).is(\"expires_at\", null).limit(1);\n        if (blocks && blocks.length > 0) {\n            manualBlock = true;\n            blockId = blocks[0].id;\n            blockReason = blocks[0].reason;\n        }\n        let finalScore = score;\n        let finalVerdict = verdict;\n        if (manualBlock) {\n            action = \"auto_block\";\n            finalScore = 100;\n            finalVerdict = \"high\";\n        }\n        // Lookup site_id, repeat_signup_limit, user_id, and trial abuse settings from sites table using api_key\n        const { data: siteRow, error: siteError } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"sites\").select(\"id, repeat_signup_limit, user_id, auto_block_trial_abuse, trial_abuse_threshold\").eq(\"api_key\", siteKey).maybeSingle();\n        console.log(\"[DEBUG siteKey]\", siteKey);\n        console.log(\"[DEBUG siteRow FULL]\", JSON.stringify(siteRow));\n        console.log(\"[DEBUG siteRow.auto_block_trial_abuse]\", siteRow ? siteRow.auto_block_trial_abuse : undefined);\n        console.log(\"[DEBUG siteError]\", siteError);\n        if (!siteRow || siteError) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"invalid_site_key\",\n                details: \"Site not found for provided siteKey\"\n            }, {\n                status: 400\n            });\n        }\n        const autoBlockTrialAbuse = siteRow.auto_block_trial_abuse ?? false;\n        const trialAbuseThreshold = siteRow.trial_abuse_threshold ?? 2; // Default threshold = 2\n        // Check API usage quota BEFORE running IPInfo or event insert\n        let quotaExceeded = false;\n        if (siteRow.user_id) {\n            const { data: usageRows, error: usageFetchErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"user_api_usage\").select(\"used, quota, cycle_end\").eq(\"user_id\", siteRow.user_id).limit(1);\n            if (usageFetchErr) {\n                console.error(\"[COLLECT-VISITOR][USAGE] Failed to fetch usage row:\", usageFetchErr, {\n                    user_id: siteRow.user_id\n                });\n            }\n            if (usageRows && usageRows.length > 0) {\n                const { used, quota, cycle_end } = usageRows[0];\n                const now = new Date();\n                if (!cycle_end || new Date(cycle_end) < now) {\n                    quotaExceeded = true;\n                } else if (quota > 0 && used >= quota) {\n                    quotaExceeded = true;\n                }\n            }\n        }\n        if (quotaExceeded) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"quota_exceeded\",\n                details: \"API quota reached for this account.\"\n            }, {\n                status: 429\n            });\n        }\n        // Upsert visitor before inserting event to satisfy FK constraint\n        const { data: upsertedVisitor, error: upsertVisitorErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitors\").upsert({\n            id: visitor_id,\n            site_id: siteRow.id,\n            visitor_id: visitor_id,\n            fingerprint: fingerprint_hash,\n            thumbmark: thumbmark_signals?.hash || \"\",\n            user_agent: userAgent,\n            screen_resolution: resolution,\n            timezone,\n            language,\n            platform: \"\",\n            ip_address: ip,\n            country: info?.country ?? \"\",\n            city: info?.city ?? \"\",\n            region: info?.region ?? \"\",\n            isp: info?.org ?? \"\",\n            is_bot: false,\n            email: email || null,\n            phone: phone || null,\n            name: name || null,\n            risk_score: 0,\n            is_tor: isTor,\n            is_proxy: isProxy,\n            is_temp_email: isTempEmail\n        }, {\n            onConflict: \"id\"\n        });\n        console.log(\"[DEBUG upsertedVisitor]\", upsertedVisitor);\n        console.log(\"[DEBUG upsertVisitorErr]\", upsertVisitorErr);\n        if (upsertVisitorErr) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"db_upsert_visitor_failed\",\n                details: upsertVisitorErr.message\n            }, {\n                status: 500\n            });\n        }\n        // [TRIAL ABUSE BLOCK LOGIC] Count unique emails for this fingerprint/site BEFORE event insert\n        if (email && fingerprint_hash) {\n            // Insert new email into visitor_emails if not already present\n            const { data: existingEmail, error: emailLookupErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitor_emails\").select(\"id\").eq(\"site_id\", siteRow.id).eq(\"fingerprint\", fingerprint_hash).eq(\"email\", email.toLowerCase()).maybeSingle();\n            if (!emailLookupErr && !existingEmail) {\n                await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitor_emails\").insert({\n                    site_id: siteRow.id,\n                    fingerprint: fingerprint_hash,\n                    email: email.toLowerCase(),\n                    created_at: new Date().toISOString()\n                });\n            }\n            // Count unique emails from visitor_emails\n            const { data: emailRows, error: emailErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitor_emails\").select(\"email\").eq(\"site_id\", siteRow.id).eq(\"fingerprint\", fingerprint_hash);\n            console.log(\"[DEBUG trial abuse visitor_emails] emailRows:\", emailRows);\n            if (!emailErr && emailRows) {\n                const uniqueEmails = Array.from(new Set(emailRows.map((r)=>(r.email || \"\").toLowerCase()).filter(Boolean)));\n                console.log(\"[DEBUG trial abuse visitor_emails] uniqueEmails:\", uniqueEmails, \"length:\", uniqueEmails.length, \"threshold:\", trialAbuseThreshold, \"autoBlockTrialAbuse:\", autoBlockTrialAbuse);\n                // If threshold reached or exceeded\n                if (uniqueEmails.length >= trialAbuseThreshold) {\n                    if (autoBlockTrialAbuse) {\n                        // Check if already blocked for trial abuse\n                        const { data: existingBlock, error: blockErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"manual_blocks\").select(\"id\").eq(\"site_key\", siteKey).eq(\"fingerprint_hash\", fingerprint_hash).eq(\"reason\", \"trial abuse: multiple emails\").maybeSingle();\n                        console.log(\"[DEBUG trial abuse visitor_emails] blockErr:\", blockErr, \"existingBlock:\", existingBlock);\n                        if (!blockErr && !existingBlock) {\n                            const { error: insertBlockErr, data: insertBlockData } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"manual_blocks\").insert({\n                                fingerprint_hash,\n                                reason: \"trial abuse: multiple emails\",\n                                site_key: siteKey\n                            });\n                            console.log(\"[DEBUG trial abuse visitor_emails] block insert error:\", insertBlockErr, \"block insert data:\", insertBlockData);\n                            manualBlock = true;\n                            blockReason = \"trial abuse: multiple emails\";\n                            action = \"auto_block\";\n                            finalScore = 100;\n                            finalVerdict = \"high\";\n                        }\n                    } else if (!manualBlock) {\n                        suspicious = true;\n                        suspiciousReason = `Multiple emails (${uniqueEmails.length}) for same fingerprint`;\n                    }\n                }\n            } else {\n                console.log(\"[DEBUG trial abuse visitor_emails] emailErr:\", emailErr);\n            }\n        }\n        // --- Event insert logic START ---\n        // Fetch and increment visit_count\n        let newVisitCount = 1;\n        const { data: visitorRow, error: visitorFetchErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitors\").select(\"visit_count\").eq(\"id\", visitor_id).maybeSingle();\n        if (!visitorFetchErr && visitorRow && typeof visitorRow.visit_count === \"number\") {\n            newVisitCount = visitorRow.visit_count + 1;\n            await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitors\").update({\n                visit_count: newVisitCount,\n                last_seen: new Date().toISOString()\n            }).eq(\"id\", visitor_id);\n        } else {\n            // fallback: set to 1 if not found or error\n            await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitors\").update({\n                visit_count: 1,\n                last_seen: new Date().toISOString()\n            }).eq(\"id\", visitor_id);\n        }\n        // Insert event and get ID\n        const { data: insertedEvent, error: insertErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"events\").insert({\n            site_id: siteRow.id,\n            visitor_id,\n            event_type: \"page_view\",\n            event_name: \"page_view\",\n            url: \"\",\n            referrer,\n            properties: {\n                fingerprint_hash,\n                thumbmark_signals,\n                thumbmark_details: body.thumbmark_details || {},\n                risk_score: finalScore,\n                verdict: finalVerdict,\n                ip,\n                ip_city: info?.city ?? \"\",\n                ip_country: info?.country ?? \"\",\n                ip_org: info?.org ?? \"\",\n                email: body.email || undefined,\n                botd_result: normalizeBotdResult(body.botd_result),\n                is_tor: isTor,\n                is_proxy: isProxy,\n                is_temp_email: !!isTempEmail,\n                vpnDetected,\n                is_bot: false,\n                browser: body.browser || \"\",\n                os: body.os || \"\",\n                resolution: body.resolution || \"\",\n                timezone: body.timezone || \"\",\n                userAgent: body.userAgent || \"\",\n                signals: Array.isArray(body.signals) ? body.signals : body.thumbmark_signals?.signals || [],\n                gps_location: body.geo && body.geo.lat && body.geo.lon ? {\n                    lat: body.geo.lat,\n                    lon: body.geo.lon,\n                    accuracy: body.geo.accuracy\n                } : undefined,\n                gps_permission: body.geo?.permission,\n                emulator_detected: !!body.emulator?.isEmulator,\n                emulator_reasons: body.emulator?.reasons || [],\n                geo_mismatch: body.geo && body.geo.lat && body.geo.lon && info && info.loc ? Math.abs(body.geo.lat - info.loc[0]) > 0.5 || Math.abs(body.geo.lon - info.loc[1]) > 0.5 : false,\n                location_spoofed: body.geo && body.geo.lat && body.geo.lon && info && info.loc ? Math.abs(body.geo.lat - info.loc[0]) > 1.5 || Math.abs(body.geo.lon - info.loc[1]) > 1.5 : false,\n                suspicious,\n                suspiciousReason,\n                visit_count: newVisitCount\n            },\n            timestamp: new Date().toISOString()\n        }).select(\"id\").single();\n        if (insertErr) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"db_insert_failed\",\n                details: insertErr.message\n            }, {\n                status: 500\n            });\n        }\n        // --- Event insert logic END ---\n        const { data: usageRows, error: usageFetchErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"user_api_usage\").select(\"used, quota, cycle_end\").eq(\"user_id\", siteRow.user_id).limit(1);\n        if (usageFetchErr) {\n            console.error(\"[COLLECT-VISITOR][USAGE] Failed to fetch usage row:\", usageFetchErr, {\n                user_id: siteRow.user_id\n            });\n        }\n        if (usageRows && usageRows.length > 0) {\n            const { used, quota, cycle_end } = usageRows[0];\n            const now = new Date();\n            if (!cycle_end || new Date(cycle_end) < now) {\n                quotaExceeded = true;\n            } else if (quota > 0 && used >= quota) {\n                quotaExceeded = true;\n            }\n        }\n        // Count unique emails for this fingerprint/site\n        if (email && fingerprint_hash) {\n            const { data: emailRows, error: emailErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitors\").select(\"email\").eq(\"site_id\", siteRow.id).eq(\"fingerprint\", fingerprint_hash).neq(\"email\", null);\n            if (!emailErr && emailRows) {\n                const uniqueEmails = Array.from(new Set(emailRows.map((r)=>(r.email || \"\").toLowerCase()).filter(Boolean)));\n                // If threshold reached or exceeded\n                if (uniqueEmails.length >= trialAbuseThreshold) {\n                    if (autoBlockTrialAbuse) {\n                        // Check if already blocked for trial abuse\n                        const { data: existingBlock, error: blockErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"manual_blocks\").select(\"id\").eq(\"site_key\", siteKey).eq(\"fingerprint_hash\", fingerprint_hash).eq(\"reason\", \"trial abuse: multiple emails\").maybeSingle();\n                        if (!blockErr && !existingBlock) {\n                            await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"manual_blocks\").insert({\n                                fingerprint_hash,\n                                reason: \"trial abuse: multiple emails\",\n                                site_key: siteKey\n                            });\n                            manualBlock = true;\n                            blockReason = \"trial abuse: multiple emails\";\n                            action = \"auto_block\";\n                            finalScore = 100;\n                            finalVerdict = \"high\";\n                        }\n                    } else if (!manualBlock) {\n                        suspicious = true;\n                        suspiciousReason = `Multiple emails (${uniqueEmails.length}) for same fingerprint`;\n                    }\n                }\n            }\n        }\n        // Increment API usage for this user\n        try {\n            if (siteRow.user_id) {\n                // Try to increment used\n                const { data: usageRows, error: usageFetchErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"user_api_usage\").select(\"used, quota\").eq(\"user_id\", siteRow.user_id).limit(1);\n                if (usageFetchErr) {\n                    console.error(\"[COLLECT-VISITOR][USAGE] Failed to fetch usage row:\", usageFetchErr, {\n                        user_id: siteRow.user_id\n                    });\n                }\n                if (usageRows && usageRows.length > 0) {\n                    const currentUsed = usageRows[0].used || 0;\n                    const quota = usageRows[0].quota || 0;\n                    const { error: usageUpdateErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"user_api_usage\").update({\n                        used: currentUsed + 1,\n                        updated_at: new Date().toISOString()\n                    }).eq(\"user_id\", siteRow.user_id);\n                    if (usageUpdateErr) {\n                        console.error(\"[COLLECT-VISITOR][USAGE] Failed to increment usage:\", usageUpdateErr, {\n                            user_id: siteRow.user_id\n                        });\n                    }\n                } else {\n                    // Insert new usage row if not present\n                    const { error: usageInsertErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"user_api_usage\").insert({\n                        user_id: siteRow.user_id,\n                        used: 1,\n                        quota: 0,\n                        updated_at: new Date().toISOString()\n                    });\n                    if (usageInsertErr) {\n                        console.error(\"[COLLECT-VISITOR][USAGE] Failed to insert usage row:\", usageInsertErr, {\n                            user_id: siteRow.user_id\n                        });\n                    }\n                }\n            }\n        } catch (err) {\n            console.error(\"[COLLECT-VISITOR][USAGE] Unexpected error incrementing API usage:\", err, {\n                user_id: siteRow.user_id\n            });\n        }\n        // Get client settings\n        const { data: clientApp } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"client_apps\").select(\"auto_block, risk_threshold, share_reputation\").eq(\"site_key\", siteKey).maybeSingle();\n        const risk_threshold = clientApp?.risk_threshold ?? 80;\n        const auto_block = clientApp?.auto_block ?? false;\n        const share_reputation = clientApp?.share_reputation ?? false;\n        // Decide action\n        if (auto_block && finalScore >= risk_threshold) {\n            action = \"auto_block\";\n        }\n        // Share reputation\n        if (share_reputation && finalVerdict === \"high\") {\n            await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"global_reputation\").upsert({\n                fingerprint_hash,\n                ip,\n                abuse_count: 1,\n                last_seen: new Date().toISOString()\n            }, {\n                onConflict: \"fingerprint_hash,ip\"\n            });\n        }\n        return (0,_withCORS__WEBPACK_IMPORTED_MODULE_10__.withCORS)(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            risk_score: finalScore,\n            verdict: finalVerdict,\n            action,\n            visitor_event_id: insertedEvent.id,\n            signals: {\n                vpnDetected,\n                timezoneMismatch,\n                velocityCount: v\n            }\n        }));\n    } catch (err) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"server_error\",\n            details: err.message\n        }, {\n            status: 500\n        });\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2NvbGxlY3QtdmlzaXRvci9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsUUFBUUMsR0FBRyxDQUFDO0FBQ1pELFFBQVFDLEdBQUcsQ0FBQyxnQkFBZ0JDLFFBQVFDLEdBQUcsQ0FBQ0MsWUFBWTtBQUNwREosUUFBUUMsR0FBRyxDQUFDLDZCQUE2QkMsUUFBUUMsR0FBRyxDQUFDRSx5QkFBeUI7QUFDcEM7QUFDbEI7QUFFYztBQUNmO0FBQ3lCO0FBQ1I7QUFDRTtBQUNJO0FBQ047QUFDYTtBQUNqQjtBQUVwQyw0RUFBNEU7QUFDckUsZUFBZWEsU0FBU0MsRUFBVSxFQUFFQyxJQUFZO0lBQ3JELElBQUk7UUFDRixNQUFNLEVBQUVDLFFBQVEsRUFBRSxHQUFHLE1BQU0sNEhBQU87UUFDbEMsTUFBTUMsT0FBTyxNQUFNRCxTQUFTRCxNQUFNO1FBQ2xDLE1BQU1HLE1BQU0sSUFBSUMsSUFBSUYsS0FBS0csS0FBSyxDQUFDLE1BQU1DLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsSUFBSSxJQUFJQyxNQUFNLENBQUNDO1FBQy9ELE9BQU9QLElBQUlRLEdBQUcsQ0FBQ1o7SUFDakIsRUFBRSxPQUFNO1FBQUUsT0FBTztJQUFPO0FBQzFCO0FBRU8sZUFBZWEsa0JBQWtCQyxLQUFhLEVBQUViLElBQVk7SUFDakUsSUFBSSxDQUFDYSxPQUFPLE9BQU87SUFDbkIsTUFBTUMsU0FBU0QsTUFBTVIsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUVVO0lBQ3BDLElBQUksQ0FBQ0QsUUFBUSxPQUFPO0lBQ3BCLElBQUk7UUFDRixNQUFNLEVBQUViLFFBQVEsRUFBRSxHQUFHLE1BQU0sNEhBQU87UUFDbEMsTUFBTUMsT0FBTyxNQUFNRCxTQUFTRCxNQUFNO1FBQ2xDLElBQUljLFdBQVcsYUFBYUEsV0FBVyxhQUFhO1lBQ2xELGdCQUFnQjtZQUNoQmxDLFFBQVFDLEdBQUcsQ0FBQywwQkFBMEJtQjtZQUN0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QWdCQyxTQUFTc0osSUFBSTNELE9BQU87UUFBQyxHQUFHO1lBQUV6RyxRQUFRO1FBQUk7SUFDMUY7QUFDRixHQUFHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9hcHAvYXBpL2NvbGxlY3QtdmlzaXRvci9yb3V0ZS50cz9lM2ViIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnNvbGUubG9nKCdbQ0FTQ0FERSBERUJVR10gY29sbGVjdC12aXNpdG9yIHJvdXRlLnRzIGxvYWRlZCcpO1xuY29uc29sZS5sb2coJ1NVUEFCQVNFX1VSTCcsIHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTCk7XG5jb25zb2xlLmxvZygnU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWScsIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkpO1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGZpbGVVUkxUb1BhdGggfSBmcm9tICd1cmwnO1xuaW1wb3J0IHsgaGVhZGVycyB9IGZyb20gJ25leHQvaGVhZGVycydcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnXG5pbXBvcnQgeyByZWRpcywgdG9rZW5CdWNrZXQgfSBmcm9tICdAL2xpYi9yZWRpcydcbmltcG9ydCB7IGdldElQSW5mbyB9IGZyb20gJ0AvbGliL2lwaW5mbydcbmltcG9ydCB7IGNoZWNrQWJ1c2VJUCB9IGZyb20gJ0AvbGliL2FidXNlJ1xuaW1wb3J0IHsgdmVsb2NpdHlDb3VudCB9IGZyb20gJ0AvbGliL3ZlbG9jaXR5J1xuaW1wb3J0IHsgY29tcHV0ZVJpc2sgfSBmcm9tICdAL2xpYi9yaXNrJ1xuaW1wb3J0IHsgc3VwYWJhc2VTZXJ2ZXIgfSBmcm9tICdAL2xpYi9zdXBhYmFzZVNlcnZlcidcbmltcG9ydCB7IHY1IGFzIHV1aWR2NSB9IGZyb20gJ3V1aWQnO1xuXG4vLyBPU1MgVG9yL1Byb3h5L0Rpc3Bvc2FibGUgRW1haWwgaGVscGVycyAobW9kdWxlIHNjb3BlIGZvciBFUzUgc3RyaWN0IG1vZGUpXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaXBJbkxpc3QoaXA6IHN0cmluZywgZmlsZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyByZWFkRmlsZSB9ID0gYXdhaXQgaW1wb3J0KCdmcy9wcm9taXNlcycpO1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZWFkRmlsZShmaWxlLCAndXRmOCcpO1xuICAgIGNvbnN0IHNldCA9IG5ldyBTZXQoZGF0YS5zcGxpdCgnXFxuJykubWFwKGwgPT4gbC50cmltKCkpLmZpbHRlcihCb29sZWFuKSk7XG4gICAgcmV0dXJuIHNldC5oYXMoaXApO1xuICB9IGNhdGNoIHsgcmV0dXJuIGZhbHNlOyB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbWFpbElzRGlzcG9zYWJsZShlbWFpbDogc3RyaW5nLCBmaWxlOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgaWYgKCFlbWFpbCkgcmV0dXJuIGZhbHNlO1xuICBjb25zdCBkb21haW4gPSBlbWFpbC5zcGxpdCgnQCcpWzFdPy50b0xvd2VyQ2FzZSgpO1xuICBpZiAoIWRvbWFpbikgcmV0dXJuIGZhbHNlO1xuICB0cnkge1xuICAgIGNvbnN0IHsgcmVhZEZpbGUgfSA9IGF3YWl0IGltcG9ydCgnZnMvcHJvbWlzZXMnKTtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVhZEZpbGUoZmlsZSwgJ3V0ZjgnKTtcbiAgICBpZiAoZG9tYWluID09PSAnenp6LmNvbScgfHwgZG9tYWluID09PSAnZ21haWwuY29tJykge1xuICAgICAgLy8gTG9nIGZpbGUgcGF0aFxuICAgICAgY29uc29sZS5sb2coJ1tESVNQT1NBQkxFIEZJTEUgUEFUSF0nLCBmaWxlKTtcbiAgICAgIC8vIExvZyBmaXJzdCBhbmQgbGFzdCAyMCBsaW5lc1xuICAgICAgY29uc3QgbGluZXMgPSBkYXRhLnNwbGl0KCdcXG4nKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbRElTUE9TQUJMRSBGSUxFIEhFQURdJywgbGluZXMuc2xpY2UoMCwgMjApKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbRElTUE9TQUJMRSBGSUxFIFRBSUxdJywgbGluZXMuc2xpY2UoLTIwKSk7XG4gICAgICAvLyBMb2cgbGFzdCAyMDAgY2hhcnNcbiAgICAgIGNvbnNvbGUubG9nKCdbRElTUE9TQUJMRSBSQVcgRklMRV0nLCBKU09OLnN0cmluZ2lmeShkYXRhLnNsaWNlKC0yMDApKSwgJ0xFTkdUSDonLCBkYXRhLmxlbmd0aCk7XG4gICAgfVxuICAgIC8vIERlZmVuc2l2ZTogdHJpbSBkb21haW4gYW5kIGFsbCBzZXQgdmFsdWVzXG4gICAgLy8gUmVtb3ZlIGludmlzaWJsZSBjaGFyYWN0ZXJzIGFuZCBub3JtYWxpemUgbGluZXNcbiAgICBjb25zdCBjbGVhbiA9IChzOiBzdHJpbmcpID0+IHMucmVwbGFjZSgvW1xcdTIwMEItXFx1MjAwRFxcdUZFRkZcXHJcXG5cXHQgXSsvZywgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3Qgc2V0ID0gbmV3IFNldChkYXRhLnNwbGl0KCdcXG4nKS5tYXAobCA9PiBjbGVhbihsKSkuZmlsdGVyKEJvb2xlYW4pKTtcbiAgICByZXR1cm4gc2V0LmhhcyhjbGVhbihkb21haW4pKTtcbiAgfSBjYXRjaCB7IHJldHVybiBmYWxzZTsgfVxufVxuXG5jb25zdCBDb2xsZWN0VmlzaXRvclNjaGVtYSA9IHoub2JqZWN0KHtcbiAgc2l0ZUtleTogei5zdHJpbmcoKSxcbiAgZmluZ2VycHJpbnRfaGFzaDogei5zdHJpbmcoKSxcbiAgdXNlckFnZW50OiB6LnN0cmluZygpLFxuICBsYW5ndWFnZTogei5zdHJpbmcoKSxcbiAgdGltZXpvbmU6IHouc3RyaW5nKCksXG4gIHJlc29sdXRpb246IHouc3RyaW5nKCksXG4gIHJlZmVycmVyOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGluY29nbml0bzogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcbiAgd2ViZHJpdmVyOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICB0aHVtYm1hcmtfc2lnbmFsczogei5hbnkoKS5vcHRpb25hbCgpLFxuICB0aHVtYm1hcmtfZGV0YWlsczogei5hbnkoKS5vcHRpb25hbCgpLFxuICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLm9wdGlvbmFsKCksXG4gIHBob25lOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIG5hbWU6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgYm90ZF9yZXN1bHQ6IHouYW55KCkub3B0aW9uYWwoKSxcbn0pXG5cbmltcG9ydCB7IHdpdGhDT1JTIH0gZnJvbSAnLi4vd2l0aENPUlMnO1xuXG5leHBvcnQgY29uc3QgT1BUSU9OUyA9IHdpdGhDT1JTKGFzeW5jIGZ1bmN0aW9uIE9QVElPTlMoKSB7XG4gIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKG51bGwsIHsgc3RhdHVzOiAyMDQgfSk7XG59KTtcblxuZnVuY3Rpb24gbm9ybWFsaXplQm90ZFJlc3VsdChib3RkOiBhbnkpIHtcbiAgaWYgKCFib3RkKSByZXR1cm4gdW5kZWZpbmVkO1xuICAvLyBJZiBCb3REIE9TUyByZXN1bHQgaXMganVzdCB7Ym90OiBmYWxzZX0sIG5vcm1hbGl6ZSB0byB7cmVzdWx0OiAnbm90RGV0ZWN0ZWQnfVxuICBpZiAodHlwZW9mIGJvdGQgPT09ICdvYmplY3QnICYmIGJvdGQgIT09IG51bGwgJiYgYm90ZC5ib3QgPT09IGZhbHNlKSB7XG4gICAgcmV0dXJuIHsgcmVzdWx0OiAnbm90RGV0ZWN0ZWQnIH07XG4gIH1cbiAgcmV0dXJuIGJvdGQ7XG59XG5cbmV4cG9ydCBjb25zdCBQT1NUID0gd2l0aENPUlMoYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKVxuICAgIGNvbnN0IHBhcnNlID0gQ29sbGVjdFZpc2l0b3JTY2hlbWEuc2FmZVBhcnNlKGJvZHkpXG4gICAgaWYgKCFwYXJzZS5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgYm9keScsIGRldGFpbHM6IHBhcnNlLmVycm9yLmVycm9ycyB9LCB7IHN0YXR1czogNDAwIH0pXG4gICAgfVxuICAgIGNvbnN0IHtcbiAgICAgIHNpdGVLZXksIGZpbmdlcnByaW50X2hhc2gsIHVzZXJBZ2VudCwgbGFuZ3VhZ2UsIHRpbWV6b25lLCByZXNvbHV0aW9uLCByZWZlcnJlciA9ICcnLCBpbmNvZ25pdG8gPSBmYWxzZSwgd2ViZHJpdmVyID0gZmFsc2UsIHRodW1ibWFya19zaWduYWxzLCBlbWFpbCwgcGhvbmUsIG5hbWUsIGJvdGRfcmVzdWx0XG4gICAgfSA9IHBhcnNlLmRhdGFcblxuICAgIC8vIElQIGRldGVjdGlvblxuICAgIGNvbnN0IGlwID0gKGhlYWRlcnMoKS5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpPy5zcGxpdCgnLCcpWzBdID8/IChyZXEgYXMgYW55KS5pcCA/PyAocmVxIGFzIGFueSkuc29ja2V0Py5yZW1vdGVBZGRyZXNzID8/ICcnKS50cmltKClcbiAgICBpZiAoIWlwKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0lQIG5vdCBmb3VuZCcgfSwgeyBzdGF0dXM6IDQwMCB9KVxuXG4gICAgLy8gT1NTIFRvci9Qcm94eS9EaXNwb3NhYmxlIEVtYWlsIGNoZWNrc1xuICAgIC8vIE9TUyBUb3IvUHJveHkvRGlzcG9zYWJsZSBFbWFpbCBjaGVja3MgKGFzeW5jLCByb2J1c3QpXG4gICAgLy8gVXNlIGNvcnJlY3QgcGF0aCBmb3IgZGlzcG9zYWJsZSBlbWFpbCBkb21haW5zXG4gICAgLy8gQ29ycmVjdCBwYXRoIHRvIGRpc3Bvc2FibGUtZW1haWwtZG9tYWlucy50eHQgZnJvbSBtb25vcmVwbyByb290XG4gICAgY29uc3QgZGlzcG9zYWJsZUZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksICcuLi8uLi9wYWNrYWdlcy9kaXNwb3NhYmxlLWVtYWlsLWRvbWFpbnMudHh0Jyk7XG4gICAgbGV0IGRlYnVnVGVtcEVtYWlsRG9tYWluID0gJyc7XG4gICAgbGV0IGRlYnVnVGVtcEVtYWlsUmVzdWx0ID0gZmFsc2U7XG4gICAgLy8gTG9nIHRoZSByZXNvbHZlZCBwYXRoIGFuZCBmaWxlIGV4aXN0ZW5jZVxuICAgIGNvbnN0IGZzID0gYXdhaXQgaW1wb3J0KCdmcycpO1xuICAgICAgICAgICAgaWYgKGVtYWlsKSB7XG4gICAgICBkZWJ1Z1RlbXBFbWFpbERvbWFpbiA9IGVtYWlsLnNwbGl0KCdAJylbMV0/LnRvTG93ZXJDYXNlKCk7XG4gICAgICBkZWJ1Z1RlbXBFbWFpbFJlc3VsdCA9IGF3YWl0IGVtYWlsSXNEaXNwb3NhYmxlKGVtYWlsLCBkaXNwb3NhYmxlRmlsZVBhdGgpO1xuICAgICAgICAgIH1cbiAgICBjb25zdCBbaXNUb3IsIGlzUHJveHldID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgaXBJbkxpc3QoaXAsIHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi8uLi9wYWNrYWdlcy90b3ItZXhpdC1ub2Rlcy50eHQnKSksXG4gICAgICBpcEluTGlzdChpcCwgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uL3BhY2thZ2VzL3Byb3h5LWxpc3QudHh0JykpXG4gICAgXSk7XG4gICAgY29uc3QgaXNUZW1wRW1haWwgPSBkZWJ1Z1RlbXBFbWFpbFJlc3VsdDtcblxuXG4gICAgLy8gUmF0ZSBsaW1pdFxuICAgIGNvbnN0IHJsID0gYXdhaXQgdG9rZW5CdWNrZXQoYHJsOiR7aXB9YCwgNjAsIDEpXG4gICAgaWYgKCFybC5hbGxvd2VkKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ3JhdGVfbGltaXRlZCcgfSwgeyBzdGF0dXM6IDQyOSB9KVxuXG4gICAgLy8gSVBJbmZvXG4gICAgY29uc3QgaW5mbyA9IGF3YWl0IGdldElQSW5mbyhpcClcblxuICAgIC8vIFRpbWV6b25lIG1pc21hdGNoIChNVlA6IGNvbXBhcmUgc3RyaW5nIHByZXNlbmNlKVxuICAgIGxldCB0aW1lem9uZU1pc21hdGNoID0gZmFsc2VcbiAgICBpZiAoaW5mbz8udGltZXpvbmUgJiYgdGltZXpvbmUpIHtcbiAgICAgIHRpbWV6b25lTWlzbWF0Y2ggPSBpbmZvLnRpbWV6b25lICE9PSB0aW1lem9uZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aW1lem9uZU1pc21hdGNoID0gdHJ1ZVxuICAgIH1cblxuICAgIC8vIEFidXNlSVBEQlxuICAgIGNvbnN0IGFidXNlID0gYXdhaXQgY2hlY2tBYnVzZUlQKGlwKVxuXG4gICAgLy8gVmVsb2NpdHlcbiAgICAvLyBVc2UgdmlzaXRvcl9pZCBmb3IgdmVsb2NpdHlDb3VudCBhcyBwZXIgc2NoZW1hXG4gICAgLy8gSWYgeW91IGRvIG5vdCBoYXZlIHZpc2l0b3JfaWQgZnJvbSB0aGUgcmVxdWVzdCwgZ2VuZXJhdGUgb25lIChVVUlEKSBvciBkZXJpdmUgaXQgZGV0ZXJtaW5pc3RpY2FsbHlcbiAgICAvLyBVc2UgZmluZ2VycHJpbnRfaGFzaCAob3IgdGh1bWJtYXJrIGhhc2gpIGFzIHN0YWJsZSB2aXNpdG9yX2lkIGlmIHBvc3NpYmxlXG4gICAgbGV0IHZpc2l0b3JfaWQgPSBmaW5nZXJwcmludF9oYXNoO1xuICAgIC8vIElmIG5vdCBhIHZhbGlkIFVVSUQsIGNyZWF0ZSBhIGRldGVybWluaXN0aWMgVVVJRCBmcm9tIHRoZSBoYXNoXG4gICAgY29uc3QgdXVpZFZhbGlkYXRlID0gKHY6IHN0cmluZykgPT4gL15bMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMS01XVswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfSQvaS50ZXN0KHYpO1xuICAgIGlmICghdXVpZFZhbGlkYXRlKHZpc2l0b3JfaWQpKSB7XG4gICAgICAvLyBVc2UgYSBkZXRlcm1pbmlzdGljIFVVSUQgYmFzZWQgb24gdGhlIGhhc2ggKHY1LCBidXQgc2ltcGxlIGZhbGxiYWNrIGhlcmUpXG4gICAgICBjb25zdCBOQU1FU1BBQ0UgPSAnNmJhN2I4MTAtOWRhZC0xMWQxLTgwYjQtMDBjMDRmZDQzMGM4JzsgLy8gRE5TIG5hbWVzcGFjZVxuICAgICAgdmlzaXRvcl9pZCA9IHV1aWR2NShmaW5nZXJwcmludF9oYXNoLCBOQU1FU1BBQ0UpO1xuICAgIH1cbiAgICBjb25zdCB2ID0gYXdhaXQgdmVsb2NpdHlDb3VudChzdXBhYmFzZVNlcnZlciwgc2l0ZUtleSwgdmlzaXRvcl9pZCwgNjApXG5cbiAgICAvLyBDb21wdXRlIHJpc2tcbiAgICBjb25zdCB2cG5EZXRlY3RlZCA9IGluZm8/LnByaXZhY3k/LnZwbiB8fCBpbmZvPy5wcml2YWN5Py5ob3N0aW5nIHx8IGZhbHNlXG4gICAgY29uc3QgeyBzY29yZSwgdmVyZGljdCB9ID0gY29tcHV0ZVJpc2soe1xuICAgICAgaW5jb2duaXRvLFxuICAgICAgdnBuOiB2cG5EZXRlY3RlZCxcbiAgICAgIHRpbWV6b25lTWlzbWF0Y2gsXG4gICAgICB3ZWJkcml2ZXIsXG4gICAgICBhYnVzZUxpc3RlZDogYWJ1c2UuYmxvY2tsaXN0ZWQsXG4gICAgICB2ZWxvY2l0eUNvdW50OiB2XG4gICAgfSlcblxuICAgIC8vIE1hbnVhbCBibG9ja2xpc3RcbiAgICBsZXQgYWN0aW9uID0gJ21hbnVhbF9yZXZpZXcnXG4gICAgbGV0IG1hbnVhbEJsb2NrID0gZmFsc2VcbiAgICBsZXQgYmxvY2tJZDogc3RyaW5nIHwgbnVsbCA9IG51bGxcbiAgICBsZXQgYmxvY2tSZWFzb246IHN0cmluZyB8IG51bGwgPSBudWxsXG4gICAgbGV0IHN1c3BpY2lvdXNSZWFzb246IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIGxldCBzdXNwaWNpb3VzOiBib29sZWFuID0gZmFsc2U7XG4gICAgY29uc3QgeyBkYXRhOiBibG9ja3MgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXG4gICAgICAuZnJvbSgnbWFudWFsX2Jsb2NrcycpXG4gICAgICAuc2VsZWN0KCdpZCxyZWFzb24nKVxuICAgICAgLmVxKCdzaXRlX2tleScsIHNpdGVLZXkpXG4gICAgICAub3IoYGZpbmdlcnByaW50X2hhc2guZXEuJHtmaW5nZXJwcmludF9oYXNofSxpcC5lcS4ke2lwfWApXG4gICAgICAuaXMoJ2V4cGlyZXNfYXQnLCBudWxsKVxuICAgICAgLmxpbWl0KDEpXG4gICAgaWYgKGJsb2NrcyAmJiBibG9ja3MubGVuZ3RoID4gMCkge1xuICAgICAgbWFudWFsQmxvY2sgPSB0cnVlXG4gICAgICBibG9ja0lkID0gYmxvY2tzWzBdLmlkXG4gICAgICBibG9ja1JlYXNvbiA9IGJsb2Nrc1swXS5yZWFzb25cbiAgICB9XG4gICAgbGV0IGZpbmFsU2NvcmUgPSBzY29yZVxuICAgIGxldCBmaW5hbFZlcmRpY3QgPSB2ZXJkaWN0XG4gICAgaWYgKG1hbnVhbEJsb2NrKSB7XG4gICAgICBhY3Rpb24gPSAnYXV0b19ibG9jaydcbiAgICAgIGZpbmFsU2NvcmUgPSAxMDBcbiAgICAgIGZpbmFsVmVyZGljdCA9ICdoaWdoJ1xuICAgIH1cblxuICAgIC8vIExvb2t1cCBzaXRlX2lkLCByZXBlYXRfc2lnbnVwX2xpbWl0LCB1c2VyX2lkLCBhbmQgdHJpYWwgYWJ1c2Ugc2V0dGluZ3MgZnJvbSBzaXRlcyB0YWJsZSB1c2luZyBhcGlfa2V5XG4gICAgY29uc3QgeyBkYXRhOiBzaXRlUm93LCBlcnJvcjogc2l0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlci5mcm9tKCdzaXRlcycpLnNlbGVjdCgnaWQsIHJlcGVhdF9zaWdudXBfbGltaXQsIHVzZXJfaWQsIGF1dG9fYmxvY2tfdHJpYWxfYWJ1c2UsIHRyaWFsX2FidXNlX3RocmVzaG9sZCcpLmVxKCdhcGlfa2V5Jywgc2l0ZUtleSkubWF5YmVTaW5nbGUoKTtcbiAgICBjb25zb2xlLmxvZygnW0RFQlVHIHNpdGVLZXldJywgc2l0ZUtleSk7XG4gICAgY29uc29sZS5sb2coJ1tERUJVRyBzaXRlUm93IEZVTExdJywgSlNPTi5zdHJpbmdpZnkoc2l0ZVJvdykpO1xuICAgIGNvbnNvbGUubG9nKCdbREVCVUcgc2l0ZVJvdy5hdXRvX2Jsb2NrX3RyaWFsX2FidXNlXScsIHNpdGVSb3cgPyBzaXRlUm93LmF1dG9fYmxvY2tfdHJpYWxfYWJ1c2UgOiB1bmRlZmluZWQpO1xuICAgIGNvbnNvbGUubG9nKCdbREVCVUcgc2l0ZUVycm9yXScsIHNpdGVFcnJvcik7XG4gICAgaWYgKCFzaXRlUm93IHx8IHNpdGVFcnJvcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdpbnZhbGlkX3NpdGVfa2V5JywgZGV0YWlsczogJ1NpdGUgbm90IGZvdW5kIGZvciBwcm92aWRlZCBzaXRlS2V5JyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cbiAgICBjb25zdCBhdXRvQmxvY2tUcmlhbEFidXNlID0gc2l0ZVJvdy5hdXRvX2Jsb2NrX3RyaWFsX2FidXNlID8/IGZhbHNlO1xuICAgIGNvbnN0IHRyaWFsQWJ1c2VUaHJlc2hvbGQgPSBzaXRlUm93LnRyaWFsX2FidXNlX3RocmVzaG9sZCA/PyAyOyAvLyBEZWZhdWx0IHRocmVzaG9sZCA9IDJcblxuICAgIC8vIENoZWNrIEFQSSB1c2FnZSBxdW90YSBCRUZPUkUgcnVubmluZyBJUEluZm8gb3IgZXZlbnQgaW5zZXJ0XG4gICAgbGV0IHF1b3RhRXhjZWVkZWQgPSBmYWxzZTtcbiAgICBpZiAoc2l0ZVJvdy51c2VyX2lkKSB7XG4gICAgICBjb25zdCB7IGRhdGE6IHVzYWdlUm93cywgZXJyb3I6IHVzYWdlRmV0Y2hFcnIgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXG4gICAgICAgIC5mcm9tKCd1c2VyX2FwaV91c2FnZScpXG4gICAgICAgIC5zZWxlY3QoJ3VzZWQsIHF1b3RhLCBjeWNsZV9lbmQnKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCBzaXRlUm93LnVzZXJfaWQpXG4gICAgICAgIC5saW1pdCgxKTtcbiAgICAgIGlmICh1c2FnZUZldGNoRXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDT0xMRUNULVZJU0lUT1JdW1VTQUdFXSBGYWlsZWQgdG8gZmV0Y2ggdXNhZ2Ugcm93OicsIHVzYWdlRmV0Y2hFcnIsIHsgdXNlcl9pZDogc2l0ZVJvdy51c2VyX2lkIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHVzYWdlUm93cyAmJiB1c2FnZVJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCB7IHVzZWQsIHF1b3RhLCBjeWNsZV9lbmQgfSA9IHVzYWdlUm93c1swXTtcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKCFjeWNsZV9lbmQgfHwgbmV3IERhdGUoY3ljbGVfZW5kKSA8IG5vdykge1xuICAgICAgICAgIHF1b3RhRXhjZWVkZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHF1b3RhID4gMCAmJiB1c2VkID49IHF1b3RhKSB7XG4gICAgICAgICAgcXVvdGFFeGNlZWRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1b3RhRXhjZWVkZWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAncXVvdGFfZXhjZWVkZWQnLCBkZXRhaWxzOiAnQVBJIHF1b3RhIHJlYWNoZWQgZm9yIHRoaXMgYWNjb3VudC4nIH0sIHsgc3RhdHVzOiA0MjkgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBzZXJ0IHZpc2l0b3IgYmVmb3JlIGluc2VydGluZyBldmVudCB0byBzYXRpc2Z5IEZLIGNvbnN0cmFpbnRcbiAgICBjb25zdCB7IGRhdGE6IHVwc2VydGVkVmlzaXRvciwgZXJyb3I6IHVwc2VydFZpc2l0b3JFcnIgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyLmZyb20oJ3Zpc2l0b3JzJykudXBzZXJ0KHtcbiAgICAgIGlkOiB2aXNpdG9yX2lkLCAvLyBtdXN0IGJlIFVVSURcbiAgICAgIHNpdGVfaWQ6IHNpdGVSb3cuaWQsXG4gICAgICB2aXNpdG9yX2lkOiB2aXNpdG9yX2lkLCAvLyBrZWVwIGFzIFVVSURcbiAgICAgIGZpbmdlcnByaW50OiBmaW5nZXJwcmludF9oYXNoLFxuICAgICAgdGh1bWJtYXJrOiB0aHVtYm1hcmtfc2lnbmFscz8uaGFzaCB8fCAnJyxcbiAgICAgIHVzZXJfYWdlbnQ6IHVzZXJBZ2VudCxcbiAgICAgIHNjcmVlbl9yZXNvbHV0aW9uOiByZXNvbHV0aW9uLFxuICAgICAgdGltZXpvbmUsXG4gICAgICBsYW5ndWFnZSxcbiAgICAgIHBsYXRmb3JtOiAnJyxcbiAgICAgIGlwX2FkZHJlc3M6IGlwLFxuICAgICAgY291bnRyeTogaW5mbz8uY291bnRyeSA/PyAnJyxcbiAgICAgIGNpdHk6IGluZm8/LmNpdHkgPz8gJycsXG4gICAgICByZWdpb246IGluZm8/LnJlZ2lvbiA/PyAnJyxcbiAgICAgIGlzcDogaW5mbz8ub3JnID8/ICcnLFxuICAgICAgaXNfYm90OiBmYWxzZSxcbiAgICAgIGVtYWlsOiBlbWFpbCB8fCBudWxsLFxuICAgICAgcGhvbmU6IHBob25lIHx8IG51bGwsXG4gICAgICBuYW1lOiBuYW1lIHx8IG51bGwsXG4gICAgICByaXNrX3Njb3JlOiAwLFxuICAgICAgaXNfdG9yOiBpc1RvcixcbiAgICAgIGlzX3Byb3h5OiBpc1Byb3h5LFxuICAgICAgaXNfdGVtcF9lbWFpbDogaXNUZW1wRW1haWxcbiAgICB9LCB7IG9uQ29uZmxpY3Q6ICdpZCcgfSk7XG4gICAgY29uc29sZS5sb2coJ1tERUJVRyB1cHNlcnRlZFZpc2l0b3JdJywgdXBzZXJ0ZWRWaXNpdG9yKTtcbiAgICBjb25zb2xlLmxvZygnW0RFQlVHIHVwc2VydFZpc2l0b3JFcnJdJywgdXBzZXJ0VmlzaXRvckVycik7XG4gICAgaWYgKHVwc2VydFZpc2l0b3JFcnIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnZGJfdXBzZXJ0X3Zpc2l0b3JfZmFpbGVkJywgZGV0YWlsczogdXBzZXJ0VmlzaXRvckVyci5tZXNzYWdlIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuICAgIC8vIFtUUklBTCBBQlVTRSBCTE9DSyBMT0dJQ10gQ291bnQgdW5pcXVlIGVtYWlscyBmb3IgdGhpcyBmaW5nZXJwcmludC9zaXRlIEJFRk9SRSBldmVudCBpbnNlcnRcbiAgICBpZiAoZW1haWwgJiYgZmluZ2VycHJpbnRfaGFzaCkge1xuICAgICAgLy8gSW5zZXJ0IG5ldyBlbWFpbCBpbnRvIHZpc2l0b3JfZW1haWxzIGlmIG5vdCBhbHJlYWR5IHByZXNlbnRcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdFbWFpbCwgZXJyb3I6IGVtYWlsTG9va3VwRXJyIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxuICAgICAgICAuZnJvbSgndmlzaXRvcl9lbWFpbHMnKVxuICAgICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAgIC5lcSgnc2l0ZV9pZCcsIHNpdGVSb3cuaWQpXG4gICAgICAgIC5lcSgnZmluZ2VycHJpbnQnLCBmaW5nZXJwcmludF9oYXNoKVxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgLm1heWJlU2luZ2xlKCk7XG4gICAgICBpZiAoIWVtYWlsTG9va3VwRXJyICYmICFleGlzdGluZ0VtYWlsKSB7XG4gICAgICAgIGF3YWl0IHN1cGFiYXNlU2VydmVyLmZyb20oJ3Zpc2l0b3JfZW1haWxzJykuaW5zZXJ0KHtcbiAgICAgICAgICBzaXRlX2lkOiBzaXRlUm93LmlkLFxuICAgICAgICAgIGZpbmdlcnByaW50OiBmaW5nZXJwcmludF9oYXNoLFxuICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIC8vIENvdW50IHVuaXF1ZSBlbWFpbHMgZnJvbSB2aXNpdG9yX2VtYWlsc1xuICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbFJvd3MsIGVycm9yOiBlbWFpbEVyciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcbiAgICAgICAgLmZyb20oJ3Zpc2l0b3JfZW1haWxzJylcbiAgICAgICAgLnNlbGVjdCgnZW1haWwnKVxuICAgICAgICAuZXEoJ3NpdGVfaWQnLCBzaXRlUm93LmlkKVxuICAgICAgICAuZXEoJ2ZpbmdlcnByaW50JywgZmluZ2VycHJpbnRfaGFzaCk7XG4gICAgICBjb25zb2xlLmxvZygnW0RFQlVHIHRyaWFsIGFidXNlIHZpc2l0b3JfZW1haWxzXSBlbWFpbFJvd3M6JywgZW1haWxSb3dzKTtcbiAgICAgIGlmICghZW1haWxFcnIgJiYgZW1haWxSb3dzKSB7XG4gICAgICAgIGNvbnN0IHVuaXF1ZUVtYWlscyA9IEFycmF5LmZyb20obmV3IFNldChlbWFpbFJvd3MubWFwKChyOiBhbnkpID0+IChyLmVtYWlsIHx8ICcnKS50b0xvd2VyQ2FzZSgpKS5maWx0ZXIoQm9vbGVhbikpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1tERUJVRyB0cmlhbCBhYnVzZSB2aXNpdG9yX2VtYWlsc10gdW5pcXVlRW1haWxzOicsIHVuaXF1ZUVtYWlscywgJ2xlbmd0aDonLCB1bmlxdWVFbWFpbHMubGVuZ3RoLCAndGhyZXNob2xkOicsIHRyaWFsQWJ1c2VUaHJlc2hvbGQsICdhdXRvQmxvY2tUcmlhbEFidXNlOicsIGF1dG9CbG9ja1RyaWFsQWJ1c2UpO1xuICAgICAgICAvLyBJZiB0aHJlc2hvbGQgcmVhY2hlZCBvciBleGNlZWRlZFxuICAgICAgICBpZiAodW5pcXVlRW1haWxzLmxlbmd0aCA+PSB0cmlhbEFidXNlVGhyZXNob2xkKSB7XG4gICAgICAgICAgaWYgKGF1dG9CbG9ja1RyaWFsQWJ1c2UpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGFscmVhZHkgYmxvY2tlZCBmb3IgdHJpYWwgYWJ1c2VcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdCbG9jaywgZXJyb3I6IGJsb2NrRXJyIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxuICAgICAgICAgICAgICAuZnJvbSgnbWFudWFsX2Jsb2NrcycpXG4gICAgICAgICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgICAgLmVxKCdzaXRlX2tleScsIHNpdGVLZXkpXG4gICAgICAgICAgICAgIC5lcSgnZmluZ2VycHJpbnRfaGFzaCcsIGZpbmdlcnByaW50X2hhc2gpXG4gICAgICAgICAgICAgIC5lcSgncmVhc29uJywgJ3RyaWFsIGFidXNlOiBtdWx0aXBsZSBlbWFpbHMnKVxuICAgICAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbREVCVUcgdHJpYWwgYWJ1c2UgdmlzaXRvcl9lbWFpbHNdIGJsb2NrRXJyOicsIGJsb2NrRXJyLCAnZXhpc3RpbmdCbG9jazonLCBleGlzdGluZ0Jsb2NrKTtcbiAgICAgICAgICAgIGlmICghYmxvY2tFcnIgJiYgIWV4aXN0aW5nQmxvY2spIHtcbiAgICAgICAgICAgICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0QmxvY2tFcnIsIGRhdGE6IGluc2VydEJsb2NrRGF0YSB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXIuZnJvbSgnbWFudWFsX2Jsb2NrcycpLmluc2VydCh7XG4gICAgICAgICAgICAgICAgZmluZ2VycHJpbnRfaGFzaCxcbiAgICAgICAgICAgICAgICByZWFzb246ICd0cmlhbCBhYnVzZTogbXVsdGlwbGUgZW1haWxzJyxcbiAgICAgICAgICAgICAgICBzaXRlX2tleTogc2l0ZUtleVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tERUJVRyB0cmlhbCBhYnVzZSB2aXNpdG9yX2VtYWlsc10gYmxvY2sgaW5zZXJ0IGVycm9yOicsIGluc2VydEJsb2NrRXJyLCAnYmxvY2sgaW5zZXJ0IGRhdGE6JywgaW5zZXJ0QmxvY2tEYXRhKTtcbiAgICAgICAgICAgICAgbWFudWFsQmxvY2sgPSB0cnVlO1xuICAgICAgICAgICAgICBibG9ja1JlYXNvbiA9ICd0cmlhbCBhYnVzZTogbXVsdGlwbGUgZW1haWxzJztcbiAgICAgICAgICAgICAgYWN0aW9uID0gJ2F1dG9fYmxvY2snO1xuICAgICAgICAgICAgICBmaW5hbFNjb3JlID0gMTAwO1xuICAgICAgICAgICAgICBmaW5hbFZlcmRpY3QgPSAnaGlnaCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICghbWFudWFsQmxvY2spIHtcbiAgICAgICAgICAgIHN1c3BpY2lvdXMgPSB0cnVlO1xuICAgICAgICAgICAgc3VzcGljaW91c1JlYXNvbiA9IGBNdWx0aXBsZSBlbWFpbHMgKCR7dW5pcXVlRW1haWxzLmxlbmd0aH0pIGZvciBzYW1lIGZpbmdlcnByaW50YDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbREVCVUcgdHJpYWwgYWJ1c2UgdmlzaXRvcl9lbWFpbHNdIGVtYWlsRXJyOicsIGVtYWlsRXJyKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gLS0tIEV2ZW50IGluc2VydCBsb2dpYyBTVEFSVCAtLS1cbiAgICAvLyBGZXRjaCBhbmQgaW5jcmVtZW50IHZpc2l0X2NvdW50XG4gICAgbGV0IG5ld1Zpc2l0Q291bnQgPSAxO1xuICAgIGNvbnN0IHsgZGF0YTogdmlzaXRvclJvdywgZXJyb3I6IHZpc2l0b3JGZXRjaEVyciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcbiAgICAgIC5mcm9tKCd2aXNpdG9ycycpXG4gICAgICAuc2VsZWN0KCd2aXNpdF9jb3VudCcpXG4gICAgICAuZXEoJ2lkJywgdmlzaXRvcl9pZClcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xuICAgIGlmICghdmlzaXRvckZldGNoRXJyICYmIHZpc2l0b3JSb3cgJiYgdHlwZW9mIHZpc2l0b3JSb3cudmlzaXRfY291bnQgPT09ICdudW1iZXInKSB7XG4gICAgICBuZXdWaXNpdENvdW50ID0gdmlzaXRvclJvdy52aXNpdF9jb3VudCArIDE7XG4gICAgICBhd2FpdCBzdXBhYmFzZVNlcnZlclxuICAgICAgICAuZnJvbSgndmlzaXRvcnMnKVxuICAgICAgICAudXBkYXRlKHsgdmlzaXRfY291bnQ6IG5ld1Zpc2l0Q291bnQsIGxhc3Rfc2VlbjogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pXG4gICAgICAgIC5lcSgnaWQnLCB2aXNpdG9yX2lkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZmFsbGJhY2s6IHNldCB0byAxIGlmIG5vdCBmb3VuZCBvciBlcnJvclxuICAgICAgYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcbiAgICAgICAgLmZyb20oJ3Zpc2l0b3JzJylcbiAgICAgICAgLnVwZGF0ZSh7IHZpc2l0X2NvdW50OiAxLCBsYXN0X3NlZW46IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KVxuICAgICAgICAuZXEoJ2lkJywgdmlzaXRvcl9pZCk7XG4gICAgfVxuICAgIC8vIEluc2VydCBldmVudCBhbmQgZ2V0IElEXG4gICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZEV2ZW50LCBlcnJvcjogaW5zZXJ0RXJyIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlci5mcm9tKCdldmVudHMnKS5pbnNlcnQoe1xuICAgICAgc2l0ZV9pZDogc2l0ZVJvdy5pZCxcbiAgICAgIHZpc2l0b3JfaWQsXG4gICAgICBldmVudF90eXBlOiAncGFnZV92aWV3JyxcbiAgICAgIGV2ZW50X25hbWU6ICdwYWdlX3ZpZXcnLFxuICAgICAgdXJsOiAnJyxcbiAgICAgIHJlZmVycmVyLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBmaW5nZXJwcmludF9oYXNoLFxuICAgICAgICB0aHVtYm1hcmtfc2lnbmFscyxcbiAgICAgICAgdGh1bWJtYXJrX2RldGFpbHM6IGJvZHkudGh1bWJtYXJrX2RldGFpbHMgfHwge30sXG4gICAgICAgIHJpc2tfc2NvcmU6IGZpbmFsU2NvcmUsXG4gICAgICAgIHZlcmRpY3Q6IGZpbmFsVmVyZGljdCxcbiAgICAgICAgaXAsXG4gICAgICAgIGlwX2NpdHk6IGluZm8/LmNpdHkgPz8gJycsXG4gICAgICAgIGlwX2NvdW50cnk6IGluZm8/LmNvdW50cnkgPz8gJycsXG4gICAgICAgIGlwX29yZzogaW5mbz8ub3JnID8/ICcnLFxuICAgICAgICBlbWFpbDogYm9keS5lbWFpbCB8fCB1bmRlZmluZWQsXG4gICAgICAgIGJvdGRfcmVzdWx0OiBub3JtYWxpemVCb3RkUmVzdWx0KGJvZHkuYm90ZF9yZXN1bHQpLFxuICAgICAgICBpc190b3I6IGlzVG9yLFxuICAgICAgICBpc19wcm94eTogaXNQcm94eSxcbiAgICAgICAgaXNfdGVtcF9lbWFpbDogISFpc1RlbXBFbWFpbCxcbiAgICAgICAgdnBuRGV0ZWN0ZWQsXG4gICAgICAgIGlzX2JvdDogZmFsc2UsXG4gICAgICAgIGJyb3dzZXI6IGJvZHkuYnJvd3NlciB8fCAnJyxcbiAgICAgICAgb3M6IGJvZHkub3MgfHwgJycsXG4gICAgICAgIHJlc29sdXRpb246IGJvZHkucmVzb2x1dGlvbiB8fCAnJyxcbiAgICAgICAgdGltZXpvbmU6IGJvZHkudGltZXpvbmUgfHwgJycsXG4gICAgICAgIHVzZXJBZ2VudDogYm9keS51c2VyQWdlbnQgfHwgJycsXG4gICAgICAgIHNpZ25hbHM6IEFycmF5LmlzQXJyYXkoYm9keS5zaWduYWxzKSA/IGJvZHkuc2lnbmFscyA6IChib2R5LnRodW1ibWFya19zaWduYWxzPy5zaWduYWxzIHx8IFtdKSxcbiAgICAgICAgZ3BzX2xvY2F0aW9uOiBib2R5LmdlbyAmJiBib2R5Lmdlby5sYXQgJiYgYm9keS5nZW8ubG9uID8geyBsYXQ6IGJvZHkuZ2VvLmxhdCwgbG9uOiBib2R5Lmdlby5sb24sIGFjY3VyYWN5OiBib2R5Lmdlby5hY2N1cmFjeSB9IDogdW5kZWZpbmVkLFxuICAgICAgICBncHNfcGVybWlzc2lvbjogYm9keS5nZW8/LnBlcm1pc3Npb24sXG4gICAgICAgIGVtdWxhdG9yX2RldGVjdGVkOiAhIWJvZHkuZW11bGF0b3I/LmlzRW11bGF0b3IsXG4gICAgICAgIGVtdWxhdG9yX3JlYXNvbnM6IGJvZHkuZW11bGF0b3I/LnJlYXNvbnMgfHwgW10sXG4gICAgICAgIGdlb19taXNtYXRjaDogKGJvZHkuZ2VvICYmIGJvZHkuZ2VvLmxhdCAmJiBib2R5Lmdlby5sb24gJiYgaW5mbyAmJiBpbmZvLmxvYykgPyAoTWF0aC5hYnMoYm9keS5nZW8ubGF0IC0gaW5mby5sb2NbMF0pID4gMC41IHx8IE1hdGguYWJzKGJvZHkuZ2VvLmxvbiAtIGluZm8ubG9jWzFdKSA+IDAuNSkgOiBmYWxzZSxcbiAgICAgICAgbG9jYXRpb25fc3Bvb2ZlZDogKGJvZHkuZ2VvICYmIGJvZHkuZ2VvLmxhdCAmJiBib2R5Lmdlby5sb24gJiYgaW5mbyAmJiBpbmZvLmxvYykgPyAoTWF0aC5hYnMoYm9keS5nZW8ubGF0IC0gaW5mby5sb2NbMF0pID4gMS41IHx8IE1hdGguYWJzKGJvZHkuZ2VvLmxvbiAtIGluZm8ubG9jWzFdKSA+IDEuNSkgOiBmYWxzZSxcbiAgICAgICAgc3VzcGljaW91cyxcbiAgICAgICAgc3VzcGljaW91c1JlYXNvbixcbiAgICAgICAgdmlzaXRfY291bnQ6IG5ld1Zpc2l0Q291bnRcbiAgICAgIH0sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH0pLnNlbGVjdCgnaWQnKS5zaW5nbGUoKTtcbiAgICBpZiAoaW5zZXJ0RXJyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ2RiX2luc2VydF9mYWlsZWQnLCBkZXRhaWxzOiBpbnNlcnRFcnIubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cbiAgICAvLyAtLS0gRXZlbnQgaW5zZXJ0IGxvZ2ljIEVORCAtLS1cblxuICAgICAgY29uc3QgeyBkYXRhOiB1c2FnZVJvd3MsIGVycm9yOiB1c2FnZUZldGNoRXJyIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxuICAgICAgICAuZnJvbSgndXNlcl9hcGlfdXNhZ2UnKVxuICAgICAgICAuc2VsZWN0KCd1c2VkLCBxdW90YSwgY3ljbGVfZW5kJylcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgc2l0ZVJvdy51c2VyX2lkKVxuICAgICAgICAubGltaXQoMSk7XG4gICAgICBpZiAodXNhZ2VGZXRjaEVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbQ09MTEVDVC1WSVNJVE9SXVtVU0FHRV0gRmFpbGVkIHRvIGZldGNoIHVzYWdlIHJvdzonLCB1c2FnZUZldGNoRXJyLCB7IHVzZXJfaWQ6IHNpdGVSb3cudXNlcl9pZCB9KTtcbiAgICAgIH1cbiAgICAgIGlmICh1c2FnZVJvd3MgJiYgdXNhZ2VSb3dzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgeyB1c2VkLCBxdW90YSwgY3ljbGVfZW5kIH0gPSB1c2FnZVJvd3NbMF07XG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmICghY3ljbGVfZW5kIHx8IG5ldyBEYXRlKGN5Y2xlX2VuZCkgPCBub3cpIHtcbiAgICAgICAgICBxdW90YUV4Y2VlZGVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChxdW90YSA+IDAgJiYgdXNlZCA+PSBxdW90YSkge1xuICAgICAgICAgIHF1b3RhRXhjZWVkZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAvLyBDb3VudCB1bmlxdWUgZW1haWxzIGZvciB0aGlzIGZpbmdlcnByaW50L3NpdGVcbiAgICBpZiAoZW1haWwgJiYgZmluZ2VycHJpbnRfaGFzaCkge1xuICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbFJvd3MsIGVycm9yOiBlbWFpbEVyciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcbiAgICAgICAgLmZyb20oJ3Zpc2l0b3JzJylcbiAgICAgICAgLnNlbGVjdCgnZW1haWwnKVxuICAgICAgICAuZXEoJ3NpdGVfaWQnLCBzaXRlUm93LmlkKVxuICAgICAgICAuZXEoJ2ZpbmdlcnByaW50JywgZmluZ2VycHJpbnRfaGFzaClcbiAgICAgICAgLm5lcSgnZW1haWwnLCBudWxsKTtcbiAgICAgIGlmICghZW1haWxFcnIgJiYgZW1haWxSb3dzKSB7XG4gICAgICAgIGNvbnN0IHVuaXF1ZUVtYWlscyA9IEFycmF5LmZyb20obmV3IFNldChlbWFpbFJvd3MubWFwKChyOiBhbnkpID0+IChyLmVtYWlsIHx8ICcnKS50b0xvd2VyQ2FzZSgpKS5maWx0ZXIoQm9vbGVhbikpKTtcbiAgICAgICAgLy8gSWYgdGhyZXNob2xkIHJlYWNoZWQgb3IgZXhjZWVkZWRcbiAgICAgICAgaWYgKHVuaXF1ZUVtYWlscy5sZW5ndGggPj0gdHJpYWxBYnVzZVRocmVzaG9sZCkge1xuICAgICAgICAgIGlmIChhdXRvQmxvY2tUcmlhbEFidXNlKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBhbHJlYWR5IGJsb2NrZWQgZm9yIHRyaWFsIGFidXNlXG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nQmxvY2ssIGVycm9yOiBibG9ja0VyciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcbiAgICAgICAgICAgICAgLmZyb20oJ21hbnVhbF9ibG9ja3MnKVxuICAgICAgICAgICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAgICAgICAgIC5lcSgnc2l0ZV9rZXknLCBzaXRlS2V5KVxuICAgICAgICAgICAgICAuZXEoJ2ZpbmdlcnByaW50X2hhc2gnLCBmaW5nZXJwcmludF9oYXNoKVxuICAgICAgICAgICAgICAuZXEoJ3JlYXNvbicsICd0cmlhbCBhYnVzZTogbXVsdGlwbGUgZW1haWxzJylcbiAgICAgICAgICAgICAgLm1heWJlU2luZ2xlKCk7XG4gICAgICAgICAgICBpZiAoIWJsb2NrRXJyICYmICFleGlzdGluZ0Jsb2NrKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlU2VydmVyLmZyb20oJ21hbnVhbF9ibG9ja3MnKS5pbnNlcnQoe1xuICAgICAgICAgICAgICAgIGZpbmdlcnByaW50X2hhc2gsXG4gICAgICAgICAgICAgICAgcmVhc29uOiAndHJpYWwgYWJ1c2U6IG11bHRpcGxlIGVtYWlscycsXG4gICAgICAgICAgICAgICAgc2l0ZV9rZXk6IHNpdGVLZXlcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIG1hbnVhbEJsb2NrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgYmxvY2tSZWFzb24gPSAndHJpYWwgYWJ1c2U6IG11bHRpcGxlIGVtYWlscyc7XG4gICAgICAgICAgICAgIGFjdGlvbiA9ICdhdXRvX2Jsb2NrJztcbiAgICAgICAgICAgICAgZmluYWxTY29yZSA9IDEwMDtcbiAgICAgICAgICAgICAgZmluYWxWZXJkaWN0ID0gJ2hpZ2gnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoIW1hbnVhbEJsb2NrKSB7XG4gICAgICAgICAgICBzdXNwaWNpb3VzID0gdHJ1ZTtcbiAgICAgICAgICAgIHN1c3BpY2lvdXNSZWFzb24gPSBgTXVsdGlwbGUgZW1haWxzICgke3VuaXF1ZUVtYWlscy5sZW5ndGh9KSBmb3Igc2FtZSBmaW5nZXJwcmludGA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEluY3JlbWVudCBBUEkgdXNhZ2UgZm9yIHRoaXMgdXNlclxuICAgIHRyeSB7XG4gICAgICBpZiAoc2l0ZVJvdy51c2VyX2lkKSB7XG4gICAgICAgIC8vIFRyeSB0byBpbmNyZW1lbnQgdXNlZFxuICAgICAgICBjb25zdCB7IGRhdGE6IHVzYWdlUm93cywgZXJyb3I6IHVzYWdlRmV0Y2hFcnIgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXG4gICAgICAgICAgLmZyb20oJ3VzZXJfYXBpX3VzYWdlJylcbiAgICAgICAgICAuc2VsZWN0KCd1c2VkLCBxdW90YScpXG4gICAgICAgICAgLmVxKCd1c2VyX2lkJywgc2l0ZVJvdy51c2VyX2lkKVxuICAgICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgaWYgKHVzYWdlRmV0Y2hFcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQ09MTEVDVC1WSVNJVE9SXVtVU0FHRV0gRmFpbGVkIHRvIGZldGNoIHVzYWdlIHJvdzonLCB1c2FnZUZldGNoRXJyLCB7IHVzZXJfaWQ6IHNpdGVSb3cudXNlcl9pZCB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXNhZ2VSb3dzICYmIHVzYWdlUm93cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc3QgY3VycmVudFVzZWQgPSB1c2FnZVJvd3NbMF0udXNlZCB8fCAwO1xuICAgICAgICAgIGNvbnN0IHF1b3RhID0gdXNhZ2VSb3dzWzBdLnF1b3RhIHx8IDA7XG4gICAgICAgICAgY29uc3QgeyBlcnJvcjogdXNhZ2VVcGRhdGVFcnIgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXG4gICAgICAgICAgICAuZnJvbSgndXNlcl9hcGlfdXNhZ2UnKVxuICAgICAgICAgICAgLnVwZGF0ZSh7IHVzZWQ6IGN1cnJlbnRVc2VkICsgMSwgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pXG4gICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCBzaXRlUm93LnVzZXJfaWQpO1xuICAgICAgICAgIGlmICh1c2FnZVVwZGF0ZUVycikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0NPTExFQ1QtVklTSVRPUl1bVVNBR0VdIEZhaWxlZCB0byBpbmNyZW1lbnQgdXNhZ2U6JywgdXNhZ2VVcGRhdGVFcnIsIHsgdXNlcl9pZDogc2l0ZVJvdy51c2VyX2lkIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBJbnNlcnQgbmV3IHVzYWdlIHJvdyBpZiBub3QgcHJlc2VudFxuICAgICAgICAgIGNvbnN0IHsgZXJyb3I6IHVzYWdlSW5zZXJ0RXJyIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxuICAgICAgICAgICAgLmZyb20oJ3VzZXJfYXBpX3VzYWdlJylcbiAgICAgICAgICAgIC5pbnNlcnQoeyB1c2VyX2lkOiBzaXRlUm93LnVzZXJfaWQsIHVzZWQ6IDEsIHF1b3RhOiAwLCB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSk7XG4gICAgICAgICAgaWYgKHVzYWdlSW5zZXJ0RXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQ09MTEVDVC1WSVNJVE9SXVtVU0FHRV0gRmFpbGVkIHRvIGluc2VydCB1c2FnZSByb3c6JywgdXNhZ2VJbnNlcnRFcnIsIHsgdXNlcl9pZDogc2l0ZVJvdy51c2VyX2lkIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignW0NPTExFQ1QtVklTSVRPUl1bVVNBR0VdIFVuZXhwZWN0ZWQgZXJyb3IgaW5jcmVtZW50aW5nIEFQSSB1c2FnZTonLCBlcnIsIHsgdXNlcl9pZDogc2l0ZVJvdy51c2VyX2lkIH0pO1xuICAgIH1cblxuICAgIC8vIEdldCBjbGllbnQgc2V0dGluZ3NcbiAgICBjb25zdCB7IGRhdGE6IGNsaWVudEFwcCB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcbiAgICAgIC5mcm9tKCdjbGllbnRfYXBwcycpXG4gICAgICAuc2VsZWN0KCdhdXRvX2Jsb2NrLCByaXNrX3RocmVzaG9sZCwgc2hhcmVfcmVwdXRhdGlvbicpXG4gICAgICAuZXEoJ3NpdGVfa2V5Jywgc2l0ZUtleSlcbiAgICAgIC5tYXliZVNpbmdsZSgpXG4gICAgY29uc3Qgcmlza190aHJlc2hvbGQgPSBjbGllbnRBcHA/LnJpc2tfdGhyZXNob2xkID8/IDgwXG4gICAgY29uc3QgYXV0b19ibG9jayA9IGNsaWVudEFwcD8uYXV0b19ibG9jayA/PyBmYWxzZVxuICAgIGNvbnN0IHNoYXJlX3JlcHV0YXRpb24gPSBjbGllbnRBcHA/LnNoYXJlX3JlcHV0YXRpb24gPz8gZmFsc2VcblxuICAgIC8vIERlY2lkZSBhY3Rpb25cbiAgICBpZiAoYXV0b19ibG9jayAmJiBmaW5hbFNjb3JlID49IHJpc2tfdGhyZXNob2xkKSB7XG4gICAgICBhY3Rpb24gPSAnYXV0b19ibG9jaydcbiAgICB9XG5cbiAgICAvLyBTaGFyZSByZXB1dGF0aW9uXG4gICAgaWYgKHNoYXJlX3JlcHV0YXRpb24gJiYgZmluYWxWZXJkaWN0ID09PSAnaGlnaCcpIHtcbiAgICAgIGF3YWl0IHN1cGFiYXNlU2VydmVyLmZyb20oJ2dsb2JhbF9yZXB1dGF0aW9uJykudXBzZXJ0KHtcbiAgICAgICAgZmluZ2VycHJpbnRfaGFzaCxcbiAgICAgICAgaXAsXG4gICAgICAgIGFidXNlX2NvdW50OiAxLFxuICAgICAgICBsYXN0X3NlZW46IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSwgeyBvbkNvbmZsaWN0OiAnZmluZ2VycHJpbnRfaGFzaCxpcCcgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gd2l0aENPUlMoTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgcmlza19zY29yZTogZmluYWxTY29yZSxcbiAgICAgIHZlcmRpY3Q6IGZpbmFsVmVyZGljdCxcbiAgICAgIGFjdGlvbixcbiAgICAgIHZpc2l0b3JfZXZlbnRfaWQ6IGluc2VydGVkRXZlbnQuaWQsXG4gICAgICBzaWduYWxzOiB7XG4gICAgICAgIHZwbkRldGVjdGVkLFxuICAgICAgICB0aW1lem9uZU1pc21hdGNoLFxuICAgICAgICB2ZWxvY2l0eUNvdW50OiB2XG4gICAgICB9XG4gICAgfSkpXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdzZXJ2ZXJfZXJyb3InLCBkZXRhaWxzOiBlcnIubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn0pO1xuIl0sIm5hbWVzIjpbImNvbnNvbGUiLCJsb2ciLCJwcm9jZXNzIiwiZW52IiwiU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIk5leHRSZXNwb25zZSIsInBhdGgiLCJoZWFkZXJzIiwieiIsInRva2VuQnVja2V0IiwiZ2V0SVBJbmZvIiwiY2hlY2tBYnVzZUlQIiwidmVsb2NpdHlDb3VudCIsImNvbXB1dGVSaXNrIiwic3VwYWJhc2VTZXJ2ZXIiLCJ2NSIsInV1aWR2NSIsImlwSW5MaXN0IiwiaXAiLCJmaWxlIiwicmVhZEZpbGUiLCJkYXRhIiwic2V0IiwiU2V0Iiwic3BsaXQiLCJtYXAiLCJsIiwidHJpbSIsImZpbHRlciIsIkJvb2xlYW4iLCJoYXMiLCJlbWFpbElzRGlzcG9zYWJsZSIsImVtYWlsIiwiZG9tYWluIiwidG9Mb3dlckNhc2UiLCJsaW5lcyIsInNsaWNlIiwiSlNPTiIsInN0cmluZ2lmeSIsImxlbmd0aCIsImNsZWFuIiwicyIsInJlcGxhY2UiLCJDb2xsZWN0VmlzaXRvclNjaGVtYSIsIm9iamVjdCIsInNpdGVLZXkiLCJzdHJpbmciLCJmaW5nZXJwcmludF9oYXNoIiwidXNlckFnZW50IiwibGFuZ3VhZ2UiLCJ0aW1lem9uZSIsInJlc29sdXRpb24iLCJyZWZlcnJlciIsIm9wdGlvbmFsIiwiaW5jb2duaXRvIiwiYm9vbGVhbiIsIndlYmRyaXZlciIsInRodW1ibWFya19zaWduYWxzIiwiYW55IiwidGh1bWJtYXJrX2RldGFpbHMiLCJwaG9uZSIsIm5hbWUiLCJib3RkX3Jlc3VsdCIsIndpdGhDT1JTIiwiT1BUSU9OUyIsInN0YXR1cyIsIm5vcm1hbGl6ZUJvdGRSZXN1bHQiLCJib3RkIiwidW5kZWZpbmVkIiwiYm90IiwicmVzdWx0IiwiUE9TVCIsInJlcSIsImJvZHkiLCJqc29uIiwicGFyc2UiLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwiZXJyb3IiLCJkZXRhaWxzIiwiZXJyb3JzIiwiZ2V0Iiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImRpc3Bvc2FibGVGaWxlUGF0aCIsInJlc29sdmUiLCJjd2QiLCJkZWJ1Z1RlbXBFbWFpbERvbWFpbiIsImRlYnVnVGVtcEVtYWlsUmVzdWx0IiwiZnMiLCJpc1RvciIsImlzUHJveHkiLCJQcm9taXNlIiwiYWxsIiwiam9pbiIsIl9fZGlybmFtZSIsImlzVGVtcEVtYWlsIiwicmwiLCJhbGxvd2VkIiwiaW5mbyIsInRpbWV6b25lTWlzbWF0Y2giLCJhYnVzZSIsInZpc2l0b3JfaWQiLCJ1dWlkVmFsaWRhdGUiLCJ2IiwidGVzdCIsIk5BTUVTUEFDRSIsInZwbkRldGVjdGVkIiwicHJpdmFjeSIsInZwbiIsImhvc3RpbmciLCJzY29yZSIsInZlcmRpY3QiLCJhYnVzZUxpc3RlZCIsImJsb2NrbGlzdGVkIiwiYWN0aW9uIiwibWFudWFsQmxvY2siLCJibG9ja0lkIiwiYmxvY2tSZWFzb24iLCJzdXNwaWNpb3VzUmVhc29uIiwic3VzcGljaW91cyIsImJsb2NrcyIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm9yIiwiaXMiLCJsaW1pdCIsImlkIiwicmVhc29uIiwiZmluYWxTY29yZSIsImZpbmFsVmVyZGljdCIsInNpdGVSb3ciLCJzaXRlRXJyb3IiLCJtYXliZVNpbmdsZSIsImF1dG9fYmxvY2tfdHJpYWxfYWJ1c2UiLCJhdXRvQmxvY2tUcmlhbEFidXNlIiwidHJpYWxBYnVzZVRocmVzaG9sZCIsInRyaWFsX2FidXNlX3RocmVzaG9sZCIsInF1b3RhRXhjZWVkZWQiLCJ1c2VyX2lkIiwidXNhZ2VSb3dzIiwidXNhZ2VGZXRjaEVyciIsInVzZWQiLCJxdW90YSIsImN5Y2xlX2VuZCIsIm5vdyIsIkRhdGUiLCJ1cHNlcnRlZFZpc2l0b3IiLCJ1cHNlcnRWaXNpdG9yRXJyIiwidXBzZXJ0Iiwic2l0ZV9pZCIsImZpbmdlcnByaW50IiwidGh1bWJtYXJrIiwiaGFzaCIsInVzZXJfYWdlbnQiLCJzY3JlZW5fcmVzb2x1dGlvbiIsInBsYXRmb3JtIiwiaXBfYWRkcmVzcyIsImNvdW50cnkiLCJjaXR5IiwicmVnaW9uIiwiaXNwIiwib3JnIiwiaXNfYm90Iiwicmlza19zY29yZSIsImlzX3RvciIsImlzX3Byb3h5IiwiaXNfdGVtcF9lbWFpbCIsIm9uQ29uZmxpY3QiLCJtZXNzYWdlIiwiZXhpc3RpbmdFbWFpbCIsImVtYWlsTG9va3VwRXJyIiwiaW5zZXJ0IiwiY3JlYXRlZF9hdCIsInRvSVNPU3RyaW5nIiwiZW1haWxSb3dzIiwiZW1haWxFcnIiLCJ1bmlxdWVFbWFpbHMiLCJBcnJheSIsInIiLCJleGlzdGluZ0Jsb2NrIiwiYmxvY2tFcnIiLCJpbnNlcnRCbG9ja0VyciIsImluc2VydEJsb2NrRGF0YSIsInNpdGVfa2V5IiwibmV3VmlzaXRDb3VudCIsInZpc2l0b3JSb3ciLCJ2aXNpdG9yRmV0Y2hFcnIiLCJ2aXNpdF9jb3VudCIsInVwZGF0ZSIsImxhc3Rfc2VlbiIsImluc2VydGVkRXZlbnQiLCJpbnNlcnRFcnIiLCJldmVudF90eXBlIiwiZXZlbnRfbmFtZSIsInVybCIsInByb3BlcnRpZXMiLCJpcF9jaXR5IiwiaXBfY291bnRyeSIsImlwX29yZyIsImJyb3dzZXIiLCJvcyIsInNpZ25hbHMiLCJpc0FycmF5IiwiZ3BzX2xvY2F0aW9uIiwiZ2VvIiwibGF0IiwibG9uIiwiYWNjdXJhY3kiLCJncHNfcGVybWlzc2lvbiIsInBlcm1pc3Npb24iLCJlbXVsYXRvcl9kZXRlY3RlZCIsImVtdWxhdG9yIiwiaXNFbXVsYXRvciIsImVtdWxhdG9yX3JlYXNvbnMiLCJyZWFzb25zIiwiZ2VvX21pc21hdGNoIiwibG9jIiwiTWF0aCIsImFicyIsImxvY2F0aW9uX3Nwb29mZWQiLCJ0aW1lc3RhbXAiLCJzaW5nbGUiLCJuZXEiLCJjdXJyZW50VXNlZCIsInVzYWdlVXBkYXRlRXJyIiwidXBkYXRlZF9hdCIsInVzYWdlSW5zZXJ0RXJyIiwiZXJyIiwiY2xpZW50QXBwIiwicmlza190aHJlc2hvbGQiLCJhdXRvX2Jsb2NrIiwic2hhcmVfcmVwdXRhdGlvbiIsImFidXNlX2NvdW50IiwidmlzaXRvcl9ldmVudF9pZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/collect-visitor/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/withCORS.ts":
/*!*****************************!*\
  !*** ./app/api/withCORS.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withCORS: () => (/* binding */ withCORS)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/../../node_modules/next/dist/server/web/exports/next-response.js\");\n// Reusable CORS middleware for Next.js API routes\n\nfunction withCORS(handler) {\n    return async (req, ...args)=>{\n        if (req.method === \"OPTIONS\") {\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](null, {\n                status: 204,\n                headers: {\n                    \"Access-Control-Allow-Origin\": req.headers.get(\"origin\") || \"*\",\n                    \"Access-Control-Allow-Credentials\": \"true\",\n                    \"Access-Control-Allow-Methods\": \"GET,POST,OPTIONS\",\n                    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization, x-usage-track\"\n                }\n            });\n        }\n        try {\n            const response = await handler(req, ...args);\n            if (response instanceof Response) {\n                // Dynamically set CORS origin\n                const origin = req.headers.get(\"origin\") || \"*\";\n                response.headers.set(\"Access-Control-Allow-Origin\", origin);\n                response.headers.set(\"Access-Control-Allow-Credentials\", \"true\");\n                response.headers.set(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS\");\n                response.headers.set(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization, x-usage-track\");\n                return response;\n            }\n            // If handler returned non-Response, wrap it\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify(response), {\n                headers: {\n                    \"Access-Control-Allow-Origin\": req.headers.get(\"origin\") || \"*\",\n                    \"Access-Control-Allow-Credentials\": \"true\",\n                    \"Access-Control-Allow-Methods\": \"GET,POST,OPTIONS\",\n                    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization, x-usage-track\",\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        } catch (err) {\n            // Always return CORS headers even on error\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                error: err?.message || \"Internal Server Error\"\n            }), {\n                status: 500,\n                headers: {\n                    \"Access-Control-Allow-Origin\": req.headers.get(\"origin\") || \"*\",\n                    \"Access-Control-Allow-Credentials\": \"true\",\n                    \"Access-Control-Allow-Methods\": \"GET,POST,OPTIONS\",\n                    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization, x-usage-track\",\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3dpdGhDT1JTLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsa0RBQWtEO0FBQ1A7QUFFcEMsU0FBU0MsU0FBU0MsT0FBWTtJQUNuQyxPQUFPLE9BQU9DLEtBQWMsR0FBR0M7UUFDN0IsSUFBSUQsSUFBSUUsTUFBTSxLQUFLLFdBQVc7WUFDNUIsT0FBTyxJQUFJTCxrRkFBWUEsQ0FBQyxNQUFNO2dCQUM1Qk0sUUFBUTtnQkFDUkMsU0FBUztvQkFDUCwrQkFBK0JKLElBQUlJLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGFBQWE7b0JBQ3RFLG9DQUFvQztvQkFDMUIsZ0NBQWdDO29CQUNoQyxnQ0FBZ0M7Z0JBQ2xDO1lBQ0Y7UUFDRjtRQUNBLElBQUk7WUFDRixNQUFNQyxXQUFXLE1BQU1QLFFBQVFDLFFBQVFDO1lBQ3ZDLElBQUlLLG9CQUFvQkMsVUFBVTtnQkFDaEMsOEJBQThCO2dCQUM5QixNQUFNQyxTQUFTUixJQUFJSSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxhQUFhO2dCQUM1Q0MsU0FBU0YsT0FBTyxDQUFDSyxHQUFHLENBQUMsK0JBQStCRDtnQkFDcERGLFNBQVNGLE9BQU8sQ0FBQ0ssR0FBRyxDQUFDLG9DQUFvQztnQkFDekRILFNBQVNGLE9BQU8sQ0FBQ0ssR0FBRyxDQUFDLGdDQUFnQztnQkFDckRILFNBQVNGLE9BQU8sQ0FBQ0ssR0FBRyxDQUFDLGdDQUFnQztnQkFDckQsT0FBT0g7WUFDVDtZQUNBLDRDQUE0QztZQUM1QyxPQUFPLElBQUlULGtGQUFZQSxDQUFDYSxLQUFLQyxTQUFTLENBQUNMLFdBQVc7Z0JBQ2hERixTQUFTO29CQUNQLCtCQUErQkosSUFBSUksT0FBTyxDQUFDQyxHQUFHLENBQUMsYUFBYTtvQkFDdEUsb0NBQW9DO29CQUMxQixnQ0FBZ0M7b0JBQ2hDLGdDQUFnQztvQkFDaEMsZ0JBQWdCO2dCQUNsQjtZQUNGO1FBQ0YsRUFBRSxPQUFPTyxLQUFVO1lBQ2pCLDJDQUEyQztZQUMzQyxPQUFPLElBQUlmLGtGQUFZQSxDQUNyQmEsS0FBS0MsU0FBUyxDQUFDO2dCQUFFRSxPQUFPRCxLQUFLRSxXQUFXO1lBQXdCLElBQ2hFO2dCQUNFWCxRQUFRO2dCQUNSQyxTQUFTO29CQUNQLCtCQUErQkosSUFBSUksT0FBTyxDQUFDQyxHQUFHLENBQUMsYUFBYTtvQkFDeEUsb0NBQW9DO29CQUN4QixnQ0FBZ0M7b0JBQ2hDLGdDQUFnQztvQkFDaEMsZ0JBQWdCO2dCQUNsQjtZQUNGO1FBRUo7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9hcHAvYXBpL3dpdGhDT1JTLnRzPzUzNzMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gUmV1c2FibGUgQ09SUyBtaWRkbGV3YXJlIGZvciBOZXh0LmpzIEFQSSByb3V0ZXNcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhDT1JTKGhhbmRsZXI6IGFueSkge1xuICByZXR1cm4gYXN5bmMgKHJlcTogUmVxdWVzdCwgLi4uYXJnczogYW55W10pID0+IHtcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShudWxsLCB7XG4gICAgICAgIHN0YXR1czogMjA0LFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6IHJlcS5oZWFkZXJzLmdldCgnb3JpZ2luJykgfHwgJyonLFxuJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJzogJ3RydWUnLFxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJzogJ0dFVCxQT1NULE9QVElPTlMnLFxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ0NvbnRlbnQtVHlwZSwgQXV0aG9yaXphdGlvbiwgeC11c2FnZS10cmFjaycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihyZXEsIC4uLmFyZ3MpO1xuICAgICAgaWYgKHJlc3BvbnNlIGluc3RhbmNlb2YgUmVzcG9uc2UpIHtcbiAgICAgICAgLy8gRHluYW1pY2FsbHkgc2V0IENPUlMgb3JpZ2luXG4gICAgICAgIGNvbnN0IG9yaWdpbiA9IHJlcS5oZWFkZXJzLmdldCgnb3JpZ2luJykgfHwgJyonO1xuICAgICAgICByZXNwb25zZS5oZWFkZXJzLnNldCgnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgb3JpZ2luKTtcbiAgICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJywgJ3RydWUnKTtcbiAgICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnLCAnR0VULFBPU1QsT1BUSU9OUycpO1xuICAgICAgICByZXNwb25zZS5oZWFkZXJzLnNldCgnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycycsICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24sIHgtdXNhZ2UtdHJhY2snKTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfVxuICAgICAgLy8gSWYgaGFuZGxlciByZXR1cm5lZCBub24tUmVzcG9uc2UsIHdyYXAgaXRcbiAgICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6IHJlcS5oZWFkZXJzLmdldCgnb3JpZ2luJykgfHwgJyonLFxuJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJzogJ3RydWUnLFxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJzogJ0dFVCxQT1NULE9QVElPTlMnLFxuICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ0NvbnRlbnQtVHlwZSwgQXV0aG9yaXphdGlvbiwgeC11c2FnZS10cmFjaycsXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAvLyBBbHdheXMgcmV0dXJuIENPUlMgaGVhZGVycyBldmVuIG9uIGVycm9yXG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogZXJyPy5tZXNzYWdlIHx8ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InIH0pLFxuICAgICAgICB7XG4gICAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6IHJlcS5oZWFkZXJzLmdldCgnb3JpZ2luJykgfHwgJyonLFxuJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJzogJ3RydWUnLFxuICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnOiAnR0VULFBPU1QsT1BUSU9OUycsXG4gICAgICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24sIHgtdXNhZ2UtdHJhY2snLFxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ3aXRoQ09SUyIsImhhbmRsZXIiLCJyZXEiLCJhcmdzIiwibWV0aG9kIiwic3RhdHVzIiwiaGVhZGVycyIsImdldCIsInJlc3BvbnNlIiwiUmVzcG9uc2UiLCJvcmlnaW4iLCJzZXQiLCJKU09OIiwic3RyaW5naWZ5IiwiZXJyIiwiZXJyb3IiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/withCORS.ts\n");

/***/ }),

/***/ "(rsc)/./lib/abuse.ts":
/*!**********************!*\
  !*** ./lib/abuse.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkAbuseIP: () => (/* binding */ checkAbuseIP)\n/* harmony export */ });\n/* harmony import */ var _redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./redis */ \"(rsc)/./lib/redis.ts\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"(rsc)/../../node_modules/axios/lib/axios.js\");\n\n\nconst ABUSEIPDB_KEY = process.env.ABUSEIPDB_KEY;\nasync function checkAbuseIP(ip) {\n    if (!ABUSEIPDB_KEY) {\n        return {\n            blocklisted: false\n        };\n    }\n    const cacheKey = `abuse:${ip}`;\n    const cached = await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.get)(cacheKey);\n    if (cached) return JSON.parse(cached);\n    const { data } = await axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(`https://api.abuseipdb.com/api/v2/check`, {\n        params: {\n            ipAddress: ip,\n            maxAgeInDays: 30\n        },\n        headers: {\n            Key: ABUSEIPDB_KEY,\n            Accept: \"application/json\"\n        }\n    });\n    const blocklisted = data.data.abuseConfidenceScore >= 50;\n    const result = {\n        blocklisted\n    };\n    await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.set)(cacheKey, JSON.stringify(result), 86400);\n    return result;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYWJ1c2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWtDO0FBQ1Q7QUFFekIsTUFBTUcsZ0JBQWdCQyxRQUFRQyxHQUFHLENBQUNGLGFBQWE7QUFFeEMsZUFBZUcsYUFBYUMsRUFBVTtJQUMzQyxJQUFJLENBQUNKLGVBQWU7UUFDbEIsT0FBTztZQUFFSyxhQUFhO1FBQU07SUFDOUI7SUFDQSxNQUFNQyxXQUFXLENBQUMsTUFBTSxFQUFFRixHQUFHLENBQUM7SUFDOUIsTUFBTUcsU0FBUyxNQUFNViwyQ0FBR0EsQ0FBQ1M7SUFDekIsSUFBSUMsUUFBUSxPQUFPQyxLQUFLQyxLQUFLLENBQUNGO0lBQzlCLE1BQU0sRUFBRUcsSUFBSSxFQUFFLEdBQUcsTUFBTVgsNkNBQUtBLENBQUNGLEdBQUcsQ0FBQyxDQUFDLHNDQUFzQyxDQUFDLEVBQUU7UUFDekVjLFFBQVE7WUFBRUMsV0FBV1I7WUFBSVMsY0FBYztRQUFHO1FBQzFDQyxTQUFTO1lBQUVDLEtBQUtmO1lBQWVnQixRQUFRO1FBQW1CO0lBQzVEO0lBQ0EsTUFBTVgsY0FBY0ssS0FBS0EsSUFBSSxDQUFDTyxvQkFBb0IsSUFBSTtJQUN0RCxNQUFNQyxTQUFTO1FBQUViO0lBQVk7SUFDN0IsTUFBTVAsMkNBQUdBLENBQUNRLFVBQVVFLEtBQUtXLFNBQVMsQ0FBQ0QsU0FBUztJQUM1QyxPQUFPQTtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvYWJ1c2UudHM/ZDg5OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXQsIHNldCB9IGZyb20gJy4vcmVkaXMnXG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnXG5cbmNvbnN0IEFCVVNFSVBEQl9LRVkgPSBwcm9jZXNzLmVudi5BQlVTRUlQREJfS0VZXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0FidXNlSVAoaXA6IHN0cmluZykge1xuICBpZiAoIUFCVVNFSVBEQl9LRVkpIHtcbiAgICByZXR1cm4geyBibG9ja2xpc3RlZDogZmFsc2UgfVxuICB9XG4gIGNvbnN0IGNhY2hlS2V5ID0gYGFidXNlOiR7aXB9YFxuICBjb25zdCBjYWNoZWQgPSBhd2FpdCBnZXQoY2FjaGVLZXkpXG4gIGlmIChjYWNoZWQpIHJldHVybiBKU09OLnBhcnNlKGNhY2hlZClcbiAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vYXBpLmFidXNlaXBkYi5jb20vYXBpL3YyL2NoZWNrYCwge1xuICAgIHBhcmFtczogeyBpcEFkZHJlc3M6IGlwLCBtYXhBZ2VJbkRheXM6IDMwIH0sXG4gICAgaGVhZGVyczogeyBLZXk6IEFCVVNFSVBEQl9LRVksIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gIH0pXG4gIGNvbnN0IGJsb2NrbGlzdGVkID0gZGF0YS5kYXRhLmFidXNlQ29uZmlkZW5jZVNjb3JlID49IDUwXG4gIGNvbnN0IHJlc3VsdCA9IHsgYmxvY2tsaXN0ZWQgfVxuICBhd2FpdCBzZXQoY2FjaGVLZXksIEpTT04uc3RyaW5naWZ5KHJlc3VsdCksIDg2NDAwKVxuICByZXR1cm4gcmVzdWx0XG59XG4iXSwibmFtZXMiOlsiZ2V0Iiwic2V0IiwiYXhpb3MiLCJBQlVTRUlQREJfS0VZIiwicHJvY2VzcyIsImVudiIsImNoZWNrQWJ1c2VJUCIsImlwIiwiYmxvY2tsaXN0ZWQiLCJjYWNoZUtleSIsImNhY2hlZCIsIkpTT04iLCJwYXJzZSIsImRhdGEiLCJwYXJhbXMiLCJpcEFkZHJlc3MiLCJtYXhBZ2VJbkRheXMiLCJoZWFkZXJzIiwiS2V5IiwiQWNjZXB0IiwiYWJ1c2VDb25maWRlbmNlU2NvcmUiLCJyZXN1bHQiLCJzdHJpbmdpZnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/abuse.ts\n");

/***/ }),

/***/ "(rsc)/./lib/ipinfo.ts":
/*!***********************!*\
  !*** ./lib/ipinfo.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getIPInfo: () => (/* binding */ getIPInfo)\n/* harmony export */ });\n/* harmony import */ var _redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./redis */ \"(rsc)/./lib/redis.ts\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"(rsc)/../../node_modules/axios/lib/axios.js\");\n\n\nconst IPINFO_TOKEN = process.env.IPINFO_TOKEN;\nif (!IPINFO_TOKEN) throw new Error(\"IPINFO_TOKEN env var not set\");\nasync function getIPInfo(ip) {\n    const cacheKey = `ipinfo:${ip}`;\n    const cached = await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.get)(cacheKey);\n    if (cached) return JSON.parse(cached);\n    const url = `https://ipinfo.io/${ip}/json?token=${IPINFO_TOKEN}`;\n    const { data } = await axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(url);\n    const result = {\n        org: data.org,\n        city: data.city,\n        region: data.region,\n        country: data.country,\n        timezone: data.timezone,\n        privacy: data.privacy ?? {}\n    };\n    if (data.asn) result.asn = data.asn;\n    await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.set)(cacheKey, JSON.stringify(result), 86400);\n    return result;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvaXBpbmZvLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFrQztBQUNUO0FBRXpCLE1BQU1HLGVBQWVDLFFBQVFDLEdBQUcsQ0FBQ0YsWUFBWTtBQUM3QyxJQUFJLENBQUNBLGNBQWMsTUFBTSxJQUFJRyxNQUFNO0FBRTVCLGVBQWVDLFVBQVVDLEVBQVU7SUFDeEMsTUFBTUMsV0FBVyxDQUFDLE9BQU8sRUFBRUQsR0FBRyxDQUFDO0lBQy9CLE1BQU1FLFNBQVMsTUFBTVYsMkNBQUdBLENBQUNTO0lBQ3pCLElBQUlDLFFBQVEsT0FBT0MsS0FBS0MsS0FBSyxDQUFDRjtJQUU5QixNQUFNRyxNQUFNLENBQUMsa0JBQWtCLEVBQUVMLEdBQUcsWUFBWSxFQUFFTCxhQUFhLENBQUM7SUFDaEUsTUFBTSxFQUFFVyxJQUFJLEVBQUUsR0FBRyxNQUFNWiw2Q0FBS0EsQ0FBQ0YsR0FBRyxDQUFDYTtJQUNqQyxNQUFNRSxTQUFjO1FBQ2xCQyxLQUFLRixLQUFLRSxHQUFHO1FBQ2JDLE1BQU1ILEtBQUtHLElBQUk7UUFDZkMsUUFBUUosS0FBS0ksTUFBTTtRQUNuQkMsU0FBU0wsS0FBS0ssT0FBTztRQUNyQkMsVUFBVU4sS0FBS00sUUFBUTtRQUN2QkMsU0FBU1AsS0FBS08sT0FBTyxJQUFJLENBQUM7SUFDNUI7SUFDQSxJQUFJUCxLQUFLUSxHQUFHLEVBQUVQLE9BQU9PLEdBQUcsR0FBR1IsS0FBS1EsR0FBRztJQUNuQyxNQUFNckIsMkNBQUdBLENBQUNRLFVBQVVFLEtBQUtZLFNBQVMsQ0FBQ1IsU0FBUztJQUM1QyxPQUFPQTtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvaXBpbmZvLnRzP2FjZDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0LCBzZXQgfSBmcm9tICcuL3JlZGlzJ1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJ1xuXG5jb25zdCBJUElORk9fVE9LRU4gPSBwcm9jZXNzLmVudi5JUElORk9fVE9LRU5cbmlmICghSVBJTkZPX1RPS0VOKSB0aHJvdyBuZXcgRXJyb3IoJ0lQSU5GT19UT0tFTiBlbnYgdmFyIG5vdCBzZXQnKVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SVBJbmZvKGlwOiBzdHJpbmcpIHtcbiAgY29uc3QgY2FjaGVLZXkgPSBgaXBpbmZvOiR7aXB9YFxuICBjb25zdCBjYWNoZWQgPSBhd2FpdCBnZXQoY2FjaGVLZXkpXG4gIGlmIChjYWNoZWQpIHJldHVybiBKU09OLnBhcnNlKGNhY2hlZClcblxuICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9pcGluZm8uaW8vJHtpcH0vanNvbj90b2tlbj0ke0lQSU5GT19UT0tFTn1gXG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MuZ2V0KHVybClcbiAgY29uc3QgcmVzdWx0OiBhbnkgPSB7XG4gICAgb3JnOiBkYXRhLm9yZyxcbiAgICBjaXR5OiBkYXRhLmNpdHksXG4gICAgcmVnaW9uOiBkYXRhLnJlZ2lvbixcbiAgICBjb3VudHJ5OiBkYXRhLmNvdW50cnksXG4gICAgdGltZXpvbmU6IGRhdGEudGltZXpvbmUsXG4gICAgcHJpdmFjeTogZGF0YS5wcml2YWN5ID8/IHt9LFxuICB9XG4gIGlmIChkYXRhLmFzbikgcmVzdWx0LmFzbiA9IGRhdGEuYXNuXG4gIGF3YWl0IHNldChjYWNoZUtleSwgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSwgODY0MDApXG4gIHJldHVybiByZXN1bHRcbn1cbiJdLCJuYW1lcyI6WyJnZXQiLCJzZXQiLCJheGlvcyIsIklQSU5GT19UT0tFTiIsInByb2Nlc3MiLCJlbnYiLCJFcnJvciIsImdldElQSW5mbyIsImlwIiwiY2FjaGVLZXkiLCJjYWNoZWQiLCJKU09OIiwicGFyc2UiLCJ1cmwiLCJkYXRhIiwicmVzdWx0Iiwib3JnIiwiY2l0eSIsInJlZ2lvbiIsImNvdW50cnkiLCJ0aW1lem9uZSIsInByaXZhY3kiLCJhc24iLCJzdHJpbmdpZnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/ipinfo.ts\n");

/***/ }),

/***/ "(rsc)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   get: () => (/* binding */ get),\n/* harmony export */   redis: () => (/* binding */ redis),\n/* harmony export */   set: () => (/* binding */ set),\n/* harmony export */   tokenBucket: () => (/* binding */ tokenBucket)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"(rsc)/../../node_modules/ioredis/built/index.js\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n\nconst redisUrl = process.env.REDIS_URL;\nif (!redisUrl) throw new Error(\"REDIS_URL env var not set\");\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(redisUrl);\nasync function get(key) {\n    return redis.get(key);\n}\nasync function set(key, value, ttlSeconds) {\n    if (ttlSeconds) {\n        await redis.set(key, value, \"EX\", ttlSeconds);\n    } else {\n        await redis.set(key, value);\n    }\n}\n/**\n * Token bucket rate limiting using Redis.\n * @param key Redis key\n * @param capacity Max tokens in bucket (default 60)\n * @param refillPerSec Tokens added per second (default 1)\n * @returns { allowed: boolean, remaining: number }\n */ async function tokenBucket(key, capacity = 60, refillPerSec = 1) {\n    const now = Math.floor(Date.now() / 1000);\n    const bucketKey = `tb:${key}`;\n    const lua = `\n    local bucket = redis.call('HMGET', KEYS[1], 'tokens', 'last')\n    local tokens = tonumber(bucket[1]) or ARGV[2]\n    local last = tonumber(bucket[2]) or ARGV[3]\n    local now = tonumber(ARGV[1])\n    local refill = (now - last) * ARGV[4]\n    tokens = math.min(tokens + refill, ARGV[2])\n    local allowed = 0\n    if tokens >= 1 then\n      tokens = tokens - 1\n      allowed = 1\n    end\n    redis.call('HMSET', KEYS[1], 'tokens', tokens, 'last', now)\n    redis.call('EXPIRE', KEYS[1], 3600)\n    return {allowed, tokens}\n  `;\n    const [allowed, remaining] = await redis.eval(lua, 1, bucketKey, now, capacity, now, refillPerSec);\n    return {\n        allowed: !!allowed,\n        remaining: Number(remaining)\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTJCO0FBRTNCLE1BQU1DLFdBQVdDLFFBQVFDLEdBQUcsQ0FBQ0MsU0FBUztBQUN0QyxJQUFJLENBQUNILFVBQVUsTUFBTSxJQUFJSSxNQUFNO0FBQ3hCLE1BQU1DLFFBQVEsSUFBSU4sZ0RBQUtBLENBQUNDLFVBQVM7QUFFakMsZUFBZU0sSUFBSUMsR0FBVztJQUNuQyxPQUFPRixNQUFNQyxHQUFHLENBQUNDO0FBQ25CO0FBRU8sZUFBZUMsSUFBSUQsR0FBVyxFQUFFRSxLQUFhLEVBQUVDLFVBQW1CO0lBQ3ZFLElBQUlBLFlBQVk7UUFDZCxNQUFNTCxNQUFNRyxHQUFHLENBQUNELEtBQUtFLE9BQU8sTUFBTUM7SUFDcEMsT0FBTztRQUNMLE1BQU1MLE1BQU1HLEdBQUcsQ0FBQ0QsS0FBS0U7SUFDdkI7QUFDRjtBQUVBOzs7Ozs7Q0FNQyxHQUNNLGVBQWVFLFlBQVlKLEdBQVcsRUFBRUssV0FBVyxFQUFFLEVBQUVDLGVBQWUsQ0FBQztJQUM1RSxNQUFNQyxNQUFNQyxLQUFLQyxLQUFLLENBQUNDLEtBQUtILEdBQUcsS0FBSztJQUNwQyxNQUFNSSxZQUFZLENBQUMsR0FBRyxFQUFFWCxJQUFJLENBQUM7SUFDN0IsTUFBTVksTUFBTSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7RUFlYixDQUFDO0lBQ0QsTUFBTSxDQUFDQyxTQUFTQyxVQUFVLEdBQUcsTUFBTWhCLE1BQU1pQixJQUFJLENBQUNILEtBQUssR0FBR0QsV0FBV0osS0FBS0YsVUFBVUUsS0FBS0Q7SUFDckYsT0FBTztRQUFFTyxTQUFTLENBQUMsQ0FBQ0E7UUFBU0MsV0FBV0UsT0FBT0Y7SUFBVztBQUM1RCIsInNvdXJjZXMiOlsid2VicGFjazovL0B2aXNpdG9yaXEvd2ViLy4vbGliL3JlZGlzLnRzPzUxZTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlZGlzIGZyb20gJ2lvcmVkaXMnXG5cbmNvbnN0IHJlZGlzVXJsID0gcHJvY2Vzcy5lbnYuUkVESVNfVVJMXG5pZiAoIXJlZGlzVXJsKSB0aHJvdyBuZXcgRXJyb3IoJ1JFRElTX1VSTCBlbnYgdmFyIG5vdCBzZXQnKVxuZXhwb3J0IGNvbnN0IHJlZGlzID0gbmV3IFJlZGlzKHJlZGlzVXJsKVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0KGtleTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gIHJldHVybiByZWRpcy5nZXQoa2V5KVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCB0dGxTZWNvbmRzPzogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmICh0dGxTZWNvbmRzKSB7XG4gICAgYXdhaXQgcmVkaXMuc2V0KGtleSwgdmFsdWUsICdFWCcsIHR0bFNlY29uZHMpXG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcmVkaXMuc2V0KGtleSwgdmFsdWUpXG4gIH1cbn1cblxuLyoqXG4gKiBUb2tlbiBidWNrZXQgcmF0ZSBsaW1pdGluZyB1c2luZyBSZWRpcy5cbiAqIEBwYXJhbSBrZXkgUmVkaXMga2V5XG4gKiBAcGFyYW0gY2FwYWNpdHkgTWF4IHRva2VucyBpbiBidWNrZXQgKGRlZmF1bHQgNjApXG4gKiBAcGFyYW0gcmVmaWxsUGVyU2VjIFRva2VucyBhZGRlZCBwZXIgc2Vjb25kIChkZWZhdWx0IDEpXG4gKiBAcmV0dXJucyB7IGFsbG93ZWQ6IGJvb2xlYW4sIHJlbWFpbmluZzogbnVtYmVyIH1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRva2VuQnVja2V0KGtleTogc3RyaW5nLCBjYXBhY2l0eSA9IDYwLCByZWZpbGxQZXJTZWMgPSAxKTogUHJvbWlzZTx7IGFsbG93ZWQ6IGJvb2xlYW4sIHJlbWFpbmluZzogbnVtYmVyIH0+IHtcbiAgY29uc3Qgbm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMClcbiAgY29uc3QgYnVja2V0S2V5ID0gYHRiOiR7a2V5fWBcbiAgY29uc3QgbHVhID0gYFxuICAgIGxvY2FsIGJ1Y2tldCA9IHJlZGlzLmNhbGwoJ0hNR0VUJywgS0VZU1sxXSwgJ3Rva2VucycsICdsYXN0JylcbiAgICBsb2NhbCB0b2tlbnMgPSB0b251bWJlcihidWNrZXRbMV0pIG9yIEFSR1ZbMl1cbiAgICBsb2NhbCBsYXN0ID0gdG9udW1iZXIoYnVja2V0WzJdKSBvciBBUkdWWzNdXG4gICAgbG9jYWwgbm93ID0gdG9udW1iZXIoQVJHVlsxXSlcbiAgICBsb2NhbCByZWZpbGwgPSAobm93IC0gbGFzdCkgKiBBUkdWWzRdXG4gICAgdG9rZW5zID0gbWF0aC5taW4odG9rZW5zICsgcmVmaWxsLCBBUkdWWzJdKVxuICAgIGxvY2FsIGFsbG93ZWQgPSAwXG4gICAgaWYgdG9rZW5zID49IDEgdGhlblxuICAgICAgdG9rZW5zID0gdG9rZW5zIC0gMVxuICAgICAgYWxsb3dlZCA9IDFcbiAgICBlbmRcbiAgICByZWRpcy5jYWxsKCdITVNFVCcsIEtFWVNbMV0sICd0b2tlbnMnLCB0b2tlbnMsICdsYXN0Jywgbm93KVxuICAgIHJlZGlzLmNhbGwoJ0VYUElSRScsIEtFWVNbMV0sIDM2MDApXG4gICAgcmV0dXJuIHthbGxvd2VkLCB0b2tlbnN9XG4gIGBcbiAgY29uc3QgW2FsbG93ZWQsIHJlbWFpbmluZ10gPSBhd2FpdCByZWRpcy5ldmFsKGx1YSwgMSwgYnVja2V0S2V5LCBub3csIGNhcGFjaXR5LCBub3csIHJlZmlsbFBlclNlYylcbiAgcmV0dXJuIHsgYWxsb3dlZDogISFhbGxvd2VkLCByZW1haW5pbmc6IE51bWJlcihyZW1haW5pbmcpIH1cbn1cbiJdLCJuYW1lcyI6WyJSZWRpcyIsInJlZGlzVXJsIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsIkVycm9yIiwicmVkaXMiLCJnZXQiLCJrZXkiLCJzZXQiLCJ2YWx1ZSIsInR0bFNlY29uZHMiLCJ0b2tlbkJ1Y2tldCIsImNhcGFjaXR5IiwicmVmaWxsUGVyU2VjIiwibm93IiwiTWF0aCIsImZsb29yIiwiRGF0ZSIsImJ1Y2tldEtleSIsImx1YSIsImFsbG93ZWQiLCJyZW1haW5pbmciLCJldmFsIiwiTnVtYmVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/redis.ts\n");

/***/ }),

/***/ "(rsc)/./lib/risk.ts":
/*!*********************!*\
  !*** ./lib/risk.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   computeRisk: () => (/* binding */ computeRisk)\n/* harmony export */ });\nfunction computeRisk({ incognito, vpn, timezoneMismatch, webdriver, abuseListed, velocityCount }) {\n    let score = 0;\n    if (incognito) score += 20;\n    if (vpn) score += 20;\n    if (timezoneMismatch) score += 15;\n    if (webdriver) score += 10;\n    if (abuseListed) score += 10;\n    if ((velocityCount ?? 0) > 3) score += 5;\n    score = Math.max(0, Math.min(100, score));\n    const verdict = score <= 30 ? \"low\" : score <= 70 ? \"medium\" : \"high\";\n    return {\n        score,\n        verdict\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmlzay50cyIsIm1hcHBpbmdzIjoiOzs7O0FBU08sU0FBU0EsWUFBWSxFQUFFQyxTQUFTLEVBQUVDLEdBQUcsRUFBRUMsZ0JBQWdCLEVBQUVDLFNBQVMsRUFBRUMsV0FBVyxFQUFFQyxhQUFhLEVBQWE7SUFDaEgsSUFBSUMsUUFBUTtJQUNaLElBQUlOLFdBQVdNLFNBQVM7SUFDeEIsSUFBSUwsS0FBS0ssU0FBUztJQUNsQixJQUFJSixrQkFBa0JJLFNBQVM7SUFDL0IsSUFBSUgsV0FBV0csU0FBUztJQUN4QixJQUFJRixhQUFhRSxTQUFTO0lBQzFCLElBQUksQ0FBQ0QsaUJBQWlCLEtBQUssR0FBR0MsU0FBUztJQUN2Q0EsUUFBUUMsS0FBS0MsR0FBRyxDQUFDLEdBQUdELEtBQUtFLEdBQUcsQ0FBQyxLQUFLSDtJQUNsQyxNQUFNSSxVQUFVSixTQUFTLEtBQUssUUFBUUEsU0FBUyxLQUFLLFdBQVc7SUFDL0QsT0FBTztRQUFFQTtRQUFPSTtJQUFRO0FBQzFCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvcmlzay50cz82ZDNlIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgUmlza0lucHV0ID0ge1xuICBpbmNvZ25pdG8/OiBib29sZWFuXG4gIHZwbj86IGJvb2xlYW5cbiAgdGltZXpvbmVNaXNtYXRjaD86IGJvb2xlYW5cbiAgd2ViZHJpdmVyPzogYm9vbGVhblxuICBhYnVzZUxpc3RlZD86IGJvb2xlYW5cbiAgdmVsb2NpdHlDb3VudD86IG51bWJlclxufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tcHV0ZVJpc2soeyBpbmNvZ25pdG8sIHZwbiwgdGltZXpvbmVNaXNtYXRjaCwgd2ViZHJpdmVyLCBhYnVzZUxpc3RlZCwgdmVsb2NpdHlDb3VudCB9OiBSaXNrSW5wdXQpIHtcbiAgbGV0IHNjb3JlID0gMFxuICBpZiAoaW5jb2duaXRvKSBzY29yZSArPSAyMFxuICBpZiAodnBuKSBzY29yZSArPSAyMFxuICBpZiAodGltZXpvbmVNaXNtYXRjaCkgc2NvcmUgKz0gMTVcbiAgaWYgKHdlYmRyaXZlcikgc2NvcmUgKz0gMTBcbiAgaWYgKGFidXNlTGlzdGVkKSBzY29yZSArPSAxMFxuICBpZiAoKHZlbG9jaXR5Q291bnQgPz8gMCkgPiAzKSBzY29yZSArPSA1XG4gIHNjb3JlID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBzY29yZSkpXG4gIGNvbnN0IHZlcmRpY3QgPSBzY29yZSA8PSAzMCA/ICdsb3cnIDogc2NvcmUgPD0gNzAgPyAnbWVkaXVtJyA6ICdoaWdoJ1xuICByZXR1cm4geyBzY29yZSwgdmVyZGljdCB9XG59XG4iXSwibmFtZXMiOlsiY29tcHV0ZVJpc2siLCJpbmNvZ25pdG8iLCJ2cG4iLCJ0aW1lem9uZU1pc21hdGNoIiwid2ViZHJpdmVyIiwiYWJ1c2VMaXN0ZWQiLCJ2ZWxvY2l0eUNvdW50Iiwic2NvcmUiLCJNYXRoIiwibWF4IiwibWluIiwidmVyZGljdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/risk.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabaseServer.ts":
/*!*******************************!*\
  !*** ./lib/supabaseServer.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseServer: () => (/* binding */ supabaseServer)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst SUPABASE_URL = process.env.SUPABASE_URL;\nconst SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE_KEY) {\n    throw new Error(\"SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY not set\");\n}\nconst supabaseServer = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2VTZXJ2ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0Q7QUFFcEQsTUFBTUMsZUFBZUMsUUFBUUMsR0FBRyxDQUFDRixZQUFZO0FBQzdDLE1BQU1HLDRCQUE0QkYsUUFBUUMsR0FBRyxDQUFDQyx5QkFBeUI7QUFFdkUsSUFBSSxDQUFDSCxnQkFBZ0IsQ0FBQ0csMkJBQTJCO0lBQy9DLE1BQU0sSUFBSUMsTUFBTTtBQUNsQjtBQUVPLE1BQU1DLGlCQUFpQk4sbUVBQVlBLENBQ3hDQyxjQUNBRywyQkFDQTtJQUFFRyxNQUFNO1FBQUVDLGtCQUFrQjtRQUFPQyxnQkFBZ0I7SUFBTTtBQUFFLEdBQzVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvc3VwYWJhc2VTZXJ2ZXIudHM/Yzc4YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbmNvbnN0IFNVUEFCQVNFX1VSTCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTFxuY29uc3QgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVlcblxuaWYgKCFTVVBBQkFTRV9VUkwgfHwgIVNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdTVVBBQkFTRV9VUkwgb3IgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBub3Qgc2V0Jylcbn1cblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlU2VydmVyID0gY3JlYXRlQ2xpZW50KFxuICBTVVBBQkFTRV9VUkwsXG4gIFNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVksXG4gIHsgYXV0aDogeyBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSwgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0gfVxuKVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsIlNVUEFCQVNFX1VSTCIsInByb2Nlc3MiLCJlbnYiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJzdXBhYmFzZVNlcnZlciIsImF1dGgiLCJhdXRvUmVmcmVzaFRva2VuIiwicGVyc2lzdFNlc3Npb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabaseServer.ts\n");

/***/ }),

/***/ "(rsc)/./lib/velocity.ts":
/*!*************************!*\
  !*** ./lib/velocity.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   velocityCount: () => (/* binding */ velocityCount)\n/* harmony export */ });\n/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dayjs */ \"(rsc)/../../node_modules/dayjs/dayjs.min.js\");\n/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_0__);\n\nasync function velocityCount(supabase, siteKey, visitorId, windowMinutes = 60) {\n    const since = dayjs__WEBPACK_IMPORTED_MODULE_0___default()().subtract(windowMinutes, \"minute\").toISOString();\n    // Lookup site_id from sites table using api_key\n    const { data: siteRow, error: siteError } = await supabase.from(\"sites\").select(\"id\").eq(\"api_key\", siteKey).maybeSingle();\n    if (!siteRow || siteError) return 0;\n    const { count } = await supabase.from(\"events\").select(\"*\", {\n        count: \"exact\",\n        head: true\n    }).eq(\"site_id\", siteRow.id).eq(\"visitor_id\", visitorId).gt(\"timestamp\", since);\n    return count || 0;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdmVsb2NpdHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ3lCO0FBRWxCLGVBQWVDLGNBQ3BCQyxRQUF3QixFQUN4QkMsT0FBZSxFQUNmQyxTQUFpQixFQUNqQkMsZ0JBQWdCLEVBQUU7SUFFbEIsTUFBTUMsUUFBUU4sNENBQUtBLEdBQUdPLFFBQVEsQ0FBQ0YsZUFBZSxVQUFVRyxXQUFXO0lBQ25FLGdEQUFnRDtJQUNoRCxNQUFNLEVBQUVDLE1BQU1DLE9BQU8sRUFBRUMsT0FBT0MsU0FBUyxFQUFFLEdBQUcsTUFBTVYsU0FDL0NXLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsTUFDUEMsRUFBRSxDQUFDLFdBQVdaLFNBQ2RhLFdBQVc7SUFDZCxJQUFJLENBQUNOLFdBQVdFLFdBQVcsT0FBTztJQUNsQyxNQUFNLEVBQUVLLEtBQUssRUFBRSxHQUFHLE1BQU1mLFNBQ3JCVyxJQUFJLENBQUMsVUFDTEMsTUFBTSxDQUFDLEtBQUs7UUFBRUcsT0FBTztRQUFTQyxNQUFNO0lBQUssR0FDekNILEVBQUUsQ0FBQyxXQUFXTCxRQUFRUyxFQUFFLEVBQ3hCSixFQUFFLENBQUMsY0FBY1gsV0FDakJnQixFQUFFLENBQUMsYUFBYWQ7SUFDbkIsT0FBT1csU0FBUztBQUNsQiIsInNvdXJjZXMiOlsid2VicGFjazovL0B2aXNpdG9yaXEvd2ViLy4vbGliL3ZlbG9jaXR5LnRzP2ZiMDgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3VwYWJhc2VDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5pbXBvcnQgZGF5anMgZnJvbSAnZGF5anMnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZWxvY2l0eUNvdW50KFxuICBzdXBhYmFzZTogU3VwYWJhc2VDbGllbnQsXG4gIHNpdGVLZXk6IHN0cmluZyxcbiAgdmlzaXRvcklkOiBzdHJpbmcsXG4gIHdpbmRvd01pbnV0ZXMgPSA2MFxuKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgY29uc3Qgc2luY2UgPSBkYXlqcygpLnN1YnRyYWN0KHdpbmRvd01pbnV0ZXMsICdtaW51dGUnKS50b0lTT1N0cmluZygpXG4gIC8vIExvb2t1cCBzaXRlX2lkIGZyb20gc2l0ZXMgdGFibGUgdXNpbmcgYXBpX2tleVxuICBjb25zdCB7IGRhdGE6IHNpdGVSb3csIGVycm9yOiBzaXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3NpdGVzJylcbiAgICAuc2VsZWN0KCdpZCcpXG4gICAgLmVxKCdhcGlfa2V5Jywgc2l0ZUtleSlcbiAgICAubWF5YmVTaW5nbGUoKTtcbiAgaWYgKCFzaXRlUm93IHx8IHNpdGVFcnJvcikgcmV0dXJuIDA7XG4gIGNvbnN0IHsgY291bnQgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ2V2ZW50cycpXG4gICAgLnNlbGVjdCgnKicsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSlcbiAgICAuZXEoJ3NpdGVfaWQnLCBzaXRlUm93LmlkKVxuICAgIC5lcSgndmlzaXRvcl9pZCcsIHZpc2l0b3JJZClcbiAgICAuZ3QoJ3RpbWVzdGFtcCcsIHNpbmNlKVxuICByZXR1cm4gY291bnQgfHwgMFxufVxuIl0sIm5hbWVzIjpbImRheWpzIiwidmVsb2NpdHlDb3VudCIsInN1cGFiYXNlIiwic2l0ZUtleSIsInZpc2l0b3JJZCIsIndpbmRvd01pbnV0ZXMiLCJzaW5jZSIsInN1YnRyYWN0IiwidG9JU09TdHJpbmciLCJkYXRhIiwic2l0ZVJvdyIsImVycm9yIiwic2l0ZUVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJjb3VudCIsImhlYWQiLCJpZCIsImd0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/velocity.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/axios","vendor-chunks/ioredis","vendor-chunks/asynckit","vendor-chunks/math-intrinsics","vendor-chunks/zod","vendor-chunks/uuid","vendor-chunks/es-errors","vendor-chunks/call-bind-apply-helpers","vendor-chunks/debug","vendor-chunks/redis-errors","vendor-chunks/get-proto","vendor-chunks/standard-as-callback","vendor-chunks/redis-parser","vendor-chunks/mime-db","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/form-data","vendor-chunks/follow-redirects","vendor-chunks/@ioredis","vendor-chunks/supports-color","vendor-chunks/proxy-from-env","vendor-chunks/ms","vendor-chunks/mime-types","vendor-chunks/lodash.isarguments","vendor-chunks/lodash.defaults","vendor-chunks/hasown","vendor-chunks/has-tostringtag","vendor-chunks/has-flag","vendor-chunks/get-intrinsic","vendor-chunks/es-set-tostringtag","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/denque","vendor-chunks/delayed-stream","vendor-chunks/dayjs","vendor-chunks/combined-stream","vendor-chunks/cluster-key-slot"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();