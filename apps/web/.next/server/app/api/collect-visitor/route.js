"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/collect-visitor/route";
exports.ids = ["app/api/collect-visitor/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "dns":
/*!**********************!*\
  !*** external "dns" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("dns");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("string_decoder");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var _Users_prantikchatterjee_Desktop_Apps_visitoriq_apps_web_app_api_collect_visitor_route_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./app/api/collect-visitor/route.ts */ \"(rsc)/./app/api/collect-visitor/route.ts\");\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/collect-visitor/route\",\n        pathname: \"/api/collect-visitor\",\n        filename: \"route\",\n        bundlePath: \"app/api/collect-visitor/route\"\n    },\n    resolvedPagePath: \"/Users/prantikchatterjee/Desktop/Apps/visitoriq/apps/web/app/api/collect-visitor/route.ts\",\n    nextConfigOutput,\n    userland: _Users_prantikchatterjee_Desktop_Apps_visitoriq_apps_web_app_api_collect_visitor_route_ts__WEBPACK_IMPORTED_MODULE_2__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/collect-visitor/route\";\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGY29sbGVjdC12aXNpdG9yJTJGcm91dGUmcGFnZT0lMkZhcGklMkZjb2xsZWN0LXZpc2l0b3IlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjb2xsZWN0LXZpc2l0b3IlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZwcmFudGlrY2hhdHRlcmplZSUyRkRlc2t0b3AlMkZBcHBzJTJGdmlzaXRvcmlxJTJGYXBwcyUyRndlYiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZwcmFudGlrY2hhdHRlcmplZSUyRkRlc2t0b3AlMkZBcHBzJTJGdmlzaXRvcmlxJTJGYXBwcyUyRndlYiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDdUQ7QUFDdEg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDaUo7O0FBRWpKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvP2E3YmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3ByYW50aWtjaGF0dGVyamVlL0Rlc2t0b3AvQXBwcy92aXNpdG9yaXEvYXBwcy93ZWIvYXBwL2FwaS9jb2xsZWN0LXZpc2l0b3Ivcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NvbGxlY3QtdmlzaXRvci9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NvbGxlY3QtdmlzaXRvclwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY29sbGVjdC12aXNpdG9yL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL3ByYW50aWtjaGF0dGVyamVlL0Rlc2t0b3AvQXBwcy92aXNpdG9yaXEvYXBwcy93ZWIvYXBwL2FwaS9jb2xsZWN0LXZpc2l0b3Ivcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY29sbGVjdC12aXNpdG9yL3JvdXRlXCI7XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/collect-visitor/route.ts":
/*!******************************************!*\
  !*** ./app/api/collect-visitor/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   emailIsDisposable: () => (/* binding */ emailIsDisposable),\n/* harmony export */   ipInList: () => (/* binding */ ipInList)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/../../node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/../../node_modules/next/headers.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_headers__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/zod/v3/types.js\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/redis */ \"(rsc)/./lib/redis.ts\");\n/* harmony import */ var _lib_ipinfo__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/ipinfo */ \"(rsc)/./lib/ipinfo.ts\");\n/* harmony import */ var _lib_abuse__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/abuse */ \"(rsc)/./lib/abuse.ts\");\n/* harmony import */ var _lib_velocity__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/velocity */ \"(rsc)/./lib/velocity.ts\");\n/* harmony import */ var _lib_risk__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/lib/risk */ \"(rsc)/./lib/risk.ts\");\n/* harmony import */ var _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @/lib/supabaseServer */ \"(rsc)/./lib/supabaseServer.ts\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! uuid */ \"(rsc)/../../node_modules/uuid/dist/esm-node/v5.js\");\nconsole.log(\"[CASCADE DEBUG] collect-visitor route.ts loaded\");\n\n\n\n\n\n\n\n\n\n\n\n// OSS Tor/Proxy/Disposable Email helpers (module scope for ES5 strict mode)\nasync function ipInList(ip, file) {\n    try {\n        const { readFile } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs/promises */ \"fs/promises\", 23));\n        const data = await readFile(file, \"utf8\");\n        const set = new Set(data.split(\"\\n\").map((l)=>l.trim()).filter(Boolean));\n        return set.has(ip);\n    } catch  {\n        return false;\n    }\n}\nasync function emailIsDisposable(email, file) {\n    if (!email) return false;\n    const domain = email.split(\"@\")[1]?.toLowerCase();\n    if (!domain) return false;\n    try {\n        const { readFile } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs/promises */ \"fs/promises\", 23));\n        const data = await readFile(file, \"utf8\");\n        if (domain === \"zzz.com\" || domain === \"gmail.com\") {\n            // Log file path\n            console.log(\"[DISPOSABLE FILE PATH]\", file);\n            // Log first and last 20 lines\n            const lines = data.split(\"\\n\");\n            console.log(\"[DISPOSABLE FILE HEAD]\", lines.slice(0, 20));\n            console.log(\"[DISPOSABLE FILE TAIL]\", lines.slice(-20));\n            // Log last 200 chars\n            console.log(\"[DISPOSABLE RAW FILE]\", JSON.stringify(data.slice(-200)), \"LENGTH:\", data.length);\n        }\n        // Defensive: trim domain and all set values\n        // Remove invisible characters and normalize lines\n        const clean = (s)=>s.replace(/[\\u200B-\\u200D\\uFEFF\\r\\n\\t ]+/g, \"\").toLowerCase();\n        const set = new Set(data.split(\"\\n\").map((l)=>clean(l)).filter(Boolean));\n        return set.has(clean(domain));\n    } catch  {\n        return false;\n    }\n}\nconst CollectVisitorSchema = zod__WEBPACK_IMPORTED_MODULE_9__.object({\n    siteKey: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    fingerprint_hash: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    userAgent: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    language: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    timezone: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    resolution: zod__WEBPACK_IMPORTED_MODULE_9__.string(),\n    referrer: zod__WEBPACK_IMPORTED_MODULE_9__.string().optional(),\n    incognito: zod__WEBPACK_IMPORTED_MODULE_9__.boolean().optional(),\n    webdriver: zod__WEBPACK_IMPORTED_MODULE_9__.boolean().optional(),\n    thumbmark_signals: zod__WEBPACK_IMPORTED_MODULE_9__.any().optional(),\n    thumbmark_details: zod__WEBPACK_IMPORTED_MODULE_9__.any().optional(),\n    email: zod__WEBPACK_IMPORTED_MODULE_9__.string().email().optional(),\n    phone: zod__WEBPACK_IMPORTED_MODULE_9__.string().optional(),\n    name: zod__WEBPACK_IMPORTED_MODULE_9__.string().optional(),\n    botd_result: zod__WEBPACK_IMPORTED_MODULE_9__.any().optional()\n});\nfunction withCORS(res) {\n    res.headers.set(\"Access-Control-Allow-Origin\", \"http://localhost:8080\");\n    res.headers.set(\"Vary\", \"Origin\");\n    return res;\n}\nasync function OPTIONS(request) {\n    return new Response(null, {\n        status: 204,\n        headers: {\n            \"Access-Control-Allow-Origin\": \"http://localhost:8080\",\n            \"Access-Control-Allow-Methods\": \"POST,OPTIONS\",\n            \"Access-Control-Allow-Headers\": \"Content-Type\",\n            \"Access-Control-Max-Age\": \"86400\"\n        }\n    });\n}\nfunction normalizeBotdResult(botd) {\n    if (!botd) return undefined;\n    // If BotD OSS result is just {bot: false}, normalize to {result: 'notDetected'}\n    if (typeof botd === \"object\" && botd !== null && botd.bot === false) {\n        return {\n            result: \"notDetected\"\n        };\n    }\n    return botd;\n}\nasync function POST(req) {\n    try {\n        const body = await req.json();\n        const parse = CollectVisitorSchema.safeParse(body);\n        if (!parse.success) {\n            return withCORS(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Invalid body\",\n                details: parse.error.errors\n            }, {\n                status: 400\n            }));\n        }\n        const { siteKey, fingerprint_hash, userAgent, language, timezone, resolution, referrer = \"\", incognito = false, webdriver = false, thumbmark_signals, email, phone, name, botd_result } = parse.data;\n        // IP detection\n        const ip = ((0,next_headers__WEBPACK_IMPORTED_MODULE_2__.headers)().get(\"x-forwarded-for\")?.split(\",\")[0] ?? req.ip ?? req.socket?.remoteAddress ?? \"\").trim();\n        if (!ip) return withCORS(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"IP not found\"\n        }, {\n            status: 400\n        }));\n        // OSS Tor/Proxy/Disposable Email checks\n        // OSS Tor/Proxy/Disposable Email checks (async, robust)\n        // Use correct path for disposable email domains\n        // Correct path to disposable-email-domains.txt from monorepo root\n        const disposableFilePath = path__WEBPACK_IMPORTED_MODULE_1___default().resolve(process.cwd(), \"../../packages/disposable-email-domains.txt\");\n        let debugTempEmailDomain = \"\";\n        let debugTempEmailResult = false;\n        // Log the resolved path and file existence\n        const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n        if (email) {\n            debugTempEmailDomain = email.split(\"@\")[1]?.toLowerCase();\n            debugTempEmailResult = await emailIsDisposable(email, disposableFilePath);\n        }\n        const [isTor, isProxy] = await Promise.all([\n            ipInList(ip, path__WEBPACK_IMPORTED_MODULE_1___default().join(__dirname, \"../../../packages/tor-exit-nodes.txt\")),\n            ipInList(ip, path__WEBPACK_IMPORTED_MODULE_1___default().join(__dirname, \"../../../packages/proxy-list.txt\"))\n        ]);\n        const isTempEmail = debugTempEmailResult;\n        // Rate limit\n        const rl = await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_3__.tokenBucket)(`rl:${ip}`, 60, 1);\n        if (!rl.allowed) return withCORS(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"rate_limited\"\n        }, {\n            status: 429\n        }));\n        // IPInfo\n        const info = await (0,_lib_ipinfo__WEBPACK_IMPORTED_MODULE_4__.getIPInfo)(ip);\n        // Timezone mismatch (MVP: compare string presence)\n        let timezoneMismatch = false;\n        if (info?.timezone && timezone) {\n            timezoneMismatch = info.timezone !== timezone;\n        } else {\n            timezoneMismatch = true;\n        }\n        // AbuseIPDB\n        const abuse = await (0,_lib_abuse__WEBPACK_IMPORTED_MODULE_5__.checkAbuseIP)(ip);\n        // Velocity\n        // Use visitor_id for velocityCount as per schema\n        // If you do not have visitor_id from the request, generate one (UUID) or derive it deterministically\n        // Use fingerprint_hash (or thumbmark hash) as stable visitor_id if possible\n        let visitor_id = fingerprint_hash;\n        // If not a valid UUID, create a deterministic UUID from the hash\n        const uuidValidate = (v)=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(v);\n        if (!uuidValidate(visitor_id)) {\n            // Use a deterministic UUID based on the hash (v5, but simple fallback here)\n            const NAMESPACE = \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\"; // DNS namespace\n            visitor_id = (0,uuid__WEBPACK_IMPORTED_MODULE_10__[\"default\"])(fingerprint_hash, NAMESPACE);\n        }\n        const v = await (0,_lib_velocity__WEBPACK_IMPORTED_MODULE_6__.velocityCount)(_lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer, siteKey, visitor_id, 60);\n        // Compute risk\n        const vpnDetected = info?.privacy?.vpn || info?.privacy?.hosting || false;\n        const { score, verdict } = (0,_lib_risk__WEBPACK_IMPORTED_MODULE_7__.computeRisk)({\n            incognito,\n            vpn: vpnDetected,\n            timezoneMismatch,\n            webdriver,\n            abuseListed: abuse.blocklisted,\n            velocityCount: v\n        });\n        // Manual blocklist\n        let action = \"manual_review\";\n        let manualBlock = false;\n        let blockId = null;\n        let blockReason = null;\n        const { data: blocks } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"manual_blocks\").select(\"id,reason\").eq(\"site_key\", siteKey).or(`fingerprint_hash.eq.${fingerprint_hash},ip.eq.${ip}`).is(\"expires_at\", null).limit(1);\n        if (blocks && blocks.length > 0) {\n            manualBlock = true;\n            blockId = blocks[0].id;\n            blockReason = blocks[0].reason;\n        }\n        let finalScore = score;\n        let finalVerdict = verdict;\n        if (manualBlock) {\n            action = \"auto_block\";\n            finalScore = 100;\n            finalVerdict = \"high\";\n        }\n        // Lookup site_id and repeat_signup_limit from sites table using api_key\n        const { data: siteRow, error: siteError } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"sites\").select(\"id, repeat_signup_limit\").eq(\"api_key\", siteKey).maybeSingle();\n        if (!siteRow || siteError) {\n            return withCORS(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"invalid_site_key\",\n                details: \"Site not found for provided siteKey\"\n            }, {\n                status: 400\n            }));\n        }\n        // Upsert visitor before inserting event to satisfy FK constraint\n        await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"visitors\").upsert({\n            id: visitor_id,\n            site_id: siteRow.id,\n            visitor_id: visitor_id.toString(),\n            fingerprint: fingerprint_hash,\n            thumbmark: thumbmark_signals?.hash || \"\",\n            user_agent: userAgent,\n            screen_resolution: resolution,\n            timezone,\n            language,\n            platform: \"\",\n            ip_address: ip,\n            country: info?.country ?? \"\",\n            city: info?.city ?? \"\",\n            region: info?.region ?? \"\",\n            isp: info?.org ?? \"\",\n            is_bot: false,\n            email: email || null,\n            phone: phone || null,\n            name: name || null,\n            botd_result: botd_result || null,\n            risk_score: 0,\n            is_tor: isTor,\n            is_proxy: isProxy,\n            is_temp_email: isTempEmail\n        }, {\n            onConflict: \"id\"\n        });\n        // Insert event\n        // Insert event using only schema fields and available data\n        const { data: inserted, error: insertErr } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"events\").insert({\n            site_id: siteRow.id,\n            visitor_id,\n            event_type: \"page_view\",\n            event_name: \"page_view\",\n            url: \"\",\n            referrer,\n            properties: {\n                fingerprint_hash,\n                thumbmark_signals,\n                thumbmark_details: body.thumbmark_details || {},\n                risk_score: finalScore,\n                verdict: finalVerdict,\n                ip,\n                ip_city: info?.city ?? \"\",\n                ip_country: info?.country ?? \"\",\n                ip_org: info?.org ?? \"\",\n                email: body.email || undefined,\n                botd_result: normalizeBotdResult(body.botd_result),\n                is_tor: isTor,\n                is_proxy: isProxy,\n                is_temp_email: !!isTempEmail,\n                vpnDetected,\n                is_bot: false,\n                // Ensure these are always present for frontend display\n                browser: body.browser || \"\",\n                os: body.os || \"\",\n                resolution: body.resolution || \"\",\n                timezone: body.timezone || \"\",\n                userAgent: body.userAgent || \"\",\n                signals: Array.isArray(body.signals) ? body.signals : body.thumbmark_signals?.signals || [],\n                // Advanced detection fields\n                gps_location: body.geo && body.geo.lat && body.geo.lon ? {\n                    lat: body.geo.lat,\n                    lon: body.geo.lon,\n                    accuracy: body.geo.accuracy\n                } : undefined,\n                gps_permission: body.geo?.permission,\n                emulator_detected: !!body.emulator?.isEmulator,\n                emulator_reasons: body.emulator?.reasons || [],\n                geo_mismatch: body.geo && body.geo.lat && body.geo.lon && info && info.loc ? Math.abs(body.geo.lat - info.loc[0]) > 0.5 || Math.abs(body.geo.lon - info.loc[1]) > 0.5 : false,\n                location_spoofed: body.geo && body.geo.lat && body.geo.lon && info && info.loc ? Math.abs(body.geo.lat - info.loc[0]) > 1.5 || Math.abs(body.geo.lon - info.loc[1]) > 1.5 : false\n            },\n            timestamp: new Date().toISOString()\n        }).select(\"id\").single();\n        if (insertErr) {\n            return withCORS(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"db_insert_failed\",\n                details: insertErr.message\n            }, {\n                status: 500\n            }));\n        }\n        // Get client settings\n        const { data: clientApp } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"client_apps\").select(\"auto_block, risk_threshold, share_reputation\").eq(\"site_key\", siteKey).maybeSingle();\n        const risk_threshold = clientApp?.risk_threshold ?? 80;\n        const auto_block = clientApp?.auto_block ?? false;\n        const share_reputation = clientApp?.share_reputation ?? false;\n        // Decide action\n        if (auto_block && finalScore >= risk_threshold) {\n            action = \"auto_block\";\n        }\n        // Share reputation\n        if (share_reputation && finalVerdict === \"high\") {\n            await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_8__.supabaseServer.from(\"global_reputation\").upsert({\n                fingerprint_hash,\n                ip,\n                abuse_count: 1,\n                last_seen: new Date().toISOString()\n            }, {\n                onConflict: \"fingerprint_hash,ip\"\n            });\n        }\n        return withCORS(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            risk_score: finalScore,\n            verdict: finalVerdict,\n            action,\n            visitor_event_id: inserted.id,\n            signals: {\n                vpnDetected,\n                timezoneMismatch,\n                velocityCount: v\n            }\n        }));\n    } catch (err) {\n        return withCORS(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"server_error\",\n            details: err.message\n        }, {\n            status: 500\n        }));\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2NvbGxlY3QtdmlzaXRvci9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxRQUFRQyxHQUFHLENBQUM7QUFDOEI7QUFDbEI7QUFFYztBQUNmO0FBQ3lCO0FBQ1I7QUFDRTtBQUNJO0FBQ047QUFDYTtBQUNqQjtBQUVwQyw0RUFBNEU7QUFDckUsZUFBZWEsU0FBU0MsRUFBVSxFQUFFQyxJQUFZO0lBQ3JELElBQUk7UUFDRixNQUFNLEVBQUVDLFFBQVEsRUFBRSxHQUFHLE1BQU0sNEhBQU87UUFDbEMsTUFBTUMsT0FBTyxNQUFNRCxTQUFTRCxNQUFNO1FBQ2xDLE1BQU1HLE1BQU0sSUFBSUMsSUFBSUYsS0FBS0csS0FBSyxDQUFDLE1BQU1DLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsSUFBSSxJQUFJQyxNQUFNLENBQUNDO1FBQy9ELE9BQU9QLElBQUlRLEdBQUcsQ0FBQ1o7SUFDakIsRUFBRSxPQUFNO1FBQUUsT0FBTztJQUFPO0FBQzFCO0FBRU8sZUFBZWEsa0JBQWtCQyxLQUFhLEVBQUViLElBQVk7SUFDakUsSUFBSSxDQUFDYSxPQUFPLE9BQU87SUFDbkIsTUFBTUMsU0FBU0QsTUFBTVIsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUVVO0lBQ3BDLElBQUksQ0FBQ0QsUUFBUSxPQUFPO0lBQ3BCLElBQUk7UUFDRixNQUFNLEVBQUViLFFBQVEsRUFBRSxHQUFHLE1BQU0sNEhBQU87UUFDbEMsTUFBTUMsT0FBTyxNQUFNRCxTQUFTRCxNQUFNO1FBQ2xDLElBQUljLFdBQVcsYUFBYUEsV0FBVyxhQUFhO1lBQ2xELGdCQUFnQjtZQUNoQjlCLFFBQVFDLEdBQUcsQ0FBQywwQkFBMEJlO1lBQ3RDLDhCQUE4QjtZQUM5QixNQUFNZ0IsUUFBUWQsS0FBS0csS0FBSyxDQUFDO1lBQ3pCckIsUUFBUUMsR0FBRyxDQUFDLDBCQUEwQitCLE1BQU1DLEtBQUssQ0FBQyxHQUFHO1lBQ3JEakMsUUFB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NEUsWUFBWXJCO1lBQ1poQixTQUFTaUI7WUFDVGQ7WUFDQWtGLGtCQUFrQjNDLFNBQVM1QixFQUFFO1lBQzdCd0MsU0FBUztnQkFDUDNEO2dCQUNBUDtnQkFDQTVGLGVBQWVnRztZQUNqQjtRQUNGO0lBQ0YsRUFBRSxPQUFPOEYsS0FBVTtRQUNqQixPQUFPM0ksU0FBUzFELGtGQUFZQSxDQUFDd0UsSUFBSSxDQUFDO1lBQUVJLE9BQU87WUFBZ0JDLFNBQVN3SCxJQUFJUixPQUFPO1FBQUMsR0FBRztZQUFFOUgsUUFBUTtRQUFJO0lBQ25HO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AdmlzaXRvcmlxL3dlYi8uL2FwcC9hcGkvY29sbGVjdC12aXNpdG9yL3JvdXRlLnRzP2UzZWIiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc29sZS5sb2coJ1tDQVNDQURFIERFQlVHXSBjb2xsZWN0LXZpc2l0b3Igcm91dGUudHMgbG9hZGVkJyk7XG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZmlsZVVSTFRvUGF0aCB9IGZyb20gJ3VybCc7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJ1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCdcbmltcG9ydCB7IHJlZGlzLCB0b2tlbkJ1Y2tldCB9IGZyb20gJ0AvbGliL3JlZGlzJ1xuaW1wb3J0IHsgZ2V0SVBJbmZvIH0gZnJvbSAnQC9saWIvaXBpbmZvJ1xuaW1wb3J0IHsgY2hlY2tBYnVzZUlQIH0gZnJvbSAnQC9saWIvYWJ1c2UnXG5pbXBvcnQgeyB2ZWxvY2l0eUNvdW50IH0gZnJvbSAnQC9saWIvdmVsb2NpdHknXG5pbXBvcnQgeyBjb21wdXRlUmlzayB9IGZyb20gJ0AvbGliL3Jpc2snXG5pbXBvcnQgeyBzdXBhYmFzZVNlcnZlciB9IGZyb20gJ0AvbGliL3N1cGFiYXNlU2VydmVyJ1xuaW1wb3J0IHsgdjUgYXMgdXVpZHY1IH0gZnJvbSAndXVpZCc7XG5cbi8vIE9TUyBUb3IvUHJveHkvRGlzcG9zYWJsZSBFbWFpbCBoZWxwZXJzIChtb2R1bGUgc2NvcGUgZm9yIEVTNSBzdHJpY3QgbW9kZSlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpcEluTGlzdChpcDogc3RyaW5nLCBmaWxlOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHJlYWRGaWxlIH0gPSBhd2FpdCBpbXBvcnQoJ2ZzL3Byb21pc2VzJyk7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlYWRGaWxlKGZpbGUsICd1dGY4Jyk7XG4gICAgY29uc3Qgc2V0ID0gbmV3IFNldChkYXRhLnNwbGl0KCdcXG4nKS5tYXAobCA9PiBsLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pKTtcbiAgICByZXR1cm4gc2V0LmhhcyhpcCk7XG4gIH0gY2F0Y2ggeyByZXR1cm4gZmFsc2U7IH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVtYWlsSXNEaXNwb3NhYmxlKGVtYWlsOiBzdHJpbmcsIGZpbGU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBpZiAoIWVtYWlsKSByZXR1cm4gZmFsc2U7XG4gIGNvbnN0IGRvbWFpbiA9IGVtYWlsLnNwbGl0KCdAJylbMV0/LnRvTG93ZXJDYXNlKCk7XG4gIGlmICghZG9tYWluKSByZXR1cm4gZmFsc2U7XG4gIHRyeSB7XG4gICAgY29uc3QgeyByZWFkRmlsZSB9ID0gYXdhaXQgaW1wb3J0KCdmcy9wcm9taXNlcycpO1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZWFkRmlsZShmaWxlLCAndXRmOCcpO1xuICAgIGlmIChkb21haW4gPT09ICd6enouY29tJyB8fCBkb21haW4gPT09ICdnbWFpbC5jb20nKSB7XG4gICAgICAvLyBMb2cgZmlsZSBwYXRoXG4gICAgICBjb25zb2xlLmxvZygnW0RJU1BPU0FCTEUgRklMRSBQQVRIXScsIGZpbGUpO1xuICAgICAgLy8gTG9nIGZpcnN0IGFuZCBsYXN0IDIwIGxpbmVzXG4gICAgICBjb25zdCBsaW5lcyA9IGRhdGEuc3BsaXQoJ1xcbicpO1xuICAgICAgY29uc29sZS5sb2coJ1tESVNQT1NBQkxFIEZJTEUgSEVBRF0nLCBsaW5lcy5zbGljZSgwLCAyMCkpO1xuICAgICAgY29uc29sZS5sb2coJ1tESVNQT1NBQkxFIEZJTEUgVEFJTF0nLCBsaW5lcy5zbGljZSgtMjApKTtcbiAgICAgIC8vIExvZyBsYXN0IDIwMCBjaGFyc1xuICAgICAgY29uc29sZS5sb2coJ1tESVNQT1NBQkxFIFJBVyBGSUxFXScsIEpTT04uc3RyaW5naWZ5KGRhdGEuc2xpY2UoLTIwMCkpLCAnTEVOR1RIOicsIGRhdGEubGVuZ3RoKTtcbiAgICB9XG4gICAgLy8gRGVmZW5zaXZlOiB0cmltIGRvbWFpbiBhbmQgYWxsIHNldCB2YWx1ZXNcbiAgICAvLyBSZW1vdmUgaW52aXNpYmxlIGNoYXJhY3RlcnMgYW5kIG5vcm1hbGl6ZSBsaW5lc1xuICAgIGNvbnN0IGNsZWFuID0gKHM6IHN0cmluZykgPT4gcy5yZXBsYWNlKC9bXFx1MjAwQi1cXHUyMDBEXFx1RkVGRlxcclxcblxcdCBdKy9nLCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBzZXQgPSBuZXcgU2V0KGRhdGEuc3BsaXQoJ1xcbicpLm1hcChsID0+IGNsZWFuKGwpKS5maWx0ZXIoQm9vbGVhbikpO1xuICAgIHJldHVybiBzZXQuaGFzKGNsZWFuKGRvbWFpbikpO1xuICB9IGNhdGNoIHsgcmV0dXJuIGZhbHNlOyB9XG59XG5cbmNvbnN0IENvbGxlY3RWaXNpdG9yU2NoZW1hID0gei5vYmplY3Qoe1xuICBzaXRlS2V5OiB6LnN0cmluZygpLFxuICBmaW5nZXJwcmludF9oYXNoOiB6LnN0cmluZygpLFxuICB1c2VyQWdlbnQ6IHouc3RyaW5nKCksXG4gIGxhbmd1YWdlOiB6LnN0cmluZygpLFxuICB0aW1lem9uZTogei5zdHJpbmcoKSxcbiAgcmVzb2x1dGlvbjogei5zdHJpbmcoKSxcbiAgcmVmZXJyZXI6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgaW5jb2duaXRvOiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICB3ZWJkcml2ZXI6IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gIHRodW1ibWFya19zaWduYWxzOiB6LmFueSgpLm9wdGlvbmFsKCksXG4gIHRodW1ibWFya19kZXRhaWxzOiB6LmFueSgpLm9wdGlvbmFsKCksXG4gIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCkub3B0aW9uYWwoKSxcbiAgcGhvbmU6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgbmFtZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBib3RkX3Jlc3VsdDogei5hbnkoKS5vcHRpb25hbCgpLFxufSlcblxuZnVuY3Rpb24gd2l0aENPUlMocmVzOiBSZXNwb25zZSkge1xuICByZXMuaGVhZGVycy5zZXQoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICdodHRwOi8vbG9jYWxob3N0OjgwODAnKTtcbiAgcmVzLmhlYWRlcnMuc2V0KCdWYXJ5JywgJ09yaWdpbicpO1xuICByZXR1cm4gcmVzO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gT1BUSU9OUyhyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgIHN0YXR1czogMjA0LFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCI6IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwXCIsXG4gICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHNcIjogXCJQT1NULE9QVElPTlNcIixcbiAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiOiBcIkNvbnRlbnQtVHlwZVwiLFxuICAgICAgXCJBY2Nlc3MtQ29udHJvbC1NYXgtQWdlXCI6IFwiODY0MDBcIlxuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUJvdGRSZXN1bHQoYm90ZDogYW55KSB7XG4gIGlmICghYm90ZCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgLy8gSWYgQm90RCBPU1MgcmVzdWx0IGlzIGp1c3Qge2JvdDogZmFsc2V9LCBub3JtYWxpemUgdG8ge3Jlc3VsdDogJ25vdERldGVjdGVkJ31cbiAgaWYgKHR5cGVvZiBib3RkID09PSAnb2JqZWN0JyAmJiBib3RkICE9PSBudWxsICYmIGJvdGQuYm90ID09PSBmYWxzZSkge1xuICAgIHJldHVybiB7IHJlc3VsdDogJ25vdERldGVjdGVkJyB9O1xuICB9XG4gIHJldHVybiBib3RkO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKVxuICAgIGNvbnN0IHBhcnNlID0gQ29sbGVjdFZpc2l0b3JTY2hlbWEuc2FmZVBhcnNlKGJvZHkpXG4gICAgaWYgKCFwYXJzZS5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gd2l0aENPUlMoTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgYm9keScsIGRldGFpbHM6IHBhcnNlLmVycm9yLmVycm9ycyB9LCB7IHN0YXR1czogNDAwIH0pKVxuICAgIH1cbiAgICBjb25zdCB7XG4gICAgICBzaXRlS2V5LCBmaW5nZXJwcmludF9oYXNoLCB1c2VyQWdlbnQsIGxhbmd1YWdlLCB0aW1lem9uZSwgcmVzb2x1dGlvbiwgcmVmZXJyZXIgPSAnJywgaW5jb2duaXRvID0gZmFsc2UsIHdlYmRyaXZlciA9IGZhbHNlLCB0aHVtYm1hcmtfc2lnbmFscywgZW1haWwsIHBob25lLCBuYW1lLCBib3RkX3Jlc3VsdFxuICAgIH0gPSBwYXJzZS5kYXRhXG5cbiAgICAvLyBJUCBkZXRlY3Rpb25cbiAgICBjb25zdCBpcCA9IChoZWFkZXJzKCkuZ2V0KCd4LWZvcndhcmRlZC1mb3InKT8uc3BsaXQoJywnKVswXSA/PyAocmVxIGFzIGFueSkuaXAgPz8gKHJlcSBhcyBhbnkpLnNvY2tldD8ucmVtb3RlQWRkcmVzcyA/PyAnJykudHJpbSgpXG4gICAgaWYgKCFpcCkgcmV0dXJuIHdpdGhDT1JTKE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJUCBub3QgZm91bmQnIH0sIHsgc3RhdHVzOiA0MDAgfSkpXG5cbiAgICAvLyBPU1MgVG9yL1Byb3h5L0Rpc3Bvc2FibGUgRW1haWwgY2hlY2tzXG4gICAgLy8gT1NTIFRvci9Qcm94eS9EaXNwb3NhYmxlIEVtYWlsIGNoZWNrcyAoYXN5bmMsIHJvYnVzdClcbiAgICAvLyBVc2UgY29ycmVjdCBwYXRoIGZvciBkaXNwb3NhYmxlIGVtYWlsIGRvbWFpbnNcbiAgICAvLyBDb3JyZWN0IHBhdGggdG8gZGlzcG9zYWJsZS1lbWFpbC1kb21haW5zLnR4dCBmcm9tIG1vbm9yZXBvIHJvb3RcbiAgICBjb25zdCBkaXNwb3NhYmxlRmlsZVBhdGggPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgJy4uLy4uL3BhY2thZ2VzL2Rpc3Bvc2FibGUtZW1haWwtZG9tYWlucy50eHQnKTtcbiAgICBsZXQgZGVidWdUZW1wRW1haWxEb21haW4gPSAnJztcbiAgICBsZXQgZGVidWdUZW1wRW1haWxSZXN1bHQgPSBmYWxzZTtcbiAgICAvLyBMb2cgdGhlIHJlc29sdmVkIHBhdGggYW5kIGZpbGUgZXhpc3RlbmNlXG4gICAgY29uc3QgZnMgPSBhd2FpdCBpbXBvcnQoJ2ZzJyk7XG4gICAgICAgICAgICBpZiAoZW1haWwpIHtcbiAgICAgIGRlYnVnVGVtcEVtYWlsRG9tYWluID0gZW1haWwuc3BsaXQoJ0AnKVsxXT8udG9Mb3dlckNhc2UoKTtcbiAgICAgIGRlYnVnVGVtcEVtYWlsUmVzdWx0ID0gYXdhaXQgZW1haWxJc0Rpc3Bvc2FibGUoZW1haWwsIGRpc3Bvc2FibGVGaWxlUGF0aCk7XG4gICAgICAgICAgfVxuICAgIGNvbnN0IFtpc1RvciwgaXNQcm94eV0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBpcEluTGlzdChpcCwgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uL3BhY2thZ2VzL3Rvci1leGl0LW5vZGVzLnR4dCcpKSxcbiAgICAgIGlwSW5MaXN0KGlwLCBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vcGFja2FnZXMvcHJveHktbGlzdC50eHQnKSlcbiAgICBdKTtcbiAgICBjb25zdCBpc1RlbXBFbWFpbCA9IGRlYnVnVGVtcEVtYWlsUmVzdWx0O1xuXG5cbiAgICAvLyBSYXRlIGxpbWl0XG4gICAgY29uc3QgcmwgPSBhd2FpdCB0b2tlbkJ1Y2tldChgcmw6JHtpcH1gLCA2MCwgMSlcbiAgICBpZiAoIXJsLmFsbG93ZWQpIHJldHVybiB3aXRoQ09SUyhOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAncmF0ZV9saW1pdGVkJyB9LCB7IHN0YXR1czogNDI5IH0pKVxuXG4gICAgLy8gSVBJbmZvXG4gICAgY29uc3QgaW5mbyA9IGF3YWl0IGdldElQSW5mbyhpcClcblxuICAgIC8vIFRpbWV6b25lIG1pc21hdGNoIChNVlA6IGNvbXBhcmUgc3RyaW5nIHByZXNlbmNlKVxuICAgIGxldCB0aW1lem9uZU1pc21hdGNoID0gZmFsc2VcbiAgICBpZiAoaW5mbz8udGltZXpvbmUgJiYgdGltZXpvbmUpIHtcbiAgICAgIHRpbWV6b25lTWlzbWF0Y2ggPSBpbmZvLnRpbWV6b25lICE9PSB0aW1lem9uZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aW1lem9uZU1pc21hdGNoID0gdHJ1ZVxuICAgIH1cblxuICAgIC8vIEFidXNlSVBEQlxuICAgIGNvbnN0IGFidXNlID0gYXdhaXQgY2hlY2tBYnVzZUlQKGlwKVxuXG4gICAgLy8gVmVsb2NpdHlcbiAgICAvLyBVc2UgdmlzaXRvcl9pZCBmb3IgdmVsb2NpdHlDb3VudCBhcyBwZXIgc2NoZW1hXG4gICAgLy8gSWYgeW91IGRvIG5vdCBoYXZlIHZpc2l0b3JfaWQgZnJvbSB0aGUgcmVxdWVzdCwgZ2VuZXJhdGUgb25lIChVVUlEKSBvciBkZXJpdmUgaXQgZGV0ZXJtaW5pc3RpY2FsbHlcbiAgICAvLyBVc2UgZmluZ2VycHJpbnRfaGFzaCAob3IgdGh1bWJtYXJrIGhhc2gpIGFzIHN0YWJsZSB2aXNpdG9yX2lkIGlmIHBvc3NpYmxlXG4gICAgbGV0IHZpc2l0b3JfaWQgPSBmaW5nZXJwcmludF9oYXNoO1xuICAgIC8vIElmIG5vdCBhIHZhbGlkIFVVSUQsIGNyZWF0ZSBhIGRldGVybWluaXN0aWMgVVVJRCBmcm9tIHRoZSBoYXNoXG4gICAgY29uc3QgdXVpZFZhbGlkYXRlID0gKHY6IHN0cmluZykgPT4gL15bMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMS01XVswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfSQvaS50ZXN0KHYpO1xuICAgIGlmICghdXVpZFZhbGlkYXRlKHZpc2l0b3JfaWQpKSB7XG4gICAgICAvLyBVc2UgYSBkZXRlcm1pbmlzdGljIFVVSUQgYmFzZWQgb24gdGhlIGhhc2ggKHY1LCBidXQgc2ltcGxlIGZhbGxiYWNrIGhlcmUpXG4gICAgICBjb25zdCBOQU1FU1BBQ0UgPSAnNmJhN2I4MTAtOWRhZC0xMWQxLTgwYjQtMDBjMDRmZDQzMGM4JzsgLy8gRE5TIG5hbWVzcGFjZVxuICAgICAgdmlzaXRvcl9pZCA9IHV1aWR2NShmaW5nZXJwcmludF9oYXNoLCBOQU1FU1BBQ0UpO1xuICAgIH1cbiAgICBjb25zdCB2ID0gYXdhaXQgdmVsb2NpdHlDb3VudChzdXBhYmFzZVNlcnZlciwgc2l0ZUtleSwgdmlzaXRvcl9pZCwgNjApXG5cbiAgICAvLyBDb21wdXRlIHJpc2tcbiAgICBjb25zdCB2cG5EZXRlY3RlZCA9IGluZm8/LnByaXZhY3k/LnZwbiB8fCBpbmZvPy5wcml2YWN5Py5ob3N0aW5nIHx8IGZhbHNlXG4gICAgY29uc3QgeyBzY29yZSwgdmVyZGljdCB9ID0gY29tcHV0ZVJpc2soe1xuICAgICAgaW5jb2duaXRvLFxuICAgICAgdnBuOiB2cG5EZXRlY3RlZCxcbiAgICAgIHRpbWV6b25lTWlzbWF0Y2gsXG4gICAgICB3ZWJkcml2ZXIsXG4gICAgICBhYnVzZUxpc3RlZDogYWJ1c2UuYmxvY2tsaXN0ZWQsXG4gICAgICB2ZWxvY2l0eUNvdW50OiB2XG4gICAgfSlcblxuICAgIC8vIE1hbnVhbCBibG9ja2xpc3RcbiAgICBsZXQgYWN0aW9uID0gJ21hbnVhbF9yZXZpZXcnXG4gICAgbGV0IG1hbnVhbEJsb2NrID0gZmFsc2VcbiAgICBsZXQgYmxvY2tJZDogc3RyaW5nIHwgbnVsbCA9IG51bGxcbiAgICBsZXQgYmxvY2tSZWFzb246IHN0cmluZyB8IG51bGwgPSBudWxsXG4gICAgY29uc3QgeyBkYXRhOiBibG9ja3MgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXG4gICAgICAuZnJvbSgnbWFudWFsX2Jsb2NrcycpXG4gICAgICAuc2VsZWN0KCdpZCxyZWFzb24nKVxuICAgICAgLmVxKCdzaXRlX2tleScsIHNpdGVLZXkpXG4gICAgICAub3IoYGZpbmdlcnByaW50X2hhc2guZXEuJHtmaW5nZXJwcmludF9oYXNofSxpcC5lcS4ke2lwfWApXG4gICAgICAuaXMoJ2V4cGlyZXNfYXQnLCBudWxsKVxuICAgICAgLmxpbWl0KDEpXG4gICAgaWYgKGJsb2NrcyAmJiBibG9ja3MubGVuZ3RoID4gMCkge1xuICAgICAgbWFudWFsQmxvY2sgPSB0cnVlXG4gICAgICBibG9ja0lkID0gYmxvY2tzWzBdLmlkXG4gICAgICBibG9ja1JlYXNvbiA9IGJsb2Nrc1swXS5yZWFzb25cbiAgICB9XG4gICAgbGV0IGZpbmFsU2NvcmUgPSBzY29yZVxuICAgIGxldCBmaW5hbFZlcmRpY3QgPSB2ZXJkaWN0XG4gICAgaWYgKG1hbnVhbEJsb2NrKSB7XG4gICAgICBhY3Rpb24gPSAnYXV0b19ibG9jaydcbiAgICAgIGZpbmFsU2NvcmUgPSAxMDBcbiAgICAgIGZpbmFsVmVyZGljdCA9ICdoaWdoJ1xuICAgIH1cblxuICAgIC8vIExvb2t1cCBzaXRlX2lkIGFuZCByZXBlYXRfc2lnbnVwX2xpbWl0IGZyb20gc2l0ZXMgdGFibGUgdXNpbmcgYXBpX2tleVxuICAgIGNvbnN0IHsgZGF0YTogc2l0ZVJvdywgZXJyb3I6IHNpdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXIuZnJvbSgnc2l0ZXMnKS5zZWxlY3QoJ2lkLCByZXBlYXRfc2lnbnVwX2xpbWl0JykuZXEoJ2FwaV9rZXknLCBzaXRlS2V5KS5tYXliZVNpbmdsZSgpO1xuICAgIGlmICghc2l0ZVJvdyB8fCBzaXRlRXJyb3IpIHtcbiAgICAgIHJldHVybiB3aXRoQ09SUyhOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnaW52YWxpZF9zaXRlX2tleScsIGRldGFpbHM6ICdTaXRlIG5vdCBmb3VuZCBmb3IgcHJvdmlkZWQgc2l0ZUtleScgfSwgeyBzdGF0dXM6IDQwMCB9KSk7XG4gICAgfVxuICAgIC8vIFVwc2VydCB2aXNpdG9yIGJlZm9yZSBpbnNlcnRpbmcgZXZlbnQgdG8gc2F0aXNmeSBGSyBjb25zdHJhaW50XG4gICAgYXdhaXQgc3VwYWJhc2VTZXJ2ZXIuZnJvbSgndmlzaXRvcnMnKS51cHNlcnQoe1xuICAgICAgaWQ6IHZpc2l0b3JfaWQsXG4gICAgICBzaXRlX2lkOiBzaXRlUm93LmlkLFxuICAgICAgdmlzaXRvcl9pZDogdmlzaXRvcl9pZC50b1N0cmluZygpLFxuICAgICAgZmluZ2VycHJpbnQ6IGZpbmdlcnByaW50X2hhc2gsXG4gICAgICB0aHVtYm1hcms6IHRodW1ibWFya19zaWduYWxzPy5oYXNoIHx8ICcnLFxuICAgICAgdXNlcl9hZ2VudDogdXNlckFnZW50LFxuICAgICAgc2NyZWVuX3Jlc29sdXRpb246IHJlc29sdXRpb24sXG4gICAgICB0aW1lem9uZSxcbiAgICAgIGxhbmd1YWdlLFxuICAgICAgcGxhdGZvcm06ICcnLFxuICAgICAgaXBfYWRkcmVzczogaXAsXG4gICAgICBjb3VudHJ5OiBpbmZvPy5jb3VudHJ5ID8/ICcnLFxuICAgICAgY2l0eTogaW5mbz8uY2l0eSA/PyAnJyxcbiAgICAgIHJlZ2lvbjogaW5mbz8ucmVnaW9uID8/ICcnLFxuICAgICAgaXNwOiBpbmZvPy5vcmcgPz8gJycsXG4gICAgICBpc19ib3Q6IGZhbHNlLFxuICAgICAgZW1haWw6IGVtYWlsIHx8IG51bGwsXG4gICAgICBwaG9uZTogcGhvbmUgfHwgbnVsbCxcbiAgICAgIG5hbWU6IG5hbWUgfHwgbnVsbCxcbiAgICAgIGJvdGRfcmVzdWx0OiBib3RkX3Jlc3VsdCB8fCBudWxsLFxuICAgICAgcmlza19zY29yZTogMCxcbiAgICAgIGlzX3RvcjogaXNUb3IsXG4gICAgICBpc19wcm94eTogaXNQcm94eSxcbiAgICAgIGlzX3RlbXBfZW1haWw6IGlzVGVtcEVtYWlsXG4gICAgfSwgeyBvbkNvbmZsaWN0OiAnaWQnIH0pO1xuICAgIC8vIEluc2VydCBldmVudFxuICAgIC8vIEluc2VydCBldmVudCB1c2luZyBvbmx5IHNjaGVtYSBmaWVsZHMgYW5kIGF2YWlsYWJsZSBkYXRhXG4gICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IGluc2VydEVyciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXIuZnJvbSgnZXZlbnRzJykuaW5zZXJ0KHtcbiAgICAgIHNpdGVfaWQ6IHNpdGVSb3cuaWQsXG4gICAgICB2aXNpdG9yX2lkLFxuICAgICAgZXZlbnRfdHlwZTogJ3BhZ2VfdmlldycsXG4gICAgICBldmVudF9uYW1lOiAncGFnZV92aWV3JyxcbiAgICAgIHVybDogJycsIC8vIE5vdCBhdmFpbGFibGUgZnJvbSBTREssIHNldCBibGFua1xuICAgICAgcmVmZXJyZXIsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGZpbmdlcnByaW50X2hhc2gsXG4gICAgICAgIHRodW1ibWFya19zaWduYWxzLFxuICAgICAgICB0aHVtYm1hcmtfZGV0YWlsczogYm9keS50aHVtYm1hcmtfZGV0YWlscyB8fCB7fSxcbiAgICAgICAgcmlza19zY29yZTogZmluYWxTY29yZSxcbiAgICAgICAgdmVyZGljdDogZmluYWxWZXJkaWN0LFxuICAgICAgICBpcCxcbiAgICAgICAgaXBfY2l0eTogaW5mbz8uY2l0eSA/PyAnJyxcbiAgICAgICAgaXBfY291bnRyeTogaW5mbz8uY291bnRyeSA/PyAnJyxcbiAgICAgICAgaXBfb3JnOiBpbmZvPy5vcmcgPz8gJycsXG4gICAgICAgIGVtYWlsOiBib2R5LmVtYWlsIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgYm90ZF9yZXN1bHQ6IG5vcm1hbGl6ZUJvdGRSZXN1bHQoYm9keS5ib3RkX3Jlc3VsdCksXG4gICAgICAgIGlzX3RvcjogaXNUb3IsXG4gICAgICAgIGlzX3Byb3h5OiBpc1Byb3h5LFxuICAgICAgICBpc190ZW1wX2VtYWlsOiAhIWlzVGVtcEVtYWlsLFxuICAgICAgICB2cG5EZXRlY3RlZCxcbiAgICAgICAgaXNfYm90OiBmYWxzZSwgLy8gdXBkYXRlIHdpdGggcmVhbCBkZXRlY3Rpb24gaWYgYXZhaWxhYmxlXG4gICAgICAgIC8vIEVuc3VyZSB0aGVzZSBhcmUgYWx3YXlzIHByZXNlbnQgZm9yIGZyb250ZW5kIGRpc3BsYXlcbiAgICAgICAgYnJvd3NlcjogYm9keS5icm93c2VyIHx8ICcnLFxuICAgICAgICBvczogYm9keS5vcyB8fCAnJyxcbiAgICAgICAgcmVzb2x1dGlvbjogYm9keS5yZXNvbHV0aW9uIHx8ICcnLFxuICAgICAgICB0aW1lem9uZTogYm9keS50aW1lem9uZSB8fCAnJyxcbiAgICAgICAgdXNlckFnZW50OiBib2R5LnVzZXJBZ2VudCB8fCAnJyxcbiAgICAgICAgc2lnbmFsczogQXJyYXkuaXNBcnJheShib2R5LnNpZ25hbHMpID8gYm9keS5zaWduYWxzIDogKGJvZHkudGh1bWJtYXJrX3NpZ25hbHM/LnNpZ25hbHMgfHwgW10pLFxuICAgICAgICAvLyBBZHZhbmNlZCBkZXRlY3Rpb24gZmllbGRzXG4gICAgICAgIGdwc19sb2NhdGlvbjogYm9keS5nZW8gJiYgYm9keS5nZW8ubGF0ICYmIGJvZHkuZ2VvLmxvbiA/IHsgbGF0OiBib2R5Lmdlby5sYXQsIGxvbjogYm9keS5nZW8ubG9uLCBhY2N1cmFjeTogYm9keS5nZW8uYWNjdXJhY3kgfSA6IHVuZGVmaW5lZCxcbiAgICAgICAgZ3BzX3Blcm1pc3Npb246IGJvZHkuZ2VvPy5wZXJtaXNzaW9uLFxuICAgICAgICBlbXVsYXRvcl9kZXRlY3RlZDogISFib2R5LmVtdWxhdG9yPy5pc0VtdWxhdG9yLFxuICAgICAgICBlbXVsYXRvcl9yZWFzb25zOiBib2R5LmVtdWxhdG9yPy5yZWFzb25zIHx8IFtdLFxuICAgICAgICBnZW9fbWlzbWF0Y2g6IChib2R5LmdlbyAmJiBib2R5Lmdlby5sYXQgJiYgYm9keS5nZW8ubG9uICYmIGluZm8gJiYgaW5mby5sb2MpID8gKE1hdGguYWJzKGJvZHkuZ2VvLmxhdCAtIGluZm8ubG9jWzBdKSA+IDAuNSB8fCBNYXRoLmFicyhib2R5Lmdlby5sb24gLSBpbmZvLmxvY1sxXSkgPiAwLjUpIDogZmFsc2UsXG4gICAgICAgIGxvY2F0aW9uX3Nwb29mZWQ6IChib2R5LmdlbyAmJiBib2R5Lmdlby5sYXQgJiYgYm9keS5nZW8ubG9uICYmIGluZm8gJiYgaW5mby5sb2MpID8gKE1hdGguYWJzKGJvZHkuZ2VvLmxhdCAtIGluZm8ubG9jWzBdKSA+IDEuNSB8fCBNYXRoLmFicyhib2R5Lmdlby5sb24gLSBpbmZvLmxvY1sxXSkgPiAxLjUpIDogZmFsc2VcbiAgICAgIH0sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH0pLnNlbGVjdCgnaWQnKS5zaW5nbGUoKVxuICAgIGlmIChpbnNlcnRFcnIpIHtcbiAgICAgIHJldHVybiB3aXRoQ09SUyhOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnZGJfaW5zZXJ0X2ZhaWxlZCcsIGRldGFpbHM6IGluc2VydEVyci5tZXNzYWdlIH0sIHsgc3RhdHVzOiA1MDAgfSkpXG4gICAgfVxuXG4gICAgLy8gR2V0IGNsaWVudCBzZXR0aW5nc1xuICAgIGNvbnN0IHsgZGF0YTogY2xpZW50QXBwIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxuICAgICAgLmZyb20oJ2NsaWVudF9hcHBzJylcbiAgICAgIC5zZWxlY3QoJ2F1dG9fYmxvY2ssIHJpc2tfdGhyZXNob2xkLCBzaGFyZV9yZXB1dGF0aW9uJylcbiAgICAgIC5lcSgnc2l0ZV9rZXknLCBzaXRlS2V5KVxuICAgICAgLm1heWJlU2luZ2xlKClcbiAgICBjb25zdCByaXNrX3RocmVzaG9sZCA9IGNsaWVudEFwcD8ucmlza190aHJlc2hvbGQgPz8gODBcbiAgICBjb25zdCBhdXRvX2Jsb2NrID0gY2xpZW50QXBwPy5hdXRvX2Jsb2NrID8/IGZhbHNlXG4gICAgY29uc3Qgc2hhcmVfcmVwdXRhdGlvbiA9IGNsaWVudEFwcD8uc2hhcmVfcmVwdXRhdGlvbiA/PyBmYWxzZVxuXG4gICAgLy8gRGVjaWRlIGFjdGlvblxuICAgIGlmIChhdXRvX2Jsb2NrICYmIGZpbmFsU2NvcmUgPj0gcmlza190aHJlc2hvbGQpIHtcbiAgICAgIGFjdGlvbiA9ICdhdXRvX2Jsb2NrJ1xuICAgIH1cblxuICAgIC8vIFNoYXJlIHJlcHV0YXRpb25cbiAgICBpZiAoc2hhcmVfcmVwdXRhdGlvbiAmJiBmaW5hbFZlcmRpY3QgPT09ICdoaWdoJykge1xuICAgICAgYXdhaXQgc3VwYWJhc2VTZXJ2ZXIuZnJvbSgnZ2xvYmFsX3JlcHV0YXRpb24nKS51cHNlcnQoe1xuICAgICAgICBmaW5nZXJwcmludF9oYXNoLFxuICAgICAgICBpcCxcbiAgICAgICAgYWJ1c2VfY291bnQ6IDEsXG4gICAgICAgIGxhc3Rfc2VlbjogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9LCB7IG9uQ29uZmxpY3Q6ICdmaW5nZXJwcmludF9oYXNoLGlwJyB9KVxuICAgIH1cblxuICAgIHJldHVybiB3aXRoQ09SUyhOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICByaXNrX3Njb3JlOiBmaW5hbFNjb3JlLFxuICAgICAgdmVyZGljdDogZmluYWxWZXJkaWN0LFxuICAgICAgYWN0aW9uLFxuICAgICAgdmlzaXRvcl9ldmVudF9pZDogaW5zZXJ0ZWQuaWQsXG4gICAgICBzaWduYWxzOiB7XG4gICAgICAgIHZwbkRldGVjdGVkLFxuICAgICAgICB0aW1lem9uZU1pc21hdGNoLFxuICAgICAgICB2ZWxvY2l0eUNvdW50OiB2XG4gICAgICB9XG4gICAgfSkpXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgcmV0dXJuIHdpdGhDT1JTKE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdzZXJ2ZXJfZXJyb3InLCBkZXRhaWxzOiBlcnIubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pKVxuICB9XG59XG4iXSwibmFtZXMiOlsiY29uc29sZSIsImxvZyIsIk5leHRSZXNwb25zZSIsInBhdGgiLCJoZWFkZXJzIiwieiIsInRva2VuQnVja2V0IiwiZ2V0SVBJbmZvIiwiY2hlY2tBYnVzZUlQIiwidmVsb2NpdHlDb3VudCIsImNvbXB1dGVSaXNrIiwic3VwYWJhc2VTZXJ2ZXIiLCJ2NSIsInV1aWR2NSIsImlwSW5MaXN0IiwiaXAiLCJmaWxlIiwicmVhZEZpbGUiLCJkYXRhIiwic2V0IiwiU2V0Iiwic3BsaXQiLCJtYXAiLCJsIiwidHJpbSIsImZpbHRlciIsIkJvb2xlYW4iLCJoYXMiLCJlbWFpbElzRGlzcG9zYWJsZSIsImVtYWlsIiwiZG9tYWluIiwidG9Mb3dlckNhc2UiLCJsaW5lcyIsInNsaWNlIiwiSlNPTiIsInN0cmluZ2lmeSIsImxlbmd0aCIsImNsZWFuIiwicyIsInJlcGxhY2UiLCJDb2xsZWN0VmlzaXRvclNjaGVtYSIsIm9iamVjdCIsInNpdGVLZXkiLCJzdHJpbmciLCJmaW5nZXJwcmludF9oYXNoIiwidXNlckFnZW50IiwibGFuZ3VhZ2UiLCJ0aW1lem9uZSIsInJlc29sdXRpb24iLCJyZWZlcnJlciIsIm9wdGlvbmFsIiwiaW5jb2duaXRvIiwiYm9vbGVhbiIsIndlYmRyaXZlciIsInRodW1ibWFya19zaWduYWxzIiwiYW55IiwidGh1bWJtYXJrX2RldGFpbHMiLCJwaG9uZSIsIm5hbWUiLCJib3RkX3Jlc3VsdCIsIndpdGhDT1JTIiwicmVzIiwiT1BUSU9OUyIsInJlcXVlc3QiLCJSZXNwb25zZSIsInN0YXR1cyIsIm5vcm1hbGl6ZUJvdGRSZXN1bHQiLCJib3RkIiwidW5kZWZpbmVkIiwiYm90IiwicmVzdWx0IiwiUE9TVCIsInJlcSIsImJvZHkiLCJqc29uIiwicGFyc2UiLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwiZXJyb3IiLCJkZXRhaWxzIiwiZXJyb3JzIiwiZ2V0Iiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImRpc3Bvc2FibGVGaWxlUGF0aCIsInJlc29sdmUiLCJwcm9jZXNzIiwiY3dkIiwiZGVidWdUZW1wRW1haWxEb21haW4iLCJkZWJ1Z1RlbXBFbWFpbFJlc3VsdCIsImZzIiwiaXNUb3IiLCJpc1Byb3h5IiwiUHJvbWlzZSIsImFsbCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJpc1RlbXBFbWFpbCIsInJsIiwiYWxsb3dlZCIsImluZm8iLCJ0aW1lem9uZU1pc21hdGNoIiwiYWJ1c2UiLCJ2aXNpdG9yX2lkIiwidXVpZFZhbGlkYXRlIiwidiIsInRlc3QiLCJOQU1FU1BBQ0UiLCJ2cG5EZXRlY3RlZCIsInByaXZhY3kiLCJ2cG4iLCJob3N0aW5nIiwic2NvcmUiLCJ2ZXJkaWN0IiwiYWJ1c2VMaXN0ZWQiLCJibG9ja2xpc3RlZCIsImFjdGlvbiIsIm1hbnVhbEJsb2NrIiwiYmxvY2tJZCIsImJsb2NrUmVhc29uIiwiYmxvY2tzIiwiZnJvbSIsInNlbGVjdCIsImVxIiwib3IiLCJpcyIsImxpbWl0IiwiaWQiLCJyZWFzb24iLCJmaW5hbFNjb3JlIiwiZmluYWxWZXJkaWN0Iiwic2l0ZVJvdyIsInNpdGVFcnJvciIsIm1heWJlU2luZ2xlIiwidXBzZXJ0Iiwic2l0ZV9pZCIsInRvU3RyaW5nIiwiZmluZ2VycHJpbnQiLCJ0aHVtYm1hcmsiLCJoYXNoIiwidXNlcl9hZ2VudCIsInNjcmVlbl9yZXNvbHV0aW9uIiwicGxhdGZvcm0iLCJpcF9hZGRyZXNzIiwiY291bnRyeSIsImNpdHkiLCJyZWdpb24iLCJpc3AiLCJvcmciLCJpc19ib3QiLCJyaXNrX3Njb3JlIiwiaXNfdG9yIiwiaXNfcHJveHkiLCJpc190ZW1wX2VtYWlsIiwib25Db25mbGljdCIsImluc2VydGVkIiwiaW5zZXJ0RXJyIiwiaW5zZXJ0IiwiZXZlbnRfdHlwZSIsImV2ZW50X25hbWUiLCJ1cmwiLCJwcm9wZXJ0aWVzIiwiaXBfY2l0eSIsImlwX2NvdW50cnkiLCJpcF9vcmciLCJicm93c2VyIiwib3MiLCJzaWduYWxzIiwiQXJyYXkiLCJpc0FycmF5IiwiZ3BzX2xvY2F0aW9uIiwiZ2VvIiwibGF0IiwibG9uIiwiYWNjdXJhY3kiLCJncHNfcGVybWlzc2lvbiIsInBlcm1pc3Npb24iLCJlbXVsYXRvcl9kZXRlY3RlZCIsImVtdWxhdG9yIiwiaXNFbXVsYXRvciIsImVtdWxhdG9yX3JlYXNvbnMiLCJyZWFzb25zIiwiZ2VvX21pc21hdGNoIiwibG9jIiwiTWF0aCIsImFicyIsImxvY2F0aW9uX3Nwb29mZWQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzaW5nbGUiLCJtZXNzYWdlIiwiY2xpZW50QXBwIiwicmlza190aHJlc2hvbGQiLCJhdXRvX2Jsb2NrIiwic2hhcmVfcmVwdXRhdGlvbiIsImFidXNlX2NvdW50IiwibGFzdF9zZWVuIiwidmlzaXRvcl9ldmVudF9pZCIsImVyciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/collect-visitor/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/abuse.ts":
/*!**********************!*\
  !*** ./lib/abuse.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkAbuseIP: () => (/* binding */ checkAbuseIP)\n/* harmony export */ });\n/* harmony import */ var _redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./redis */ \"(rsc)/./lib/redis.ts\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"(rsc)/../../node_modules/axios/lib/axios.js\");\n\n\nconst ABUSEIPDB_KEY = process.env.ABUSEIPDB_KEY;\nasync function checkAbuseIP(ip) {\n    if (!ABUSEIPDB_KEY) {\n        return {\n            blocklisted: false\n        };\n    }\n    const cacheKey = `abuse:${ip}`;\n    const cached = await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.get)(cacheKey);\n    if (cached) return JSON.parse(cached);\n    const { data } = await axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(`https://api.abuseipdb.com/api/v2/check`, {\n        params: {\n            ipAddress: ip,\n            maxAgeInDays: 30\n        },\n        headers: {\n            Key: ABUSEIPDB_KEY,\n            Accept: \"application/json\"\n        }\n    });\n    const blocklisted = data.data.abuseConfidenceScore >= 50;\n    const result = {\n        blocklisted\n    };\n    await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.set)(cacheKey, JSON.stringify(result), 86400);\n    return result;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYWJ1c2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWtDO0FBQ1Q7QUFFekIsTUFBTUcsZ0JBQWdCQyxRQUFRQyxHQUFHLENBQUNGLGFBQWE7QUFFeEMsZUFBZUcsYUFBYUMsRUFBVTtJQUMzQyxJQUFJLENBQUNKLGVBQWU7UUFDbEIsT0FBTztZQUFFSyxhQUFhO1FBQU07SUFDOUI7SUFDQSxNQUFNQyxXQUFXLENBQUMsTUFBTSxFQUFFRixHQUFHLENBQUM7SUFDOUIsTUFBTUcsU0FBUyxNQUFNViwyQ0FBR0EsQ0FBQ1M7SUFDekIsSUFBSUMsUUFBUSxPQUFPQyxLQUFLQyxLQUFLLENBQUNGO0lBQzlCLE1BQU0sRUFBRUcsSUFBSSxFQUFFLEdBQUcsTUFBTVgsNkNBQUtBLENBQUNGLEdBQUcsQ0FBQyxDQUFDLHNDQUFzQyxDQUFDLEVBQUU7UUFDekVjLFFBQVE7WUFBRUMsV0FBV1I7WUFBSVMsY0FBYztRQUFHO1FBQzFDQyxTQUFTO1lBQUVDLEtBQUtmO1lBQWVnQixRQUFRO1FBQW1CO0lBQzVEO0lBQ0EsTUFBTVgsY0FBY0ssS0FBS0EsSUFBSSxDQUFDTyxvQkFBb0IsSUFBSTtJQUN0RCxNQUFNQyxTQUFTO1FBQUViO0lBQVk7SUFDN0IsTUFBTVAsMkNBQUdBLENBQUNRLFVBQVVFLEtBQUtXLFNBQVMsQ0FBQ0QsU0FBUztJQUM1QyxPQUFPQTtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvYWJ1c2UudHM/ZDg5OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXQsIHNldCB9IGZyb20gJy4vcmVkaXMnXG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnXG5cbmNvbnN0IEFCVVNFSVBEQl9LRVkgPSBwcm9jZXNzLmVudi5BQlVTRUlQREJfS0VZXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0FidXNlSVAoaXA6IHN0cmluZykge1xuICBpZiAoIUFCVVNFSVBEQl9LRVkpIHtcbiAgICByZXR1cm4geyBibG9ja2xpc3RlZDogZmFsc2UgfVxuICB9XG4gIGNvbnN0IGNhY2hlS2V5ID0gYGFidXNlOiR7aXB9YFxuICBjb25zdCBjYWNoZWQgPSBhd2FpdCBnZXQoY2FjaGVLZXkpXG4gIGlmIChjYWNoZWQpIHJldHVybiBKU09OLnBhcnNlKGNhY2hlZClcbiAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vYXBpLmFidXNlaXBkYi5jb20vYXBpL3YyL2NoZWNrYCwge1xuICAgIHBhcmFtczogeyBpcEFkZHJlc3M6IGlwLCBtYXhBZ2VJbkRheXM6IDMwIH0sXG4gICAgaGVhZGVyczogeyBLZXk6IEFCVVNFSVBEQl9LRVksIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gIH0pXG4gIGNvbnN0IGJsb2NrbGlzdGVkID0gZGF0YS5kYXRhLmFidXNlQ29uZmlkZW5jZVNjb3JlID49IDUwXG4gIGNvbnN0IHJlc3VsdCA9IHsgYmxvY2tsaXN0ZWQgfVxuICBhd2FpdCBzZXQoY2FjaGVLZXksIEpTT04uc3RyaW5naWZ5KHJlc3VsdCksIDg2NDAwKVxuICByZXR1cm4gcmVzdWx0XG59XG4iXSwibmFtZXMiOlsiZ2V0Iiwic2V0IiwiYXhpb3MiLCJBQlVTRUlQREJfS0VZIiwicHJvY2VzcyIsImVudiIsImNoZWNrQWJ1c2VJUCIsImlwIiwiYmxvY2tsaXN0ZWQiLCJjYWNoZUtleSIsImNhY2hlZCIsIkpTT04iLCJwYXJzZSIsImRhdGEiLCJwYXJhbXMiLCJpcEFkZHJlc3MiLCJtYXhBZ2VJbkRheXMiLCJoZWFkZXJzIiwiS2V5IiwiQWNjZXB0IiwiYWJ1c2VDb25maWRlbmNlU2NvcmUiLCJyZXN1bHQiLCJzdHJpbmdpZnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/abuse.ts\n");

/***/ }),

/***/ "(rsc)/./lib/ipinfo.ts":
/*!***********************!*\
  !*** ./lib/ipinfo.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getIPInfo: () => (/* binding */ getIPInfo)\n/* harmony export */ });\n/* harmony import */ var _redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./redis */ \"(rsc)/./lib/redis.ts\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"(rsc)/../../node_modules/axios/lib/axios.js\");\n\n\nconst IPINFO_TOKEN = process.env.IPINFO_TOKEN;\nif (!IPINFO_TOKEN) throw new Error(\"IPINFO_TOKEN env var not set\");\nasync function getIPInfo(ip) {\n    const cacheKey = `ipinfo:${ip}`;\n    const cached = await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.get)(cacheKey);\n    if (cached) return JSON.parse(cached);\n    const url = `https://ipinfo.io/${ip}/json?token=${IPINFO_TOKEN}`;\n    const { data } = await axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(url);\n    const result = {\n        org: data.org,\n        city: data.city,\n        region: data.region,\n        country: data.country,\n        timezone: data.timezone,\n        privacy: data.privacy ?? {}\n    };\n    if (data.asn) result.asn = data.asn;\n    await (0,_redis__WEBPACK_IMPORTED_MODULE_0__.set)(cacheKey, JSON.stringify(result), 86400);\n    return result;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvaXBpbmZvLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFrQztBQUNUO0FBRXpCLE1BQU1HLGVBQWVDLFFBQVFDLEdBQUcsQ0FBQ0YsWUFBWTtBQUM3QyxJQUFJLENBQUNBLGNBQWMsTUFBTSxJQUFJRyxNQUFNO0FBRTVCLGVBQWVDLFVBQVVDLEVBQVU7SUFDeEMsTUFBTUMsV0FBVyxDQUFDLE9BQU8sRUFBRUQsR0FBRyxDQUFDO0lBQy9CLE1BQU1FLFNBQVMsTUFBTVYsMkNBQUdBLENBQUNTO0lBQ3pCLElBQUlDLFFBQVEsT0FBT0MsS0FBS0MsS0FBSyxDQUFDRjtJQUU5QixNQUFNRyxNQUFNLENBQUMsa0JBQWtCLEVBQUVMLEdBQUcsWUFBWSxFQUFFTCxhQUFhLENBQUM7SUFDaEUsTUFBTSxFQUFFVyxJQUFJLEVBQUUsR0FBRyxNQUFNWiw2Q0FBS0EsQ0FBQ0YsR0FBRyxDQUFDYTtJQUNqQyxNQUFNRSxTQUFjO1FBQ2xCQyxLQUFLRixLQUFLRSxHQUFHO1FBQ2JDLE1BQU1ILEtBQUtHLElBQUk7UUFDZkMsUUFBUUosS0FBS0ksTUFBTTtRQUNuQkMsU0FBU0wsS0FBS0ssT0FBTztRQUNyQkMsVUFBVU4sS0FBS00sUUFBUTtRQUN2QkMsU0FBU1AsS0FBS08sT0FBTyxJQUFJLENBQUM7SUFDNUI7SUFDQSxJQUFJUCxLQUFLUSxHQUFHLEVBQUVQLE9BQU9PLEdBQUcsR0FBR1IsS0FBS1EsR0FBRztJQUNuQyxNQUFNckIsMkNBQUdBLENBQUNRLFVBQVVFLEtBQUtZLFNBQVMsQ0FBQ1IsU0FBUztJQUM1QyxPQUFPQTtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvaXBpbmZvLnRzP2FjZDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0LCBzZXQgfSBmcm9tICcuL3JlZGlzJ1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJ1xuXG5jb25zdCBJUElORk9fVE9LRU4gPSBwcm9jZXNzLmVudi5JUElORk9fVE9LRU5cbmlmICghSVBJTkZPX1RPS0VOKSB0aHJvdyBuZXcgRXJyb3IoJ0lQSU5GT19UT0tFTiBlbnYgdmFyIG5vdCBzZXQnKVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SVBJbmZvKGlwOiBzdHJpbmcpIHtcbiAgY29uc3QgY2FjaGVLZXkgPSBgaXBpbmZvOiR7aXB9YFxuICBjb25zdCBjYWNoZWQgPSBhd2FpdCBnZXQoY2FjaGVLZXkpXG4gIGlmIChjYWNoZWQpIHJldHVybiBKU09OLnBhcnNlKGNhY2hlZClcblxuICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9pcGluZm8uaW8vJHtpcH0vanNvbj90b2tlbj0ke0lQSU5GT19UT0tFTn1gXG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MuZ2V0KHVybClcbiAgY29uc3QgcmVzdWx0OiBhbnkgPSB7XG4gICAgb3JnOiBkYXRhLm9yZyxcbiAgICBjaXR5OiBkYXRhLmNpdHksXG4gICAgcmVnaW9uOiBkYXRhLnJlZ2lvbixcbiAgICBjb3VudHJ5OiBkYXRhLmNvdW50cnksXG4gICAgdGltZXpvbmU6IGRhdGEudGltZXpvbmUsXG4gICAgcHJpdmFjeTogZGF0YS5wcml2YWN5ID8/IHt9LFxuICB9XG4gIGlmIChkYXRhLmFzbikgcmVzdWx0LmFzbiA9IGRhdGEuYXNuXG4gIGF3YWl0IHNldChjYWNoZUtleSwgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSwgODY0MDApXG4gIHJldHVybiByZXN1bHRcbn1cbiJdLCJuYW1lcyI6WyJnZXQiLCJzZXQiLCJheGlvcyIsIklQSU5GT19UT0tFTiIsInByb2Nlc3MiLCJlbnYiLCJFcnJvciIsImdldElQSW5mbyIsImlwIiwiY2FjaGVLZXkiLCJjYWNoZWQiLCJKU09OIiwicGFyc2UiLCJ1cmwiLCJkYXRhIiwicmVzdWx0Iiwib3JnIiwiY2l0eSIsInJlZ2lvbiIsImNvdW50cnkiLCJ0aW1lem9uZSIsInByaXZhY3kiLCJhc24iLCJzdHJpbmdpZnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/ipinfo.ts\n");

/***/ }),

/***/ "(rsc)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   get: () => (/* binding */ get),\n/* harmony export */   redis: () => (/* binding */ redis),\n/* harmony export */   set: () => (/* binding */ set),\n/* harmony export */   tokenBucket: () => (/* binding */ tokenBucket)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"(rsc)/../../node_modules/ioredis/built/index.js\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n\nconst redisUrl = process.env.REDIS_URL;\nif (!redisUrl) throw new Error(\"REDIS_URL env var not set\");\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(redisUrl);\nasync function get(key) {\n    return redis.get(key);\n}\nasync function set(key, value, ttlSeconds) {\n    if (ttlSeconds) {\n        await redis.set(key, value, \"EX\", ttlSeconds);\n    } else {\n        await redis.set(key, value);\n    }\n}\n/**\n * Token bucket rate limiting using Redis.\n * @param key Redis key\n * @param capacity Max tokens in bucket (default 60)\n * @param refillPerSec Tokens added per second (default 1)\n * @returns { allowed: boolean, remaining: number }\n */ async function tokenBucket(key, capacity = 60, refillPerSec = 1) {\n    const now = Math.floor(Date.now() / 1000);\n    const bucketKey = `tb:${key}`;\n    const lua = `\n    local bucket = redis.call('HMGET', KEYS[1], 'tokens', 'last')\n    local tokens = tonumber(bucket[1]) or ARGV[2]\n    local last = tonumber(bucket[2]) or ARGV[3]\n    local now = tonumber(ARGV[1])\n    local refill = (now - last) * ARGV[4]\n    tokens = math.min(tokens + refill, ARGV[2])\n    local allowed = 0\n    if tokens >= 1 then\n      tokens = tokens - 1\n      allowed = 1\n    end\n    redis.call('HMSET', KEYS[1], 'tokens', tokens, 'last', now)\n    redis.call('EXPIRE', KEYS[1], 3600)\n    return {allowed, tokens}\n  `;\n    const [allowed, remaining] = await redis.eval(lua, 1, bucketKey, now, capacity, now, refillPerSec);\n    return {\n        allowed: !!allowed,\n        remaining: Number(remaining)\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTJCO0FBRTNCLE1BQU1DLFdBQVdDLFFBQVFDLEdBQUcsQ0FBQ0MsU0FBUztBQUN0QyxJQUFJLENBQUNILFVBQVUsTUFBTSxJQUFJSSxNQUFNO0FBQ3hCLE1BQU1DLFFBQVEsSUFBSU4sZ0RBQUtBLENBQUNDLFVBQVM7QUFFakMsZUFBZU0sSUFBSUMsR0FBVztJQUNuQyxPQUFPRixNQUFNQyxHQUFHLENBQUNDO0FBQ25CO0FBRU8sZUFBZUMsSUFBSUQsR0FBVyxFQUFFRSxLQUFhLEVBQUVDLFVBQW1CO0lBQ3ZFLElBQUlBLFlBQVk7UUFDZCxNQUFNTCxNQUFNRyxHQUFHLENBQUNELEtBQUtFLE9BQU8sTUFBTUM7SUFDcEMsT0FBTztRQUNMLE1BQU1MLE1BQU1HLEdBQUcsQ0FBQ0QsS0FBS0U7SUFDdkI7QUFDRjtBQUVBOzs7Ozs7Q0FNQyxHQUNNLGVBQWVFLFlBQVlKLEdBQVcsRUFBRUssV0FBVyxFQUFFLEVBQUVDLGVBQWUsQ0FBQztJQUM1RSxNQUFNQyxNQUFNQyxLQUFLQyxLQUFLLENBQUNDLEtBQUtILEdBQUcsS0FBSztJQUNwQyxNQUFNSSxZQUFZLENBQUMsR0FBRyxFQUFFWCxJQUFJLENBQUM7SUFDN0IsTUFBTVksTUFBTSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7RUFlYixDQUFDO0lBQ0QsTUFBTSxDQUFDQyxTQUFTQyxVQUFVLEdBQUcsTUFBTWhCLE1BQU1pQixJQUFJLENBQUNILEtBQUssR0FBR0QsV0FBV0osS0FBS0YsVUFBVUUsS0FBS0Q7SUFDckYsT0FBTztRQUFFTyxTQUFTLENBQUMsQ0FBQ0E7UUFBU0MsV0FBV0UsT0FBT0Y7SUFBVztBQUM1RCIsInNvdXJjZXMiOlsid2VicGFjazovL0B2aXNpdG9yaXEvd2ViLy4vbGliL3JlZGlzLnRzPzUxZTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlZGlzIGZyb20gJ2lvcmVkaXMnXG5cbmNvbnN0IHJlZGlzVXJsID0gcHJvY2Vzcy5lbnYuUkVESVNfVVJMXG5pZiAoIXJlZGlzVXJsKSB0aHJvdyBuZXcgRXJyb3IoJ1JFRElTX1VSTCBlbnYgdmFyIG5vdCBzZXQnKVxuZXhwb3J0IGNvbnN0IHJlZGlzID0gbmV3IFJlZGlzKHJlZGlzVXJsKVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0KGtleTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gIHJldHVybiByZWRpcy5nZXQoa2V5KVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCB0dGxTZWNvbmRzPzogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmICh0dGxTZWNvbmRzKSB7XG4gICAgYXdhaXQgcmVkaXMuc2V0KGtleSwgdmFsdWUsICdFWCcsIHR0bFNlY29uZHMpXG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcmVkaXMuc2V0KGtleSwgdmFsdWUpXG4gIH1cbn1cblxuLyoqXG4gKiBUb2tlbiBidWNrZXQgcmF0ZSBsaW1pdGluZyB1c2luZyBSZWRpcy5cbiAqIEBwYXJhbSBrZXkgUmVkaXMga2V5XG4gKiBAcGFyYW0gY2FwYWNpdHkgTWF4IHRva2VucyBpbiBidWNrZXQgKGRlZmF1bHQgNjApXG4gKiBAcGFyYW0gcmVmaWxsUGVyU2VjIFRva2VucyBhZGRlZCBwZXIgc2Vjb25kIChkZWZhdWx0IDEpXG4gKiBAcmV0dXJucyB7IGFsbG93ZWQ6IGJvb2xlYW4sIHJlbWFpbmluZzogbnVtYmVyIH1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRva2VuQnVja2V0KGtleTogc3RyaW5nLCBjYXBhY2l0eSA9IDYwLCByZWZpbGxQZXJTZWMgPSAxKTogUHJvbWlzZTx7IGFsbG93ZWQ6IGJvb2xlYW4sIHJlbWFpbmluZzogbnVtYmVyIH0+IHtcbiAgY29uc3Qgbm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMClcbiAgY29uc3QgYnVja2V0S2V5ID0gYHRiOiR7a2V5fWBcbiAgY29uc3QgbHVhID0gYFxuICAgIGxvY2FsIGJ1Y2tldCA9IHJlZGlzLmNhbGwoJ0hNR0VUJywgS0VZU1sxXSwgJ3Rva2VucycsICdsYXN0JylcbiAgICBsb2NhbCB0b2tlbnMgPSB0b251bWJlcihidWNrZXRbMV0pIG9yIEFSR1ZbMl1cbiAgICBsb2NhbCBsYXN0ID0gdG9udW1iZXIoYnVja2V0WzJdKSBvciBBUkdWWzNdXG4gICAgbG9jYWwgbm93ID0gdG9udW1iZXIoQVJHVlsxXSlcbiAgICBsb2NhbCByZWZpbGwgPSAobm93IC0gbGFzdCkgKiBBUkdWWzRdXG4gICAgdG9rZW5zID0gbWF0aC5taW4odG9rZW5zICsgcmVmaWxsLCBBUkdWWzJdKVxuICAgIGxvY2FsIGFsbG93ZWQgPSAwXG4gICAgaWYgdG9rZW5zID49IDEgdGhlblxuICAgICAgdG9rZW5zID0gdG9rZW5zIC0gMVxuICAgICAgYWxsb3dlZCA9IDFcbiAgICBlbmRcbiAgICByZWRpcy5jYWxsKCdITVNFVCcsIEtFWVNbMV0sICd0b2tlbnMnLCB0b2tlbnMsICdsYXN0Jywgbm93KVxuICAgIHJlZGlzLmNhbGwoJ0VYUElSRScsIEtFWVNbMV0sIDM2MDApXG4gICAgcmV0dXJuIHthbGxvd2VkLCB0b2tlbnN9XG4gIGBcbiAgY29uc3QgW2FsbG93ZWQsIHJlbWFpbmluZ10gPSBhd2FpdCByZWRpcy5ldmFsKGx1YSwgMSwgYnVja2V0S2V5LCBub3csIGNhcGFjaXR5LCBub3csIHJlZmlsbFBlclNlYylcbiAgcmV0dXJuIHsgYWxsb3dlZDogISFhbGxvd2VkLCByZW1haW5pbmc6IE51bWJlcihyZW1haW5pbmcpIH1cbn1cbiJdLCJuYW1lcyI6WyJSZWRpcyIsInJlZGlzVXJsIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsIkVycm9yIiwicmVkaXMiLCJnZXQiLCJrZXkiLCJzZXQiLCJ2YWx1ZSIsInR0bFNlY29uZHMiLCJ0b2tlbkJ1Y2tldCIsImNhcGFjaXR5IiwicmVmaWxsUGVyU2VjIiwibm93IiwiTWF0aCIsImZsb29yIiwiRGF0ZSIsImJ1Y2tldEtleSIsImx1YSIsImFsbG93ZWQiLCJyZW1haW5pbmciLCJldmFsIiwiTnVtYmVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/redis.ts\n");

/***/ }),

/***/ "(rsc)/./lib/risk.ts":
/*!*********************!*\
  !*** ./lib/risk.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   computeRisk: () => (/* binding */ computeRisk)\n/* harmony export */ });\nfunction computeRisk({ incognito, vpn, timezoneMismatch, webdriver, abuseListed, velocityCount }) {\n    let score = 0;\n    if (incognito) score += 20;\n    if (vpn) score += 20;\n    if (timezoneMismatch) score += 15;\n    if (webdriver) score += 10;\n    if (abuseListed) score += 10;\n    if ((velocityCount ?? 0) > 3) score += 5;\n    score = Math.max(0, Math.min(100, score));\n    const verdict = score <= 30 ? \"low\" : score <= 70 ? \"medium\" : \"high\";\n    return {\n        score,\n        verdict\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmlzay50cyIsIm1hcHBpbmdzIjoiOzs7O0FBU08sU0FBU0EsWUFBWSxFQUFFQyxTQUFTLEVBQUVDLEdBQUcsRUFBRUMsZ0JBQWdCLEVBQUVDLFNBQVMsRUFBRUMsV0FBVyxFQUFFQyxhQUFhLEVBQWE7SUFDaEgsSUFBSUMsUUFBUTtJQUNaLElBQUlOLFdBQVdNLFNBQVM7SUFDeEIsSUFBSUwsS0FBS0ssU0FBUztJQUNsQixJQUFJSixrQkFBa0JJLFNBQVM7SUFDL0IsSUFBSUgsV0FBV0csU0FBUztJQUN4QixJQUFJRixhQUFhRSxTQUFTO0lBQzFCLElBQUksQ0FBQ0QsaUJBQWlCLEtBQUssR0FBR0MsU0FBUztJQUN2Q0EsUUFBUUMsS0FBS0MsR0FBRyxDQUFDLEdBQUdELEtBQUtFLEdBQUcsQ0FBQyxLQUFLSDtJQUNsQyxNQUFNSSxVQUFVSixTQUFTLEtBQUssUUFBUUEsU0FBUyxLQUFLLFdBQVc7SUFDL0QsT0FBTztRQUFFQTtRQUFPSTtJQUFRO0FBQzFCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvcmlzay50cz82ZDNlIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgUmlza0lucHV0ID0ge1xuICBpbmNvZ25pdG8/OiBib29sZWFuXG4gIHZwbj86IGJvb2xlYW5cbiAgdGltZXpvbmVNaXNtYXRjaD86IGJvb2xlYW5cbiAgd2ViZHJpdmVyPzogYm9vbGVhblxuICBhYnVzZUxpc3RlZD86IGJvb2xlYW5cbiAgdmVsb2NpdHlDb3VudD86IG51bWJlclxufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tcHV0ZVJpc2soeyBpbmNvZ25pdG8sIHZwbiwgdGltZXpvbmVNaXNtYXRjaCwgd2ViZHJpdmVyLCBhYnVzZUxpc3RlZCwgdmVsb2NpdHlDb3VudCB9OiBSaXNrSW5wdXQpIHtcbiAgbGV0IHNjb3JlID0gMFxuICBpZiAoaW5jb2duaXRvKSBzY29yZSArPSAyMFxuICBpZiAodnBuKSBzY29yZSArPSAyMFxuICBpZiAodGltZXpvbmVNaXNtYXRjaCkgc2NvcmUgKz0gMTVcbiAgaWYgKHdlYmRyaXZlcikgc2NvcmUgKz0gMTBcbiAgaWYgKGFidXNlTGlzdGVkKSBzY29yZSArPSAxMFxuICBpZiAoKHZlbG9jaXR5Q291bnQgPz8gMCkgPiAzKSBzY29yZSArPSA1XG4gIHNjb3JlID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBzY29yZSkpXG4gIGNvbnN0IHZlcmRpY3QgPSBzY29yZSA8PSAzMCA/ICdsb3cnIDogc2NvcmUgPD0gNzAgPyAnbWVkaXVtJyA6ICdoaWdoJ1xuICByZXR1cm4geyBzY29yZSwgdmVyZGljdCB9XG59XG4iXSwibmFtZXMiOlsiY29tcHV0ZVJpc2siLCJpbmNvZ25pdG8iLCJ2cG4iLCJ0aW1lem9uZU1pc21hdGNoIiwid2ViZHJpdmVyIiwiYWJ1c2VMaXN0ZWQiLCJ2ZWxvY2l0eUNvdW50Iiwic2NvcmUiLCJNYXRoIiwibWF4IiwibWluIiwidmVyZGljdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/risk.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabaseServer.ts":
/*!*******************************!*\
  !*** ./lib/supabaseServer.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseServer: () => (/* binding */ supabaseServer)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst SUPABASE_URL = process.env.SUPABASE_URL;\nconst SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE_KEY) {\n    throw new Error(\"SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY not set\");\n}\nconst supabaseServer = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2VTZXJ2ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0Q7QUFFcEQsTUFBTUMsZUFBZUMsUUFBUUMsR0FBRyxDQUFDRixZQUFZO0FBQzdDLE1BQU1HLDRCQUE0QkYsUUFBUUMsR0FBRyxDQUFDQyx5QkFBeUI7QUFFdkUsSUFBSSxDQUFDSCxnQkFBZ0IsQ0FBQ0csMkJBQTJCO0lBQy9DLE1BQU0sSUFBSUMsTUFBTTtBQUNsQjtBQUVPLE1BQU1DLGlCQUFpQk4sbUVBQVlBLENBQ3hDQyxjQUNBRywyQkFDQTtJQUFFRyxNQUFNO1FBQUVDLGtCQUFrQjtRQUFPQyxnQkFBZ0I7SUFBTTtBQUFFLEdBQzVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQHZpc2l0b3JpcS93ZWIvLi9saWIvc3VwYWJhc2VTZXJ2ZXIudHM/Yzc4YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbmNvbnN0IFNVUEFCQVNFX1VSTCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTFxuY29uc3QgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVlcblxuaWYgKCFTVVBBQkFTRV9VUkwgfHwgIVNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdTVVBBQkFTRV9VUkwgb3IgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBub3Qgc2V0Jylcbn1cblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlU2VydmVyID0gY3JlYXRlQ2xpZW50KFxuICBTVVBBQkFTRV9VUkwsXG4gIFNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVksXG4gIHsgYXV0aDogeyBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSwgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0gfVxuKVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsIlNVUEFCQVNFX1VSTCIsInByb2Nlc3MiLCJlbnYiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJzdXBhYmFzZVNlcnZlciIsImF1dGgiLCJhdXRvUmVmcmVzaFRva2VuIiwicGVyc2lzdFNlc3Npb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabaseServer.ts\n");

/***/ }),

/***/ "(rsc)/./lib/velocity.ts":
/*!*************************!*\
  !*** ./lib/velocity.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   velocityCount: () => (/* binding */ velocityCount)\n/* harmony export */ });\n/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dayjs */ \"(rsc)/../../node_modules/dayjs/dayjs.min.js\");\n/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_0__);\n\nasync function velocityCount(supabase, siteKey, visitorId, windowMinutes = 60) {\n    const since = dayjs__WEBPACK_IMPORTED_MODULE_0___default()().subtract(windowMinutes, \"minute\").toISOString();\n    // Lookup site_id from sites table using api_key\n    const { data: siteRow, error: siteError } = await supabase.from(\"sites\").select(\"id\").eq(\"api_key\", siteKey).maybeSingle();\n    if (!siteRow || siteError) return 0;\n    const { count } = await supabase.from(\"events\").select(\"*\", {\n        count: \"exact\",\n        head: true\n    }).eq(\"site_id\", siteRow.id).eq(\"visitor_id\", visitorId).gt(\"timestamp\", since);\n    return count || 0;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdmVsb2NpdHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ3lCO0FBRWxCLGVBQWVDLGNBQ3BCQyxRQUF3QixFQUN4QkMsT0FBZSxFQUNmQyxTQUFpQixFQUNqQkMsZ0JBQWdCLEVBQUU7SUFFbEIsTUFBTUMsUUFBUU4sNENBQUtBLEdBQUdPLFFBQVEsQ0FBQ0YsZUFBZSxVQUFVRyxXQUFXO0lBQ25FLGdEQUFnRDtJQUNoRCxNQUFNLEVBQUVDLE1BQU1DLE9BQU8sRUFBRUMsT0FBT0MsU0FBUyxFQUFFLEdBQUcsTUFBTVYsU0FDL0NXLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsTUFDUEMsRUFBRSxDQUFDLFdBQVdaLFNBQ2RhLFdBQVc7SUFDZCxJQUFJLENBQUNOLFdBQVdFLFdBQVcsT0FBTztJQUNsQyxNQUFNLEVBQUVLLEtBQUssRUFBRSxHQUFHLE1BQU1mLFNBQ3JCVyxJQUFJLENBQUMsVUFDTEMsTUFBTSxDQUFDLEtBQUs7UUFBRUcsT0FBTztRQUFTQyxNQUFNO0lBQUssR0FDekNILEVBQUUsQ0FBQyxXQUFXTCxRQUFRUyxFQUFFLEVBQ3hCSixFQUFFLENBQUMsY0FBY1gsV0FDakJnQixFQUFFLENBQUMsYUFBYWQ7SUFDbkIsT0FBT1csU0FBUztBQUNsQiIsInNvdXJjZXMiOlsid2VicGFjazovL0B2aXNpdG9yaXEvd2ViLy4vbGliL3ZlbG9jaXR5LnRzP2ZiMDgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3VwYWJhc2VDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5pbXBvcnQgZGF5anMgZnJvbSAnZGF5anMnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZWxvY2l0eUNvdW50KFxuICBzdXBhYmFzZTogU3VwYWJhc2VDbGllbnQsXG4gIHNpdGVLZXk6IHN0cmluZyxcbiAgdmlzaXRvcklkOiBzdHJpbmcsXG4gIHdpbmRvd01pbnV0ZXMgPSA2MFxuKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgY29uc3Qgc2luY2UgPSBkYXlqcygpLnN1YnRyYWN0KHdpbmRvd01pbnV0ZXMsICdtaW51dGUnKS50b0lTT1N0cmluZygpXG4gIC8vIExvb2t1cCBzaXRlX2lkIGZyb20gc2l0ZXMgdGFibGUgdXNpbmcgYXBpX2tleVxuICBjb25zdCB7IGRhdGE6IHNpdGVSb3csIGVycm9yOiBzaXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3NpdGVzJylcbiAgICAuc2VsZWN0KCdpZCcpXG4gICAgLmVxKCdhcGlfa2V5Jywgc2l0ZUtleSlcbiAgICAubWF5YmVTaW5nbGUoKTtcbiAgaWYgKCFzaXRlUm93IHx8IHNpdGVFcnJvcikgcmV0dXJuIDA7XG4gIGNvbnN0IHsgY291bnQgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ2V2ZW50cycpXG4gICAgLnNlbGVjdCgnKicsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSlcbiAgICAuZXEoJ3NpdGVfaWQnLCBzaXRlUm93LmlkKVxuICAgIC5lcSgndmlzaXRvcl9pZCcsIHZpc2l0b3JJZClcbiAgICAuZ3QoJ3RpbWVzdGFtcCcsIHNpbmNlKVxuICByZXR1cm4gY291bnQgfHwgMFxufVxuIl0sIm5hbWVzIjpbImRheWpzIiwidmVsb2NpdHlDb3VudCIsInN1cGFiYXNlIiwic2l0ZUtleSIsInZpc2l0b3JJZCIsIndpbmRvd01pbnV0ZXMiLCJzaW5jZSIsInN1YnRyYWN0IiwidG9JU09TdHJpbmciLCJkYXRhIiwic2l0ZVJvdyIsImVycm9yIiwic2l0ZUVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJjb3VudCIsImhlYWQiLCJpZCIsImd0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/velocity.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/axios","vendor-chunks/ioredis","vendor-chunks/asynckit","vendor-chunks/math-intrinsics","vendor-chunks/zod","vendor-chunks/uuid","vendor-chunks/es-errors","vendor-chunks/call-bind-apply-helpers","vendor-chunks/debug","vendor-chunks/redis-errors","vendor-chunks/get-proto","vendor-chunks/standard-as-callback","vendor-chunks/redis-parser","vendor-chunks/mime-db","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/form-data","vendor-chunks/follow-redirects","vendor-chunks/@ioredis","vendor-chunks/supports-color","vendor-chunks/proxy-from-env","vendor-chunks/ms","vendor-chunks/mime-types","vendor-chunks/lodash.isarguments","vendor-chunks/lodash.defaults","vendor-chunks/hasown","vendor-chunks/has-tostringtag","vendor-chunks/has-flag","vendor-chunks/get-intrinsic","vendor-chunks/es-set-tostringtag","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/denque","vendor-chunks/delayed-stream","vendor-chunks/dayjs","vendor-chunks/combined-stream","vendor-chunks/cluster-key-slot"], () => (__webpack_exec__("(rsc)/../../node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcollect-visitor%2Froute&page=%2Fapi%2Fcollect-visitor%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcollect-visitor%2Froute.ts&appDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fprantikchatterjee%2FDesktop%2FApps%2Fvisitoriq%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();