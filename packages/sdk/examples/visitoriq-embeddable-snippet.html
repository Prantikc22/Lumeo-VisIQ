<!-- VisitorIQ Embeddable Snippet: Copy and paste this into your site's <head> or just before </body> -->
<script src="https://cdn.jsdelivr.net/npm/tiny-sha256@1.0.2/sha256.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@thumbmarkjs/thumbmarkjs/dist/thumbmark.umd.js"></script>
<script>
  window.visitorIQConfig = {
    siteKey: '31db00cda275d9d4c9ab88fb19288df81c0c35161f2828e320682c6c73a8de4d', // Replace with your actual siteKey from the dashboard
    endpoint: 'http://localhost:3000/api/collect-visitor', // <-- Add this line
    onBlock: function() { alert('Access denied: Your device is blocked.'); },
    onComplete: function(result) { console.log('VisitorIQ Result:', result); }
  };
</script>
<script src="http://localhost:3000/sdk/index.min.js" async></script>
<script>
  // Auto-initialize after all scripts are loaded
  function viqAutoInit() {
    if (window.visitorIQConfig && window.ThumbmarkJS && window.sha256) {
      // Get fingerprint hash first
      new window.ThumbmarkJS.Thumbmark().get().then(function(thumbmarkResult) {
        var fingerprint_hash = thumbmarkResult.thumbmark;
        var siteKey = window.visitorIQConfig.siteKey;
        fetch('http://localhost:3000/api/blocks?siteKey=' + encodeURIComponent(siteKey), {
          headers: { 'x-usage-track': 'true' }
        })
        .then(function(resp) { return resp.json(); })
        .then(function(data) {
          var isBlocked = data.blocks && data.blocks.some(function(b) { return b.value === fingerprint_hash; });
          if (isBlocked) {
            if (typeof window.visitorIQConfig.onBlock === 'function') window.visitorIQConfig.onBlock();
          } else {
            // Pass thumbmarkResult to the SDK for collect-visitor
            window.visitorIQConfig.thumbmark_details = thumbmarkResult;
            if (window.visitoriq && window.visitoriq.init) {
              window.visitoriq.init(window.visitorIQConfig);
            }
          }
        });
      });
    } else {
      setTimeout(viqAutoInit, 100);
    }
  }
  viqAutoInit();
</script>
<!-- End VisitorIQ Snippet -->
<!--
Instructions for your dashboard:
- Replace YOUR_SITE_KEY_HERE with the user's actual siteKey for the site.
- Show this snippet in a <pre> or code block for easy copy-paste.
- Provide a "Copy" button for convenience.
- Tell users to paste it into their <head> or before </body> on any/all pages they want to track or protect.
- No further setup required!
-->
